<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Enterprise Microservices mit Spring Boot</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js-3.9.2/css/reveal.css" rel="stylesheet"><link href="reveal.js-3.9.2/plugin/title-footer/title-footer.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js-3.9.2/css/theme/anderscore.css" id="theme"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.9.2/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js-3.9.2/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section id="_enterprise_microservices_mit_spring_boot" data-state="no-title-footer"><h2>Enterprise Microservices mit Spring Boot</h2><div class="paragraph center"><p>24.10. - 26.10.22<br>
Daniel Krämer</p></div>
<div class="imageblock" style=""><img src="images/anderscore/anderscore-white.jpg" alt="anderscore white" height="200"></div></section>
<section id="_vorstellung" class="columns"><h2>Vorstellung</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>Daniel Krämer (M.Sc. Informatik)</p></div>
<div class="ulist"><ul><li><p>Senior Software Engineer</p></li><li><p>Schwerpunkte</p><div class="ulist"><ul><li><p>Software-Architektur</p></li><li><p>Integration und Migration</p></li><li><p>Clean Code</p></li><li><p>Testautomatisierung</p></li><li><p>DevOps</p></li><li><p>Trainings, Artikel, Vorträge</p></li></ul></div></li><li><p>Java, Spring, Wicket, Microservices, …</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/anderscore/user-dkraemer.jpg" alt="user dkraemer"></div></section>
<section id="_unternehmen"><h2>Unternehmen</h2><div class="paragraph"><p>
<head>
<style>
	span.r {
		color:#225c4d;
	}
	ul.bullet li::before{
  		content: "\25CF";
  		color: #225c4d;
  		display: inline-block;
  		margin-right: 20px;
	}
	ul.checkmark li::before{
  		content: "\2714";
  		color: #225c4d;
  		display: inline-block;
  		margin-right: 11px;
	}
	ul.arrow li::before{
  		content: "\2794";
  		color: #225c4d;
  		display: inline-block;
  		margin-right: 11px;
	}
</style>
</head>
<body>
<p>
	<div style="position:relative; top:280px;">
		Individuelle Anwendungsentwicklung - Java Enterprise, Web, Mobile
		<ul class="bullet" style="list-style:none;">
			<li>seit 2005 <span class="r">&#160;&#160;&#160;♦&#160;&#160;&#160;</span> in Köln <span class="r">&#160;&#160;&#160;♦&#160;&#160;&#160;</span> für alle Branchen <span class="r">&#160;&#160;&#160;♦&#160;&#160;&#160;</span> <img style="position:relative; top:17px" src="images/anderscore/goldschmiede.png" height="60"></li>
			<li>nach Aufwand & zum Festpreis</li>
		</ul>
		<div class="fragment">
			<ul class="checkmark" style="list-style:none;">
				<li>Digitalisierung / Prozesse / Integration</li>
				<li>Migration</li>
				<li>Neuentwicklung</li>
				<li>Notfall / kritische Situationen</li>
			</ul><br>
			<ul class="arrow" style="list-style:none;">
				<li>pragmatisch, zielgerichtet, zuverlässig</li>
			</ul>
		</div>
	</div>
</p>
<p class="fragment">
	<img style="overflow:hidden; position:relative; bottom:30px; left:830px;" src="images/anderscore/Bereiche.png" height="600">
</p>
<p>
	<div class="fragment">
		<div style="position:relative; bottom:270px;">
		Kompletter SW Life Cycle<br>
			<ul class="bullet" style="list-style:none;">
				<li>Projektmanagement / agile Methodik</li>
				<li>Anforderungsanalyse</li>
				<li>Architektur & SW-Design</li>
				<li>Implementierung & Testautomation</li>
				<li>Studien & Seminare</li>
			</ul>
		</div>
		<div style="position:relative; left:850px; bottom:330px; color:#225c4d; font-weight:bold">
			... und für Sie? Sprechen Sie uns an!
		</div>
	</div>
</p>
</body>
</p></div></section>
<section id="_inhalt_und_ziel"><h2>Inhalt und Ziel</h2><div class="dlist"><dl><dt class="hdlist1">Workshop</dt><dd><div class="ulist"><ul><li><p>Einführung in Microservices &amp; Spring Boot</p></li><li><p>Überwindung von Einstiegshürden</p></li><li><p>Funktionen und Features werden mit Aufgaben erarbeitet</p></li></ul></div></dd><dt class="hdlist1">Zielgruppe</dt><dd><div class="ulist"><ul><li><p>Software-Entwickler, die ein tiefgreifendes Verständnis der Funktionsweise und des Einsatzes von Microservices sowie deren Umsetzung mit Spring Boot lernen möchten.</p></li></ul></div></dd><dt class="hdlist1">Voraussetzungen</dt><dd><div class="ulist"><ul><li><p>Gute Java Kenntnisse</p></li><li><p>Grundkenntnisse des Spring Frameworks</p></li><li><p>Sicherheit im Umgang mit einer IDE (z. B. Eclipse oder IntelliJ)</p></li><li><p>Basiswissen zu HTTP, SQL, Transaktionen, JUnit</p></li><li><p>Erfahrung mit Maven</p></li></ul></div></dd></dl></div></section>
<section id="_zeitplan"><h2>Zeitplan</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Beginn</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">09:00 Uhr</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Kaffeepause</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">ca. 10:30 bis 10:45 Uhr</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Mittagspause</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">12:00 bis 13:00 Uhr</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Kaffeepause</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">ca. 15:00 bis 15:15 Uhr</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Ende</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">16:00 Uhr</p></td></tr></table></section>
<section id="_material"><h2>Material</h2><div class="ulist"><ul><li><p>Spring Boot Guides<br>
<a href="https://spring.io/guides/gs/spring-boot" class="bare">https://spring.io/guides/gs/spring-boot</a></p></li><li><p>Spring Boot Documentation<br>
<a href="https://spring.io/projects/spring-boot" class="bare">https://spring.io/projects/spring-boot</a></p></li><li><p>Baeldung<br>
<a href="https://www.baeldung.com/spring-boot" class="bare">https://www.baeldung.com/spring-boot</a></p></li></ul></div></section>
<section id="_vorstellung_2" class="columns"><h2>Vorstellung</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>Jetzt sind Sie dran!</p></div>
<div class="ulist"><ul><li><p>Name</p></li><li><p>Anrede</p></li><li><p>Vorwissen</p></li><li><p>Erwartungen</p></li><li><p>Themenwünsche</p></li></ul></div></div></div>
<div class="imageblock" style="float: right"><img src="images/anybody.jpg" alt="anybody"></div></section>
<section id="_vorgesehener_ablauf"><h2>Vorgesehener Ablauf</h2><div class="dlist"><dl><dt class="hdlist1">Tag 1</dt><dd><p>Wiederholung Spring, Spring Boot (Grundlagen, JPA)</p></dd><dt class="hdlist1">Tag 2</dt><dd><p>Spring Boot (REST, Starter), Microservices</p></dd><dt class="hdlist1">Tag 3</dt><dd><p>Spring Security, Spring Cloud</p></dd></dl></div></section>
<section id="_lektion_1_wiederholung_spring" data-state="no-title-footer"><h2>Lektion 1 - Wiederholung Spring</h2></section>
<section id="_was_ist_spring"><h2>Was ist Spring?</h2><div class="paragraph heading"><p>Spring &#8230;&#8203;</p></div>
<div class="ulist"><ul><li><p>ist ein Framework (mehr als eine Bibliothek, kein Application Server)</p></li><li><p>benötigt nur JDK und einige Bibliotheken (jars)</p></li><li><p>kann fast überall integriert werden</p></li><li><p>kann fast alles integrieren</p></li></ul></div></section>
<section id="_spring_ökosystem"><h2>Spring-Ökosystem</h2><div class="paragraph center"><p><span class="image"><img src="images/spring-ecosystem.jpg" alt="spring ecosystem"></span></p></div></section>
<section id="_module"><h2>Module</h2><div class="paragraph center"><p><span class="image"><img src="images/spring-overview.png" alt="spring overview" height="800"></span></p></div></section>
<section id="_wie_hat_alles_begonnen" class="columns"><h2>Wie hat alles begonnen?</h2><div class="openblock"><div class="content"><div class="paragraph"><p>Prinzipien:</p></div>
<div class="ulist"><ul><li><p>Dependency Injection (DI)</p></li><li><p>Aspektorientierte Programmierung (AOP)</p></li><li><p>Template-Method Pattern</p></li></ul></div></div></div>
<div class="paragraph"><p><span class="image" style="float: right"><img src="images/book_rod_johnson.jpg" alt="book rod johnson"></span></p></div></section>
<section id="_hintergrund"><h2>Hintergrund</h2><div class="ulist"><ul><li><p>Initiatoren: Rod Johnson, Jürgen Höller</p></li><li><p>Apache 2.0 Lizenz</p></li><li><p>Herausgeber: Pivotal Software Inc.</p></li><li><p>Projekt Lead: Jürgen Höller</p></li><li><p>Projektseite: <a href="https://spring.io/projects/spring-framework" class="bare">https://spring.io/projects/spring-framework</a></p></li><li><p>Sourcen: <a href="https://github.com/spring-projects/spring-framework" class="bare">https://github.com/spring-projects/spring-framework</a></p></li></ul></div></section>
<section id="_dependency_injection"><h2>Dependency Injection</h2><div class="paragraph heading"><p>Herausforderung</p></div>
<div class="imageblock" style="text-align: center"><img src="images/di-context.svg" alt="di context" width="1200" height="600"></div></section>
<section id="_dependency_injection_2"><h2>Dependency Injection</h2><div class="paragraph heading"><p>Lösung</p></div>
<div class="paragraph"><p>Setzen der Abhängigkeiten durch externe Komponente!</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> FxUserProvider userProvider;
<span class="directive">private</span> JdbcPreferencesRepository preferencesRepository;
<span class="directive">private</span> PreferencesServiceImpl preferencesService;

<span class="directive">private</span> <span class="type">void</span> plumb() {
    userProvider = <span class="keyword">new</span> FxUserProvider();
    preferencesRepository = <span class="keyword">new</span> JdbcPreferencesRepository();
    preferencesService = <span class="keyword">new</span> PreferencesServiceImpl();
    preferencesService.setUserProvider(userProvider);
    preferencesService.setPreferencesRepository(preferencesRepository);
}</code></pre></section>
<section id="_vorteile_von_spring"><h2>Vorteile von Spring</h2><div class="ulist"><ul><li><p>Einfachheit (Verwendung von POJOs)</p></li><li><p>Testbarkeit</p></li><li><p>Verbreitungsgrad</p></li><li><p>Einfache Integration</p></li><li><p>Viele fertige Bausteine</p></li><li><p>Lego-Prinzip</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Lego-Prinzip heißt:</p></div>
<div class="ulist"><ul><li><p>Es gibt für alles definierte Schnittstellen</p></li><li><p>Technologien sind als Bausteine mit diesen Schnittstellen verpackt</p></li><li><p>Als Entwickler stöpselt man nur noch diese Bausteine zusammen</p></li></ul></div></aside></section>
<section><section id="_applicationcontext"><h2>ApplicationContext</h2><div class="ulist"><ul><li><p>Der <code>ApplicationContext</code> ist ein Container für Service-Objekte, den sogenannten <strong>Beans</strong>.</p></li><li><p>Er speichert diese Objekte bzw. deren <strong>Factories</strong>
in einer Registry unter einem <strong>eindeutigen Namen</strong>, vergleichbar mit einer HashMap.</p></li><li><p>Beim Erzeugen von Objekten
nutzt er diese Registry um <strong>Abhängigkeiten aufzulösen</strong>.</p></li></ul></div><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Nutzen den Debugger um sich den <code>ApplicationContext</code> zur Laufzeit anzusehen.</td></tr></table></div></section><section id="_möglichkeiten_einen_applicationcontext_zu_erzeugen"><h2>Möglichkeiten einen ApplicationContext zu erzeugen</h2><div class="paragraph"><p>Es gibt diverse Klassen, die das ApplicationContext-Interface implementieren, die wichtigsten sind:</p></div>
<div class="ulist"><ul><li><p><code>ClassPathXmlApplicationContext</code> für XML-Config</p></li><li><p><code>AnnotationConfigApplicationContext</code> für Java-Config</p></li><li><p><code>StaticApplicationContext</code> für Tests</p></li></ul></div>
<div class="paragraph"><p>Am flexibelsten ist der <code>GenericApplicationContext</code>, der über verschiedene <code>AbstractBeanDefinitionReader</code>
unterschiedliche Formate für die Context-Definition unterstützt.</p></div></section><section id="_applicationcontext_für_webapps"><h2>ApplicationContext für Webapps</h2><div class="paragraph"><p>Für Webapplikationen gibt es spezielle ApplicationContext Klassen:</p></div>
<div class="ulist"><ul><li><p><code>XmlWebApplicationContext</code> für XML-Config bei Webapps</p></li><li><p><code>AnnotationConfigWebApplicationContext</code> für Java-Config bei Webapps</p></li><li><p><code>GenericWebApplicationContext</code> ist das Gegenstück zu <code>GenericApplicationContext</code> für Webapps</p></li></ul></div></section></section>
<section><section id="_lebenszyklus_einer_bean"><h2>Lebenszyklus einer Bean</h2><div class="paragraph heading"><p>Möglichkeiten, den Lebenszyklus einer Bean zu beeinflussen</p></div><div class="ulist"><ul><li><p>Interfaces <code>InitializingBean</code>, <code>DisposableBean</code> und <code>Lifecycle</code></p></li><li><p>JSR-250 Annotationen <code>@PostConstruct</code> und <code>@PreDestroy</code></p></li><li><p>Explizite Angabe der <em>init-method</em> oder <em>destroy-method</em> per Konfiguration</p></li><li><p>public close/shutdown, abschaltbar über <code>@Bean(destroyMethod="")</code></p></li></ul></div></section><section id="_initdestroy_über_lifecycle_interfaces"><h2>Init/Destroy über Lifecycle-Interfaces</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> <span class="directive">implements</span> InitializingBean, DisposableBean {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(MyService.class);

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterPropertiesSet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">service created</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() <span class="directive">throws</span> <span class="exception">Exception</span> {
        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">service destroyed</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">service destroyed</span><span class="delimiter">&quot;</span></span>); <span class="comment">// falls Logging schon beendet wurde</span>
    }
}</code></pre></section></section>
<section id="_applicationcontext_konfiguration"><h2>ApplicationContext Konfiguration</h2><div class="paragraph heading"><p>Möglichkeiten den ApplicationContext zu konfigurieren:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>XML</p></li><li><p>Annotationen</p></li><li><p>Java-Methoden</p></li><li><p>Lambda Ausdrücke (seit Spring 5)</p></li><li><p>&#8230;&#8203; und jede Kombination davon!</p></li></ol></div></section>
<section><section id="_java_basierte_konfiguration"><h2>Java-basierte Konfiguration</h2><div class="ulist"><ul><li><p>Java-Klasse zur Konfiguration des ApplicationContext</p></li><li><p>Kein Medienbruch (Refactoring, Compiler erkennt Fehler)</p></li><li><p>Weniger Boilerplate als bei XML</p></li><li><p>Trennung von Implementierung und Verdrahtung erfordert Disziplin</p></li></ul></div></section><section id="_grundgerüst"><h2>Grundgerüst</h2><div class="title">CarConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CarConfig</span> {

    <span class="comment">// Bean mit Namen 'firstCar'</span>
    <span class="annotation">@Bean</span>
    Car firstCar() {
        <span class="keyword">return</span> <span class="keyword">new</span> Car();
    }

    <span class="comment">// Bean mit Name 'firstCar2' und Aliasen 'bobbyCar' und 'car2'</span>
    <span class="annotation">@Bean</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">firstCar2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bobbyCar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">car2</span><span class="delimiter">&quot;</span></span>})
    Car firstCar2() {
        <span class="keyword">return</span> <span class="keyword">new</span> Car();
    }
}</code></pre></section><section id="_zusammenstöpseln_von_beans"><h2>Zusammenstöpseln von Beans</h2><div class="title">CarConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">// Ist Singleton, d. h. gibt es nur einmal!</span>
<span class="annotation">@Bean</span>
Engine engine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span>, <span class="integer">48</span>);
}

<span class="annotation">@Bean</span>
Car realCar() {
    Car car = <span class="keyword">new</span> Car();
    car.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">yellow</span><span class="delimiter">&quot;</span></span>);
    car.setEngine(engine()); <span class="comment">// Verdrahtung über Methode (Cache!)</span>
    <span class="keyword">return</span> car;
}

<span class="annotation">@Bean</span>
Car realCar2(Engine engine) { <span class="comment">// Verdrahtung über Parameter</span>
    Car car = <span class="keyword">new</span> Car();
    car.setEngine(engine);
    <span class="keyword">return</span> car;
}</code></pre>
<div class="paragraph"><p>Bgzl. Auflösung von Mehrdeutigkeiten siehe
<a href="https://www.logicbig.com/tutorials/spring-framework/spring-core/javaconfig-methods-inter-dependency.html">
Dependency injection in @Bean method parameters</a>.</p></div></section></section>
<section id="_annotationen_für_java_config_ohne_autowiring"><h2>Annotationen für Java-Config (ohne Autowiring)</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Annotation</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Configuration</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Markiert eine Klasse als Konfigurationsklasse</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Bean</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Makiert eine Methode als Bean-Factory</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Lazy</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bean wird nur bei Bedarf initialisiert</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Nullable (bei Bean-Methode)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bean darf <code>null</code> sein</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Scope</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Legt den Scope einer Bean fest</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Import</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeiten aus anderer Config-Klasse importieren</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@ImportResource</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeiten aus XML-Datei importieren</p></td></tr></table></section>
<section><section id="_autowiring"><h2>Autowiring</h2><div class="paragraph heading"><p>Motivation</p></div><div class="ulist"><ul><li><p>Verdrahten von Beans erfordert viel Boilerplate (unübersichtlich, pflegeintensiv)</p></li><li><p>Oft ist Verdrahtung eindeutig</p></li><li><p>Per Reflection machbar</p></li></ul></div></section><section id="_annotationen_für_autowiring"><h2>Annotationen für Autowiring</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Annotation</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Autowired</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Befüllt Property über Autowiring</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Nullable (bei Abhängigkeit)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeit darf <code>null</code> sein</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Required (deprecated)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeit notwendig (nur bei Setter sinnvoll)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Primary</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Legt die bevorzugte Bean fest</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Qualifier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Makiert eine Bean oder eine Abhängigkeit</p></td></tr></table></section><section id="_field_autowiring"><h2>Field Autowiring</h2><div class="paragraph"><p>Es gibt 3 Arten von Autowiring. Am häufigsten wird diese Variante verwendet:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Engine engine;
<span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;Feature&gt; features;</code></pre></section><section id="_setter_autowiring"><h2>Setter Autowiring</h2><div class="paragraph"><p>Eher selten:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">public</span> <span class="type">void</span> setEngine(Engine engine) {
    <span class="local-variable">this</span>.engine = engine;
}

<span class="annotation">@Autowired</span>
<span class="directive">public</span> <span class="type">void</span> setFeatures(<span class="predefined-type">List</span>&lt;Feature&gt; features) {
    <span class="local-variable">this</span>.features = features;
}</code></pre></section><section id="_konstruktor_autowiring"><h2>Konstruktor Autowiring</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> <span class="directive">final</span> Engine engine;
<span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Feature&gt; features;

<span class="annotation">@Autowired</span>
<span class="directive">public</span> CarConstructorWiring(Engine engine, <span class="predefined-type">List</span>&lt;Feature&gt; features) {
    <span class="local-variable">this</span>.engine = engine;
    <span class="local-variable">this</span>.features = features;
}</code></pre>
<div class="paragraph"><p>Nur sinnvoll in Kombination mit annotationsbasierter Konfiguration.<br>
Für Muss-Parameter in Kombination mit <code>final</code> empfohlen.</p></div></section><section id="_verwendung_von_primary"><h2>Verwendung von @Primary</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="annotation">@Primary</span>
Engine gasEngine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>, <span class="integer">68</span>);
}

<span class="annotation">@Bean</span>
Engine dieselEngine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span>, <span class="integer">72</span>);
}

<span class="annotation">@Bean</span>
Car car(Engine engine) {
   var car = <span class="keyword">new</span> Car();
   car.setEngine(engine);
   <span class="keyword">return</span> car;
}</code></pre>
<div class="paragraph"><p>Wird häufig für Tests verwendet.</p></div></section></section>
<section><section id="_annotationsbasierte_konfiguration"><h2>Annotationsbasierte Konfiguration</h2><div class="paragraph heading"><p>Aktivieren der annotationsbasierten Konfiguration</p></div><div class="title">Java-Config</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeConfig</span> {
    <span class="comment">// ...</span>
}</code></pre></section><section id="_annotationen_für_annotationsbasierten_konfiguration"><h2>Annotationen für annotationsbasierten Konfiguration</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Annotation</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@ComponentScan</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Festlegung der Packages, die für annotationsbasierte Konfiguration herangezogen werden</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Component (@Service, @Repository, @Controller)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Markiert eine Klasse als Bean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Value</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wertangabe mit den Features der XML-Config</p></td></tr></table></section></section>
<section><section id="_externe_konfiguration"><h2>Externe Konfiguration</h2><div class="paragraph heading"><p>Motivation</p></div><div class="paragraph"><p>Manche Konfigurationswerte sind</p></div><div class="ulist"><ul><li><p>zum Entwicklungszeitpunkt noch nicht bekannt,</p></li><li><p>sind abhängig von der Laufzeitumgebung oder</p></li><li><p>müssen nachträglich änderbar sein.</p></li></ul></div><div class="paragraph"><p>Im Java-Umfeld werden dafür meistens Properties-Dateien verwendet.<br>
Diese enthalten einfache Key-Value Paare:</p></div><div class="literalblock"><div class="content"><pre>server.port=8081
debug: true</pre></div></div><div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Man kann entweder '=' oder ': ' als Trenner zwischen Schlüssel und Wert verwenden.</td></tr></table></div></section><section id="_propertysource"><h2>@PropertySource</h2><div class="paragraph"><p>Bei Spring bindet man eine Properties-Datei über die <code>@PropertySource</code> Annotation ein:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:app.properties</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyJavaConfig</span> {
    <span class="comment">//...</span>
}</code></pre></section><section id="_zugriff_auf_property_werte"><h2>Zugriff auf Property-Werte</h2><div class="paragraph"><p>Platzhalter der Form <code>${key}</code> werden in Annotationsparameter durch die
entsprechenden Property-Werte ersetzt.
Häufig wird das in Kombination mit der <code>@Value</code> Annotation verwendet:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${server.port}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">int</span> serverPort;

<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:${server.port}/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> serverUrl;

<span class="annotation">@Bean</span>
SomeService someService(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${debug}</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> debug) {</code></pre></section></section>
<section><section id="_profile"><h2>Profile</h2><div class="paragraph heading"><p>Einsatz von @Profile</p></div><div class="ulist"><ul><li><p>Unterschiedliche Umgebungen (Produktion, Entwicklung) erfordern unterschiedliche Konfiguration.</p></li><li><p>Profile kommen zum Einsatz, wenn Einstellungen (Konfigurationswerte) nicht ausreichen.</p></li><li><p>Mit der Annotation <code>@Profile("profilname")</code> legt man fest, dass eine Konfiguration nur gelten
soll, wenn das entsprechende Profil aktiviert ist.</p></li><li><p>Die <code>@Profile</code> Annotation kann man sowohl auf eine ganze (Konfigurations-)Klassen als auch auf
einzelne Bean-Methoden anwenden.</p></li><li><p>Profile lassen sich mit <code>&amp;</code> (und), <code>|</code> (oder), <code>!</code> (Negation) und Klammern verknüpfen:</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production &amp; (us-east | eu-central)</span><span class="delimiter">&quot;</span></span>)</code></pre></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-definition-profiles-java">
&#8594; Reference: Using @Profile</a></p></div></section><section id="_profile_aktivieren"><h2>Profile aktivieren</h2><div class="paragraph"><p>Man kann mehrere Profile gleichzeitig aktiveren, entweder programmatisch:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">ctx.getEnvironment().setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">profile1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">profile2</span><span class="delimiter">&quot;</span></span>);</code></pre>
<div class="paragraph"><p>Oder über die <code>spring.profiles.active</code> Property, z. B. mit:</p></div>
<div class="literalblock"><div class="content"><pre>-Dspring.profiles.active="profile1,profile2"</pre></div></div>
<div class="paragraph"><p>Wenn kein Profil aktiviert wurde, dann ist immer das <strong><code>default</code></strong> Profil aktiv.</p></div></section></section>
<section id="_wiederholung_spring"><h2>Wiederholung Spring</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson02-microservices.html">&#8594; Weiter zu Microservices</a></p></div></section>
<section id="_lektion_2_microservices" data-state="no-title-footer"><h2>Lektion 2 - Microservices</h2></section>
<section id="_modularisierung" class="columns"><h2>Modularisierung</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Technisch</strong></p><div class="ulist"><ul><li><p>Klasse, Package</p></li><li><p>Modul/Library</p></li><li><p>Deployment Unit</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Fachlich</strong></p><div class="ulist"><ul><li><p>Konzept</p></li><li><p>Produkt</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Organisatorisch</strong></p><div class="ulist"><ul><li><p>Team</p></li><li><p>Abteilung</p></li></ul></div></li></ul></div></div></div></section>
<section id="_modularisierung_2"><h2>Modularisierung</h2><div class="paragraph heading"><p>Warum modularisieren wir?</p></div>
<div class="ulist"><ul><li><p>Beherrschung der Komplexität</p></li><li><p>Parallelsierung der Entwicklung</p></li><li><p>Auffindbarkeit von Code</p></li><li><p>Erleichterung der Wartung</p></li></ul></div></section>
<section id="_monolith" class="columns"><h2>Monolith</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Schwergewichtiges Software-Artefakt</p></li><li><p>Hohe Anzahl fachlicher Komponenten</p></li><li><p>Einheitliche technische Basis</p></li><li><p>Eine Deployment Unit</p></li><li><p>Ein Prozess zur Laufzeit</p></li><li><p><strong>Nicht</strong> grundsätzlich ein Anti-Pattern!</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/Monolith1.jpg" alt="Monolith1" height="400"></div></section>
<section id="_probleme_eines_monolithen" class="columns"><h2>Probleme eines Monolithen</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Hohe (technische) Kopplung zwischen Komponenten</p></li><li><p>Lange Build Cycles</p></li><li><p>Einzelne Bestandteile nicht unabhängig skalierbar</p></li><li><p>Verzögerte Auslieferung neuer Features</p></li><li><p>Hoher Wartungsaufwand</p></li><li><p>Mangel an Agilität und Innovation</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/Monolith2.png" alt="Monolith2" height="600"></div></section>
<section id="_conways_law"><h2>Conway&#8217;s Law</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Organizations which design systems […] are constrained to produce designs which are <strong>copies of the communication structures</strong> of these organizations.</p></div></blockquote><div class="attribution"><cite>1968</cite><br>&#8212; Melvin Edward Conway</div></div></section>
<section id="_conways_law_2"><h2>Conway&#8217;s Law</h2><div class="ulist"><ul><li><p>Barrieren in der Kommunikation &#8594; Brüche in der Software</p></li><li><p>Klassische Aufteilung</p><div class="ulist"><ul><li><p>Fachseite</p></li><li><p>Entwickler</p></li><li><p>Datenbankspezialisten</p></li><li><p>Ops</p></li></ul></div></li><li><p>Konsequenzen</p><div class="ulist"><ul><li><p>Unrealistische Anforderungen</p></li><li><p>Keine Kontrolle über Daten</p></li><li><p>Wenig Details zu Fehlern</p></li></ul></div></li></ul></div></section>
<section id="_wohin_geht_die_reise"><h2>Wohin geht die Reise?</h2><div class="imageblock" style=""><img src="images/lesson02/Microservices1.png" alt="Microservices1" height="800"></div></section>
<section id="_microservices"><h2>Microservices</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Microservices sind ein <strong>Architekturmuster</strong> der Informationstechnik, bei dem komplexe Anwendungssoftware aus
<strong>unabhängigen Prozessen</strong> komponiert wird, die untereinander mit <strong>sprachunabhängigen Programmierschnittstellen</strong> kommunizieren.
Die Dienste sind weitgehend <strong>entkoppelt</strong> und erledigen eine <strong>kleine Aufgabe</strong>. So ermöglichen sie einen <strong>modularen Aufbau</strong> von
Anwendungssoftware.</p></div></blockquote><div class="attribution">&#8212; wikipedia.de</div></div></section>
<section id="_microservices_2"><h2>Microservices</h2><div class="imageblock" style=""><img src="images/lesson02/Microservices2.png" alt="Microservices2" height="600"></div></section>
<section id="_merkmale"><h2>Merkmale</h2><div class="paragraph"><p><strong>Ein Microservice&#8230;&#8203;</strong></p></div>
<div class="ulist"><ul><li><p>&#8230;&#8203;läuft in einem <strong>eigenen Prozess</strong>.</p></li><li><p>&#8230;&#8203;wird über das <strong>Netzwerk</strong> angesprochen.</p></li><li><p>&#8230;&#8203;kann <strong>unabhängig</strong> deployed, erweitert oder skaliert werden.</p></li><li><p>&#8230;&#8203;repräsentiert einen <strong>Bounded Context</strong> der Fachdomäne.</p></li><li><p>&#8230;&#8203;ist nicht an die <strong>Technologie</strong> anderer Services gebunden.</p></li><li><p>&#8230;&#8203;wird nur von <strong>einem Team</strong> entwickelt.</p></li><li><p>&#8230;&#8203;hat ein <strong>unabhängiges Datenmodell</strong>.</p></li></ul></div></section>
<section id="_aufbau"><h2>Aufbau</h2><div class="imageblock" style=""><img src="images/lesson02/microservice_anatomy.png" alt="microservice anatomy" height="800"></div></section>
<section id="_kommunikation"><h2>Kommunikation</h2><div class="imageblock" style=""><img src="images/lesson02/kommunikation_right.png" alt="kommunikation right" height="600"></div></section>
<section id="_kommunikation_2"><h2>Kommunikation</h2><div class="imageblock" style=""><img src="images/lesson02/kommunikation_false.png" alt="kommunikation false" height="600"></div></section>
<section id="_herausforderungen"><h2>Herausforderungen</h2><div class="ulist"><ul><li><p>Verteiltes System</p><div class="ulist"><ul><li><p>Orchestrierung</p></li><li><p>Resilienz</p></li><li><p>Konsistenz</p></li><li><p>Debugging</p></li><li><p>Monitoring und Logging</p></li></ul></div></li><li><p>Netzwerk</p><div class="ulist"><ul><li><p>Performance</p></li><li><p>Zuverlässigkeit</p></li></ul></div></li><li><p>Potentieller "Technologiezoo"</p></li></ul></div></section>
<section id="_resilienz" class="columns"><h2>Resilienz</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Bulkhead</strong></p><div class="ulist"><ul><li><p>Angelehnt an Schiffsbau (Schotten)</p></li><li><p>Separierung einzelner Bereiche</p></li><li><p>Beispiel: Aufteilung des Thread Pools</p></li></ul></div></li><li><p><strong>Circuit Breaker</strong></p><div class="ulist"><ul><li><p>Angelehnt an Elektrotechnik (Sicherung)</p></li><li><p>Steuerung des Durchflusses</p><div class="ulist"><ul><li><p>Geschlossen: Alle Request durchlassen</p></li><li><p>Offen: Alle Requests abweisen (&#8594; Defaults)</p></li><li><p>Halb offen: Begrenzte Anzahl an Requests durchl.</p></li></ul></div></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="imageblock" style=""><img src="images/lesson02/Bulkhead.jpg" alt="Bulkhead"></div>
<div class="imageblock" style=""><img src="images/lesson02/CircuitBreaker.jpg" alt="CircuitBreaker"></div></div></div></section>
<section id="_konsistenz"><h2>Konsistenz</h2><div class="ulist"><ul><li><p><strong>Klassische Transaktionen (ACID)</strong></p><div class="ulist"><ul><li><p><strong>A</strong> tomicity: Atomare Durchführung von Änderungen</p></li><li><p><strong>C</strong> onsistency: Konsistenzerhaltung</p></li><li><p><strong>I</strong> solation: Isolation nebenläufiger Änderungen</p></li><li><p><strong>D</strong> urability: Festschreibung der Änderungen</p></li></ul></div></li><li><p><strong>Two Phase Commit (2PC, XA)</strong></p><div class="ulist"><ul><li><p>ACID für verteilte Systeme</p></li><li><p>Phase 1: Commits vorbereiten</p></li><li><p>Phase 2: Commits durchführen</p></li><li><p>Pet Helland: "Grown-ups don&#8217;t use distributed transactions"</p></li><li><p>Gregor Hohpe: "Starbucks does not use two phase commit"</p></li></ul></div></li></ul></div></section>
<section id="_konsistenz_2" class="columns"><h2>Konsistenz</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>CAP Theorem</p></div>
<div class="ulist"><ul><li><p><strong>C</strong> onsistency: <strong>Zeitliche</strong> Konsistenz</p></li><li><p><strong>A</strong> vailability: Verfügbarkeit</p></li><li><p><strong>P</strong> artition Tolerance: Toleranz gegenüber Netzwerkpartitionen</p></li><li><p>Nur 2 von 3 Eigenschaften möglich!</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/CAP.png" alt="CAP" width="600"></div></section>
<section id="_konsistenz_3" class="columns"><h2>Konsistenz</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>CAP bei verteilten Systemen</p></div>
<div class="ulist"><ul><li><p>Partitionstoleranz obligatorisch</p></li><li><p>Verfügbarkeit oder Konsistenz</p></li><li><p>Beispiel: Bestellsystem vs. Geldautomat</p></li><li><p>Meist BASE statt ACID</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/CAP.png" alt="CAP" width="600"></div></section>
<section id="_konsistenz_4" class="columns"><h2>Konsistenz</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>CAP bei Microservices</p></div>
<div class="ulist"><ul><li><p><strong>Keine</strong> verteilten Transaktionen</p></li><li><p>Aggregate (DDD) bestimmt Konsistenzgrenze</p></li><li><p>Eventual Consistency</p></li><li><p>Fehlerbehandlung</p><div class="ulist"><ul><li><p>Stateful Retry (erfordert Idempotenz)</p></li><li><p><strong>Fachliche</strong> Kompensation</p></li></ul></div></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/Kompensation.png" alt="Kompensation" height="900"></div></section>
<section id="_self_contained_system" class="columns"><h2>Self Contained System</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Eigenständige Anwendung</p><div class="ulist"><ul><li><p>GUI</p></li><li><p>Datenmodell</p></li><li><p>Logik</p></li><li><p>Persistenz</p></li></ul></div></li><li><p>Lose Kopplung an andere Systeme</p><div class="ulist"><ul><li><p>Integration bevorzugt über UI</p></li><li><p>Datenaustausch nur über APIs</p></li><li><p>Möglichst asynchrone Kommunikation</p></li></ul></div></li><li><p>Entwicklung durch <strong>ein</strong> Team</p></li><li><p>Single Responsibility Prinzip</p></li><li><p>Kann aus Microservices bestehen</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/SCS.png" alt="SCS" height="500"></div></section>
<section id="_architektur"><h2>Architektur</h2><div class="paragraph heading"><p>Makro-Architektur</p></div>
<div class="ulist"><ul><li><p>Wie viele Services brauchen wir?</p></li><li><p>Wie groß darf ein Service sein?</p></li><li><p>Wie schneiden wir die Services?</p></li><li><p>Wie sollen die Schnittstellen aussehen?</p></li><li><p>Welche Technologiestacks erlauben wir?</p></li><li><p>Wie setzen wir Authentifikation, Monitoring und Logging um?</p></li></ul></div></section>
<section id="_architektur_2"><h2>Architektur</h2><div class="paragraph heading"><p>Mikro-Architektur</p></div>
<div class="ulist"><ul><li><p>Wie sollte ein Service aufgebaut sein?</p></li><li><p>Welche Technologien nutzen wir im Detail?</p></li><li><p>Wie setzen wir Authorisierung um?</p></li></ul></div></section>
<section id="_domain_driven_design"><h2>Domain Driven Design</h2><div class="ulist checklist"><ul class="checklist"><li><p><i class="icon-check"></i>Wie schneiden wir die Services?</p></li><li><p><i class="icon-check"></i>Wie sollte ein Service aufgebaut sein?</p></li><li><p><i class="icon-check"></i>Wie groß sollte ein Service sein?</p></li><li><p><i class="icon-check"></i>Wie viele Services brauchen wir?</p></li></ul></div></section>
<section id="_domain_driven_design_2" class="columns"><h2>Domain Driven Design</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Herangehensweise zur <strong>fachlichen</strong> Strukturierung einer Anwendung</p></li><li><p>Domänenmodell</p><div class="ulist"><ul><li><p>Ubiquitious Language</p></li><li><p>Ausgangsbasis der Entwicklung</p></li><li><p>Klassifizierung enthaltener Elemente</p></li></ul></div></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/DDD.jpg" alt="DDD" height="600"></div></section>
<section id="_domain_driven_design_elemente"><h2>Domain Driven Design: Elemente</h2><div class="imageblock" style=""><img src="images/lesson02/DDDElemente.png" alt="DDDElemente" height="600"></div></section>
<section id="_domain_driven_design_bounded_context"><h2>Domain Driven Design: Bounded Context</h2><div class="ulist"><ul><li><p>Grenze innerhalb einer Domäne</p><div class="ulist"><ul><li><p>Fachlichkeit</p></li><li><p>Datenmodell</p></li><li><p>Konsistenz</p></li><li><p>Organisation</p></li></ul></div></li><li><p>Identifizierung</p><div class="ulist"><ul><li><p>Clustering von Anforderungen (z.B. Use Cases)</p></li><li><p>Bestimmung von Abhängigkeiten</p></li></ul></div></li></ul></div></section>
<section id="_domain_driven_design_stategic_design"><h2>Domain Driven Design: Stategic Design</h2><div class="paragraph heading"><p>Kommunikationsbeziehungen und Machtverhältnisse zwischen Bounded Contexts</p></div>
<div class="ulist"><ul><li><p><strong>Separate Ways:</strong> Keine Integration</p></li><li><p><strong>Open Host Service:</strong> Einseitige Bereitstellung von Schnittstellen</p></li><li><p><strong>Conformist:</strong> Übernahme des fremden Modells</p></li><li><p><strong>Anti-Corruption Layer:</strong> Adapter zu fremdem Modell</p></li><li><p><strong>Customer-Supplier:</strong> Gleichberechtigte Aushandlung der Schnittstellen</p></li><li><p><strong>Shared Kernel:</strong> Gemeinsame Verwendung eines Teilmodells</p></li></ul></div></section>
<section id="_domain_driven_design_context_map"><h2>Domain Driven Design: Context Map</h2><div class="paragraph heading"><p>Visualisierung der Beziehungen</p></div>
<div class="imageblock" style=""><img src="images/lesson02/ContextMap.png" alt="ContextMap" height="400"></div></section>
<section id="_domain_driven_design_übung"><h2>Domain Driven Design: Übung</h2><div class="paragraph"><p>Für den großen Parkhausbetreiber „JustParkIt“ soll ein System zur Ausgabe, Nutzung, Abrechnung und Rücknahme von Tickets und Dauerparkausweisen umgesetzt werden.
Im Rahmen der Anforderungserhebung wurden bereits einige User Stories ermittelt.</p></div>
<div class="paragraph"><p><strong>Aufgaben:</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Gruppieren Sie die User Stories nach fachlichen Domänen und benennen Sie die so entstandenen Bounded Contexts.</p></li><li><p>Identifizieren Sie die jeweils beteiligten Akteure sowie Abhängigkeiten zwischen den Kontexten.</p></li><li><p>Modellieren Sie einen Dauerparkausweis in den einzelnen Kontexten. Wo gibt es Gemeinsamkeiten, wo zeigen sich Unterschiede?</p></li><li><p>Entwickeln Sie eine Context Map und benennen Sie die Beziehungen (&#8594; Patterns) zwischen den Kontexten.</p></li></ol></div></section>
<section id="_domain_driven_design_übung_2"><h2>Domain Driven Design: Übung</h2><div class="ulist"><ul><li><p><strong>US-01</strong>: Als Kunde möchte ich mir an der Schranke ein Ticket ziehen, um ins Parkhaus einfahren zu können.</p></li><li><p><strong>US-02</strong>: Als Kunde möchte ich an der Schranke meinen gültigen Dauerparkausweis nutzen, um ins Parkhaus einfahren zu können.</p></li><li><p><strong>US-03</strong>: Als Parkhausbetreiber möchte ich eine Übersicht aller aktuell gültigen Dauerparkausweise pro Parkhaus online erhalten, um bei Bedarf weitere Ausweise nachbestellen zu können.</p></li><li><p><strong>US-04</strong>: Als Kunde möchte ich mein bezahltes Ticket an der Schranke zurückgeben, um aus dem Parkhaus herausfahren zu können.</p></li><li><p><strong>US-05</strong>: Als Kunde möchte ich an der Schranke meinen Dauerparkausweis nutzen, um aus dem Parkhaus herausfahren zu können.</p></li></ul></div></section>
<section id="_domain_driven_design_übung_3"><h2>Domain Driven Design: Übung</h2><div class="ulist"><ul><li><p><strong>US-06</strong>: Als Parkhausbetreiber möchte ich einen Dauerparkausweis sperren können, um säumigen Zahlern den Zugang zu den Parkhäusern zu verwehren.</p></li><li><p><strong>US-07</strong>: Als Kunde mit Dauerparkausweis möchte ich die im aktuellen Monat angefallenen Kosten online einsehen, um eine Übersicht über meine Ausgaben zu erhalten.</p></li><li><p><strong>US-08</strong>: Als Parkhausbetreiber möchte ich elektronische Zahlungen am Automaten an einen Zahlungsdienstleister weiterleiten, damit sich dieser um die Abwicklung kümmert.</p></li><li><p><strong>US-09</strong>: Als Pförtner möchte ich die Schranke mit einem auf dem Dauerparkausweis aufgedruckten Code öffnen können, falls der Chip auf dem Ausweis selbst nicht mehr lesbar ist.</p></li><li><p><strong>US-10</strong>: Als Kunde möchte ich einen Dauerparkausweis online für ein weiteres Parkhaus des Betreibers freischalten, um dort künftig mein Auto abstellen zu können.</p></li></ul></div></section>
<section id="_domain_driven_design_übung_4"><h2>Domain Driven Design: Übung</h2><div class="ulist"><ul><li><p><strong>US-11</strong>: Als Parkhausbetreiber möchte ich online eine Statistik über die durchschnittliche Parkdauer an einem Standort erhalten, um meine Angebote besser zuschneiden zu können.</p></li><li><p><strong>US-12</strong>: Als Kunde möchte ich ein Ticket am Automaten bar bezahlen können, um anschließend aus dem Parkhaus herausfahren zu können.</p></li><li><p><strong>US-13</strong>: Als Kunde möchte ich ein Ticket am Automaten mit Kreditkarte bezahlen können, um anschließend aus dem Parkhaus herausfahren zu können.</p></li><li><p><strong>US-14</strong>: Als Kunde möchte ich die verschlossene Eingangstür zum Parkhaus mit meinem Ticket oder Dauerparkausweis öffnen können.</p></li><li><p><strong>US-15</strong>: Als Kunde möchte ich meinen Dauerparkausweis monatlich per Kreditkarte bezahlen, um nicht in Verzug zu geraten.</p></li><li><p><strong>US-16</strong>: Als Kunde möchte ich die hinterlegte eMail-Adresse zu meinem Dauerparkausweis ändern, um zeitnah über neue AGB benachrichtigt zu werden.</p></li></ul></div></section>
<section id="_api_design"><h2>API Design</h2><div class="ulist checklist"><ul class="checklist"><li><p><i class="icon-check"></i>Wie sollen die Schnittstellen aussehen?</p></li></ul></div></section>
<section id="_api_design_einflussfaktoren" class="columns"><h2>API Design: Einflussfaktoren</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Öffentlich vs. intern</strong></p><div class="ulist"><ul><li><p>Änderbarkeit</p></li><li><p>Technologien</p></li></ul></div></li><li><p><strong>Generisch vs. client-spezifisch</strong></p><div class="ulist"><ul><li><p>Wartungsaufwand</p></li><li><p>Verständlichkeit</p></li><li><p>Information Hiding</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Fein- vs. grobgranular</strong></p><div class="ulist"><ul><li><p>Datenmenge</p></li><li><p>Anzahl Calls</p></li><li><p>Kaskadierung</p></li></ul></div></li><li><p><strong>Blocking vs. non-blocking</strong></p><div class="ulist"><ul><li><p>Technologien</p></li><li><p>Prozessablauf</p></li></ul></div></li></ul></div></div></div></section>
<section id="_api_design_prinzipien"><h2>API Design: Prinzipien</h2><div class="ulist"><ul><li><p>Domänenorientierung</p></li><li><p>Lose Kopplung</p></li><li><p>Idempotenz</p></li><li><p>Abwärtskompatibilität oder Versionierung</p></li></ul></div></section>
<section id="_api_design_technologien" class="columns"><h2>API Design: Technologien</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>REST</strong></p><div class="ulist"><ul><li><p>Representational State Transfer</p></li><li><p>Architekturstil</p></li><li><p>Ressourcenorientiert</p></li><li><p>Hypermedia</p></li><li><p>OpenAPI</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>SOAP</strong></p><div class="ulist"><ul><li><p>Ursprünglich: Simple Object Access Protocol</p></li><li><p>Nachrichtenformat (XML)</p></li><li><p>Dokumenten- und funktionsorientiert</p></li><li><p>WS-* Erweiterungen</p></li><li><p>WSDL</p></li></ul></div></li></ul></div></div></div></section>
<section id="_api_design_technologien_2" class="columns"><h2>API Design: Technologien</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Binäres RPC</strong></p><div class="ulist"><ul><li><p>Funktionsorientiert</p></li><li><p>Hohe Performance</p></li><li><p>Technologien: gRPC, Apache Thrift</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Messaging</strong></p><div class="ulist"><ul><li><p>Austausch von Nachrichten über Broker</p></li><li><p>Lose Kopplung</p></li><li><p>Technologien: Apache ActiveMQ, Apache Kafka</p></li></ul></div></li></ul></div></div></div></section>
<section id="_api_design_microservice_api_patterns"><h2>API Design: Microservice API Patterns</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Our Microservice API Patterns (MAP) distill <strong>proven solutions</strong> to <strong>recurring service interface design and specification problems</strong>
such as finding well-fitting service granularities, promoting independence among services, or managing the evolution of a microservice API.</p></div></blockquote><div class="attribution">&#8212; microservice-api-patterns.org</div></div></section>
<section id="_api_design_microservice_api_patterns_2"><h2>API Design: Microservice API Patterns</h2><div class="ulist"><ul><li><p><a href="https://microservice-api-patterns.org" class="bare">https://microservice-api-patterns.org</a></p></li><li><p>Aktuell in Entwicklung befindlich</p></li><li><p>Fragestellungen</p><div class="ulist"><ul><li><p>Wie viele Schnittstellen sollten als API verfügbar sein?</p></li><li><p>Wie kann eine möglichst lose Kopplung erreicht werden?</p></li><li><p>Welche Daten sollten ausgetauscht werden und wie oft?</p></li><li><p>Wie sollten Nachrichten aussehen?</p></li></ul></div></li></ul></div></section>
<section id="_api_design_microservice_api_patterns_3"><h2>API Design: Microservice API Patterns</h2><div class="imageblock" style=""><img src="images/lesson02/MAP.png" alt="MAP" height="900"></div></section>
<section id="_api_design_api_description_foundation"><h2>API Design: API Description (Foundation)</h2><div class="ulist"><ul><li><p>Kontext</p><div class="ulist"><ul><li><p>Bereitstellung einer neuen API</p></li><li><p>Verwendung nicht allgemein bekannt</p></li></ul></div></li><li><p>Problem</p><div class="ulist"><ul><li><p>Wie kann die Nutzung der API explizit dokumentiert werden?</p></li><li><p>Wie kann die Dokumentation mit anderen Spezifikationen verbunden werden?</p></li></ul></div></li><li><p>Lösung</p><div class="ulist"><ul><li><p>Bereitstellung einer strukturierten API Beschreibung</p></li><li><p>Umsetzung: OpenAPI (REST), JSON API (REST), WSDL (SOAP)</p></li></ul></div></li></ul></div></section>
<section id="_api_design_pagination_structure"><h2>API Design: Pagination (Structure)</h2><div class="ulist"><ul><li><p>Kontext</p><div class="ulist"><ul><li><p>Bei Abruf eines Service werden viele Daten übermittelt</p></li><li><p>Client benötigt nur einen Teil davon</p></li></ul></div></li><li><p>Problem</p><div class="ulist"><ul><li><p>Wie kann der Abruf so eingeschränkt werden, dass der Client nur einen Teil der Daten erhält?</p></li></ul></div></li><li><p>Lösung</p><div class="ulist"><ul><li><p>Auslieferung der Daten in Chunks</p></li><li><p>Übermittlung eines Links zu weiteren Daten</p></li><li><p>Umsetzung: Hypermedia (REST)</p></li></ul></div></li></ul></div></section>
<section id="_api_design_api_key_quality"><h2>API Design: API Key (Quality)</h2><div class="ulist"><ul><li><p>Kontext</p><div class="ulist"><ul><li><p>Service wird per Aufruf bezahlt</p></li><li><p>Verwendung eines Service muss einem Benutzer zugeordnet werden können</p></li><li><p>Einsatz eines Auth Frameworks zu umständlich</p></li></ul></div></li><li><p>Problem</p><div class="ulist"><ul><li><p>Wie kann ein Service Benutzer erkennen?</p></li></ul></div></li><li><p>Lösung</p><div class="ulist"><ul><li><p>Übermittlung eines API Keys (Token) durch den Benutzer</p></li><li><p>Umsetzung: HTTP Header, Cookie, Query Parameter</p></li></ul></div></li></ul></div></section>
<section id="_api_design_version_identifier_evolution"><h2>API Design: Version Identifier (Evolution)</h2><div class="ulist"><ul><li><p>Kontext</p><div class="ulist"><ul><li><p>API erfährt Breaking Changes</p></li><li><p>Alte Clients müssen weiterhin unterstützt werden</p></li></ul></div></li><li><p>Problem</p><div class="ulist"><ul><li><p>Wie können alte und neue API zeitgleich existieren?</p></li></ul></div></li><li><p>Lösung</p><div class="ulist"><ul><li><p>Versionierung der API</p></li><li><p>Umsetzung: URI, Payload</p></li></ul></div></li></ul></div></section>
<section id="_api_design_openapi"><h2>API Design: OpenAPI</h2><div class="ulist"><ul><li><p>Spezifikation zur Beschreibung von REST APIs</p></li><li><p>Vorläufer: Swagger</p></li><li><p>Contract First vs. Code First</p></li><li><p>YAML oder JSON</p></li><li><p>Java Annotations</p></li></ul></div></section>
<section id="_api_design_openapi_2"><h2>API Design: OpenAPI</h2><div class="paragraph heading"><p>YAML</p></div>
<pre class="CodeRay listingblock"><code class="yaml language-yaml">    <span class="key">openapi</span>: <span class="string"><span class="content">3.0.0</span></span>
    <span class="key">info</span>:
      <span class="key">title</span>: <span class="string"><span class="content">Sample Resource</span></span>
      <span class="key">description</span>: <span class="string"><span class="content">Sample API to demonstrate OpenAPI annotations.</span></span>
      <span class="key">version</span>: <span class="string"><span class="content">1.0</span></span>
    <span class="key">servers</span>:
      - <span class="string"><span class="content">url: http://api.anderscore.com.com/v1</span></span>
        <span class="key">description</span>: <span class="string"><span class="content">anderScore public API</span></span>
      - <span class="string"><span class="content">url: http://staging-api.anderscore.com</span></span>
        <span class="key">description</span>: <span class="string"><span class="content">anderScore staging environment</span></span>
    <span class="key">paths</span>:
      <span class="key">/users</span>:
        <span class="key">get</span>:
          <span class="key">summary</span>: <span class="string"><span class="content">Get all users.</span></span>
          <span class="key">description</span>: <span class="string"><span class="content">Get all persisted anderScore users.</span></span>
          <span class="key">responses</span>:
            <span class="key"><span class="delimiter">'</span><span class="content">200</span><span class="delimiter">'</span></span>:    <span class="comment"># status code</span>
              <span class="key">description</span>: <span class="string"><span class="content">A JSON array of user names</span></span>
              <span class="key">content</span>:
                <span class="key">application/json</span>:
                  <span class="key">schema</span>:
                    <span class="key">type</span>: <span class="string"><span class="content">array</span></span>
                    <span class="key">items</span>:
                      <span class="key">type</span>: <span class="string"><span class="content">string</span></span></code></pre></section>
<section id="_api_design_openapi_3"><h2>API Design: OpenAPI</h2><div class="paragraph heading"><p>Annotations</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@OpenAPIDefinition</span> (info =
    <span class="annotation">@Info</span>(
              title = <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Resource</span><span class="delimiter">&quot;</span></span>,
              version = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>,
              description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample API to demonstrate OpenAPI annotations</span><span class="delimiter">&quot;</span></span>,
              license = <span class="annotation">@License</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Apache 2.0</span><span class="delimiter">&quot;</span></span>, url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://foo.bar</span><span class="delimiter">&quot;</span></span>),
              contact = <span class="annotation">@Contact</span>(url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com</span><span class="delimiter">&quot;</span></span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Daniel Krämer</span><span class="delimiter">&quot;</span></span>, email = <span class="string"><span class="delimiter">&quot;</span><span class="content">daniel.kraemer@anderscore.com</span><span class="delimiter">&quot;</span></span>)
      )
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleResource</span> {

    <span class="annotation">@GET</span>
    <span class="annotation">@Operation</span>(summary = <span class="string"><span class="delimiter">&quot;</span><span class="content">Get all users</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Get all persisted anderScore users</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Response getUsers() {
        <span class="comment">// ...</span>
    }
}</code></pre></section>
<section id="_der_weg_zur_makro_architektur"><h2>Der Weg zur Makro-Architektur</h2><div class="olist arabic"><ol class="arabic"><li><p>Fachlicher Schnitt der Microservices nach Domain Driven Design</p><div class="ulist"><ul><li><p>Ermittlung der Bounded Contexts</p></li><li><p>Ableiten der Context Map</p></li></ul></div></li><li><p>Bestimmung der Qualitätsanforderungen und Einflussfaktoren</p></li><li><p>Auswahl geeigneter Technologien</p></li><li><p>Definition der APIs</p><div class="ulist"><ul><li><p>Orientierung an Use Cases und DDD Services</p></li><li><p>Verwendung von Patterns</p></li></ul></div></li><li><p>Dokumentation</p></li></ol></div></section>
<section id="_übung"><h2>Übung</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie den <code>AbrechnungService</code>:</p><div class="ulist"><ul><li><p>Erstellen Sie einen REST Microservice mit dem Spring Boot Initializr.</p></li><li><p>Stellen Sie eine API bereit, mit der ein Parkticket vom Automaten als bezahlt deklariert werden kann.</p></li><li><p>Sehen Sie eine API vor, mit welcher sich die erfolgte Bezahlung eines Tickets überprüfen lässt.</p></li></ul></div></li><li><p>Erstellen Sie den <code>ZugangskontrollService</code></p><div class="ulist"><ul><li><p>Generieren Sie einen weiteren Microservice.</p></li><li><p>Bieten Sie der Schranke eine API zum Prüfen eines Tickets an. Das Ergebnis kann "EXIT GRANTED" oder "EXIT DENIED" lauten.</p></li><li><p>Fragen Sie zur Ermittlung des Ergebnisses die Bezahlung beim <code>AbrechnungService</code> ab.</p></li><li><p>Was passiert, wenn der <code>AbrechnungService</code> nicht verfügbar ist? Wie gehen Sie damit um?</p></li></ul></div></li><li><p>Testen Sie ihre Anwendung mit cURL oder SoapUI.</p></li><li><p>Bonus: Dokumentieren Sie die APIs mit OpenAPI.</p></li><li><p>Bonus: Implementieren Sie auch den Rest der Parkhausanwendung!</p></li></ol></div></section>
<section id="_übung_2"><h2>Übung</h2><div class="paragraph heading"><p>Context Map</p></div>
<div class="imageblock" style=""><img src="images/lesson02/ContextMapParkhaus.png" alt="ContextMapParkhaus" height="400"></div></section>
<section id="_mikro_architektur"><h2>Mikro-Architektur</h2><div class="ulist"><ul><li><p>Architektur einzelner Services</p></li><li><p>Verantwortung des jeweiligen Teams</p></li><li><p>Vorgaben des Architekten</p><div class="ulist"><ul><li><p>Erlaubte Technologien und Frameworks</p></li><li><p>Schnittstellen</p></li></ul></div></li><li><p>Mögliche Herangehensweise: Domain Driven Design</p></li></ul></div></section>
<section id="_mikro_architektur_2" class="columns"><h2>Mikro-Architektur</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>Hexagonale Architektur</p></div>
<div class="ulist"><ul><li><p>Synonyme: Ports and Adapters, Zwiebelarchitektur</p></li><li><p>Strikte Trennung von Fachlichkeit und Technik</p></li><li><p>Dependency Inversion (DIP)</p></li><li><p><strong>Domain</strong>: Daten und Geschäftslogik</p></li><li><p><strong>Service</strong>: Orchestrierung der Geschäftslogik</p></li><li><p><strong>Infrastruktur</strong>: Externe Kommunikation</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/HexagonaleArchitektur.png" alt="HexagonaleArchitektur" width="500"></div></section>
<section id="_mikro_architektur_3" class="columns"><h2>Mikro-Architektur</h2><div class="openblock"><div class="content"><div class="paragraph heading"><p>Hexagonale Architektur</p></div>
<div class="ulist"><ul><li><p>Ports</p><div class="ulist"><ul><li><p>Anknüpfungspunkte</p></li><li><p>Definition durch innere Schichten</p></li></ul></div></li><li><p>Adapters</p><div class="ulist"><ul><li><p>Konterpart der Ports</p></li><li><p>Implementierung durch äußere Schichten</p></li><li><p>Aktiv vs. passiv</p></li></ul></div></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson02/HexagonaleArchitektur.png" alt="HexagonaleArchitektur" width="500"></div></section>
<section id="_ausblick_microservices_im_unternehmenseinsatz"><h2>Ausblick: Microservices im Unternehmenseinsatz</h2><div class="ulist"><ul><li><p>Stack</p><div class="ulist"><ul><li><p>Spring Boot oder MicroProfile (z.B. Quarkus)</p></li><li><p>REST + OAuth oder Apache Kafka</p></li></ul></div></li><li><p>Resilienz</p><div class="ulist"><ul><li><p>Circuit Breaker</p></li><li><p>Client-side Load Balancing</p></li></ul></div></li><li><p>Paketierung und Deployment</p><div class="ulist"><ul><li><p>Executable jar</p></li><li><p>Docker</p></li><li><p>Kubernetes oder Docker Swarm</p></li></ul></div></li><li><p>Zentrales Monitoring und Logging</p><div class="ulist"><ul><li><p>Prometheus, Grafana</p></li><li><p>ElasticSearch, LogStash, Kibana</p></li></ul></div></li></ul></div></section>
<section id="_zusammenfassung_microservices"><h2>Zusammenfassung Microservices</h2><div class="ulist"><ul><li><p>Form der Modularisierung</p></li><li><p>Herausforderungen eines verteilten Systems!</p></li><li><p>Schnitt mittels Domain Driven Design</p></li><li><p>Abgrenzung mittels Bounded Contexts und Context Map</p></li><li><p>Vielseitige Integrationsmöglichkeiten</p></li><li><p>Microservice API Patterns</p></li></ul></div></section>
<section id="_lektion_3_spring_boot" data-state="no-title-footer"><h2>Lektion 3 - Spring Boot</h2></section>
<section><section id="_spring_boot"><h2>Spring-Boot</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications
that you can "just run".</p></div>
<div class="paragraph"><p>We take an opinionated<sup>*</sup>
view of the Spring platform and third-party libraries so you can get
started with minimum fuss. Most Spring Boot applications need very little Spring configuration.</p></div></blockquote><div class="attribution">&#8212; <a href="https://spring.io/projects/spring-boot" class="bare">https://spring.io/projects/spring-boot</a></div></div><div class="paragraph"><p><sup>*</sup>: eigensinnig, rechthaberisch</p></div></section><section id="_was_bringt_spring_boot"><h2>Was bringt Spring Boot?</h2><div class="ulist"><ul><li><p>Aufeinander abgestimmte Bibliotheksabhängigkeiten</p></li><li><p>Sinnvolle Vorgaben für automatische Konfiguration</p></li><li><p>Einheitliche Verwaltung von Einstellungen</p></li><li><p>Entwicklung und Ausführung ohne separaten Application-Server (dank <em>fat jars</em>)</p></li><li><p>Tools für Entwicklung und Monitoring</p></li></ul></div></section><section id="_woraus_besteht_spring_boot"><h2>Woraus besteht Spring Boot?</h2><div class="ulist"><ul><li><p>Große Sammlung aufeinander abgestimmter Open-Source Bibliotheksversionen</p></li><li><p>Sinnvolle Zusammenstellungen von Bibliotheken für verschiedene Anwendungsbereiche (<em>Starter</em>)</p></li><li><p>Plugins und Konfigurationseinstellungen für Gradle und Maven</p></li><li><p>Module zur automatischen Konfiguration</p></li></ul></div>
<div class="paragraph"><p>Für den Schnelleinstieg:</p></div>
<div class="ulist"><ul><li><p><a href="https://start.spring.io/">Spring Initializr</a></p></li><li><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#getting-started-installing-the-cli">Spring Boot CLI</a></p></li></ul></div></section></section>
<section><section id="_überblick_zu_den_aufgaben_dieser_lektion"><h2>Überblick zu den Aufgaben dieser Lektion</h2><div class="paragraph"><p>Wir bauen eine Aufgabenliste, bestehend aus</p></div><div class="ulist"><ul><li><p>einem Backend-Server, der eine REST-Schnittstelle bereitstellt und die
Tasks mittels JPA in einer HSQL-Datenbank speichert</p></li><li><p>einem Frontend-Server, der eine Thymeleaf basierte Oberfläche für
das Backend bereitstellt</p></li></ul></div><div class="paragraph"><p>Ziel ist, zu verstehen, was im Hintergrund tatsächlich passiert, also wie
Spring Boot das Spring-Framework nutzt, um die Funktionalität bereitzustellen.</p></div></section><section id="_vorgehen"><h2>Vorgehen</h2><div class="olist arabic"><ol class="arabic"><li><p>Grundgerüst der Applikation mit Spring Initializr anlegen</p></li><li><p>Persistenzschicht implementieren</p></li><li><p>REST-Controller für Backend implementieren</p></li><li><p>Frontend implementieren</p></li></ol></div></section></section>
<section id="_spring_initializr" class="columns"><h2>Spring Initializr</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Web-Anwedung, mit der man<br>
ein ausführbares Grundgerüst<br>
einer Spring-Boot Applikation<br>
erstellen kann</p></li><li><p>In IDEs integriert<br>
(Spring-Tool-Suite,<br>
IntelliJ IDEA)</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson03/SpringInitializr.png" alt="SpringInitializr"></div></section>
<section><section id="_aufgabe_1_grundgerüst_einer_spring_boot_applikation_erstellen_und_ergründen"><h2>Aufgabe 1: Grundgerüst einer Spring-Boot Applikation erstellen und ergründen</h2><div class="paragraph heading"><p>Schritt 1: Spring Initializr</p></div><div class="paragraph"><p>Erstellen Sie mit Spring Initializr (<a href="https://start.spring.io/" class="bare">https://start.spring.io/</a>) eine Spring-Boot
Anwendung mit folgenden Einstellungen:</p></div><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:28.5714%"><col style="width:71.4286%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Einstellungen:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Java/Maven-Projekt mit Java-Version 11</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Group:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>spring-training</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Artifact:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>lesson03-backend-rest</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Package:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>boot.backend</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Dependencies:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Web, JPA, HSQLDB, Actuator, DevTools</p></div></div></td></tr></table><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content"><em>"Depedencies/See all"</em> zeigt alle verfügbaren Abhängigkeiten</td></tr></table></div></section><section id="_schritt_2_applikation_ausführen"><h2>Schritt 2: Applikation ausführen</h2><div class="olist arabic"><ol class="arabic"><li><p>Packen Sie das heruntergeladene Projekt aus, bauen Sie es mit <code>mvn clean verify</code>
und führen Sie es mit <code>mvn spring-boot:run</code> aus.</p></li><li><p>Sehen Sie sich die Logausgaben an. Welche Informationen können Sie daraus ziehen?</p></li><li><p>Öffnen Sie <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a> im Browser.</p></li><li><p>Probieren Sie auch mal <a href="http://localhost:8080/actuator" class="bare">http://localhost:8080/actuator</a>. Was können Sie damit machen?</p></li></ol></div></section><section id="_schritt_3_implementierung_verstehen"><h2>Schritt 3: Implementierung verstehen</h2><div class="olist arabic"><ol class="arabic"><li><p>Beenden Sie nun die Applikation mit <strong>Strg-C</strong> und importieren Sie das Projekt in Ihre IDE.<br>
Alternativ können Sie auch direkt das Projekt <strong>lesson03-boot-backend-rest</strong> öffnen.</p></li><li><p>Woraus besteht das Projekt?</p></li><li><p>Sehen Sie sich die <strong>pom.xml</strong> an. Welche Teile davon sind Spring-Boot spezifisch?</p></li><li><p>Öffnen Sie die <code>Lesson03BootBackendApplication</code> Klasse. Was fällt Ihnen daran auf?</p></li><li><p>Wozu nützt der <code>Lesson03BootBackendApplicationTests</code>?</p></li></ol></div></section><section id="_schritt_4_konfiguration_anpassen"><h2>Schritt 4: Konfiguration anpassen</h2><div class="paragraph"><p>Spring Boot Applikationen werden über die <code>application.properties</code> konfiguriert. Details dazu finden
Sie im Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config">Externalized Configuration</a>
des <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle">Spring Boot Reference Guide</a>. Der Anhang
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties">Common application properties</a>
gibt einen groben Überblick über die Stellschrauben von Spring Boot.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Tragen Sie nun <code>debug=true</code> in die <code>application.properties</code> ein und führen Sie <code>Lesson03BootBackendApplicationTests</code> aus.</p></li><li><p>In den Logausgaben erscheint jetzt ein <strong>CONDITIONS EVALUATION REPORT</strong>. Was besagt dieser Report?</p></li></ol></div>
<div class="openblock teacherBox"><div class="content"><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Mit <strong>Spring Tool Suite 4</strong> funktioniert die Code-Completion nur, wenn der <strong>Spring Boot Validations Builder</strong>
registiert ist. Andernfalls muss man <code>.project</code> um folgenden Eintrag ergänzen und einen <strong>Restart</strong> durchführen:</td></tr></table></div>
<div class="literalblock"><div class="content"><pre>&lt;buildCommand&gt;
    &lt;name&gt;org.springframework.ide.eclipse.boot.validation.springbootbuilder&lt;/name&gt;
    &lt;arguments&gt;
    &lt;/arguments&gt;
&lt;/buildCommand&gt;</pre></div></div></div></div></section><section id="_schritt_5_actuator_endpoints_ergründen"><h2>Schritt 5: Actuator-Endpoints ergründen</h2><div class="paragraph"><p>Sie haben zuvor nur einen kleinen Teil der verfügbaren Actuator-Endpoints gesehen.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Fügen Sie <code>management.endpoints.web.exposure.include=*</code> in die <code>application.properties</code> ein, um alle Endpoints zu sehen.</p></li><li><p>Starten Sie die Applikation und öffnen Sie erneut <a href="http://localhost:8080/actuator/" class="bare">http://localhost:8080/actuator/</a>.</p></li><li><p>Ergründen Sie die verschiedenen Endpunkte. Warum sind nicht standardmäßig alle Endpunkte verfügbar?</p></li><li><p>Optional: Verwenden Sie <strong>jconsole</strong>, um die Actuator JMX-Beans zu ergründen.</p></li></ol></div>
<div class="paragraph"><p>Weitere Informationen zu Actuator finden Sie der Referenz-Doku, Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">
Spring Boot Actuator: Production-ready features</a>.</p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Mit Firefox sind Links in dem zurückgegebenen JSON navigierbar.</td></tr></table></div></section><section id="_schritt_6_logausgaben_in_eine_datei_umlenken"><h2>Schritt 6: Logausgaben in eine Datei umlenken</h2><div class="paragraph"><p>Standardmäßig erscheinen bei Spring-Boot alle Logausgaben auf der Konsole.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Lenken Sie mit <code>logging.file.path=target/app.log</code> die Logausgaben zusätzlich in eine Datei um.</p></li><li><p>Starten Sie die Applikation neu prüfen Sie den Inhalt der Logdatei.</p></li><li><p>Vewenden Sie auch den <a href="http://localhost:8080/actuator/logfile" class="bare">http://localhost:8080/actuator/logfile</a> Link.</p></li></ol></div>
<div class="paragraph"><p>Weitere Hinweise dazu finden Sie in der Referenz-Doku, Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-logging-file-output">Logging/File Output</a>.</p></div></section></section>
<section><section id="_spring_boot_features"><h2>Spring Boot Features</h2><div class="paragraph"><p>Spring-Boot bringt einige Features mit, die wir uns im folgenden genauer ansehen.<br>
Einige davon haben wir bereits kennengelernt.</p></div></section><section id="_actuator"><h2>Actuator</h2><div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">Actuator</a>
bietet Features für den Betrieb:</p></div>
<div class="ulist"><ul><li><p>Monitoring</p></li><li><p>Management</p></li><li><p>Endpoints per JMX oder REST</p></li><li><p><a href="https://micrometer.io/">Micrometer</a> Support, siehe Referenz-Doku, Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready-metrics">Metrics</a></p></li></ul></div></section><section id="_developer_tools_und_live_reload"><h2>Developer Tools und Live-Reload</h2><div class="paragraph"><p>Mit den <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-devtools">Developer Tools</a>
werden Änderungen ohne Neustart der Applikation sichtbar</p></div>
<div class="ulist"><ul><li><p>Arbeitet mit 2. <em>ClassLoader</em> für geänderte Klassen</p></li><li><p>Führt bei Änderungen automatisch einen Restart durch, d. h. der <em>ApplicationContext</em> wird neu initialisiert,
ohne dass alle Klassen neu geladen werden müssen</p></li><li><p>Unterstützt <a href="http://livereload.com/extensions/">LiveReload</a> (ein Browser-Plugin, welches den Klick auf den Refresh-Button erspart)</p></li><li><p>Ist kein vollwertiger Ersatz für <a href="https://jrebel.com/software/jrebel/">JRebel</a></p></li></ul></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Bei IntelliJ ist ein expliziter Rebuild (Ctrl-Shift-F9) notwendig, um einen Restart auszulösen</td></tr></table></div></section><section id="_parent_pom_und_dependencies"><h2>Parent-POM und Dependencies</h2><div class="paragraph"><p>Das Spring-Boot Parent-POM liefert sinnvolle Voreinstellung, Maven-Plugins und aufeinander abgestimmte
Versionen für 3<sup>rd</sup> Party Bibliotheken:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;parent&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.7.4<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;relativePath</span> <span class="tag">/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="tag">&lt;/parent&gt;</span></code></pre>
<div class="paragraph"><p>Alternativ kann man nur die aufeinander abgestimmten Abhängigkeiten verwenden
(das erspart Versionsangaben). Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-maven-without-a-parent">
Using Spring Boot without the Parent POM</a> in Referenz-Doku:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-dependencies<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.7.4<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre></section><section id="_spring_boot_maven_plugin"><h2>Spring-Boot Maven-Plugin</h2><div class="paragraph"><p>Man bindet es folgendermaßen ein:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
        <span class="tag">&lt;plugin&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
<div class="paragraph"><p>Es bietet:</p></div>
<div class="ulist"><ul><li><p>Erstellung ausführbarer "fat" JARs</p></li><li><p>Ausführung mit <code>mvn spring-boot:run</code></p></li></ul></div>
<div class="paragraph"><p>Siehe auch <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-running-with-the-maven-plugin">
Using the Maven Plugin</a> in der Referenz-Doku.</p></div></section><section id="_weitere_unterstützung_beim_build"><h2>Weitere Unterstützung beim Build</h2><div class="ulist"><ul><li><p>Erzeugung von <code>META-INF/build-info.properties.</code> Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-build-info">
Generate Build Information</a>.</p></li><li><p>Erzeugung von <code>git.properties</code>. Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-git-info">
Generate Git Information</a>.</p></li><li><p>Anpassung einzelner Bibliotheksversionen. Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-customize-dependency-versions">
Customize Dependency Versions</a>.</p></li><li><p>Erstellung einer <strong>WAR</strong> Datei. Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-create-a-deployable-war-file">
Create a Deployable War File</a>.</p></li></ul></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Alle bisher genannten Features sind auch für <em>Gradle</em> verfügbar.</td></tr></table></div></section><section id="_springbootapplication"><h2>@SpringBootApplication</h2><div class="paragraph"><p>Meta-Annotation für:</p></div>
<div class="title">org.springframework.boot.autoconfigure.SpringBootApplication</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootConfiguration</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@EnableAutoConfiguration</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@ComponentScan</span>(excludeFilters = {
        <span class="annotation">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="annotation">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Marker für Tests, sonst wie <code>@Configuration</code></td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Auto-Konfiguration aktivieren</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Verarbeitet alle TypeExcludeFilter Beans (nützlich fürs Testen)</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Auto-Config-Klassen ausschließen</td></tr></table></div>
<div class="paragraph"><p>Wichtigster Parameter ist <code>exclude</code>, um einzelne Autokonfigurationen auszuschließen.<br>
&#8594; <a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/autoconfigure/SpringBootApplication.html">Javadocs</a>.</p></div></section><section id="_application_klasse_standalone"><h2>Application Klasse (Standalone)</h2><div class="paragraph"><p>In der Regel ist eine Spring-Boot Applikation eine Config-Klasse mit einer <code>main</code> Methode:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBootApplication</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = <span class="predefined-type">LogManager</span>.getLogger(MyBootApplication.class);

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(MyBootApplication.class, args);
    }
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/SpringApplication.html">
&#8594; Javadocs: SpringApplication</a></p></div></section><section id="_application_klasse_mit_angepassten_einstellungen"><h2>Application Klasse mit angepassten Einstellungen</h2><div class="paragraph"><p>Wenn man spezielle Einstellungen benötigt, kann man <code>SpringApplication</code> auch selbst erzeugen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyCustomizedBootApplication</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = <span class="predefined-type">LogManager</span>.getLogger(MyCustomizedBootApplication.class);

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication application = <span class="keyword">new</span> SpringApplication(MyCustomizedBootApplication.class);
        customize(application);
        application.run();
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> customize(SpringApplication application) {
        application.addListeners(<span class="keyword">new</span> ApplicationListener&lt;ApplicationEvent&gt;() {

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(ApplicationEvent event) {
                log.info(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Application Event: </span><span class="delimiter">&quot;</span></span> + event);
            }
        });
    }
}</code></pre></section><section id="_application_klasse_war"><h2>Application Klasse (WAR)</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBootWebApplication</span> <span class="directive">extends</span> SpringBootServletInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
        <span class="keyword">return</span> builder.sources(MyBootWebApplication.class); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) { <i class="conum" data-value="2"></i><b>(2)</b>
        SpringApplication.run(MyBootWebApplication.class, args);
    }
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Zeigt, wie man eine Konfigurationsklasse hinzufügt. (Nicht notwendig, wenn <code>SpringBootServletInitializer</code> selbst eine
Konfigurationsklasse ist.)</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Dank der <code>main</code> Methode ist für die Entwicklung kein Application-Server notwendig.</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-create-a-deployable-war-file">
&#8594; Boot Reference: Create a Deployable War File</a><br>
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/web/servlet/support/SpringBootServletInitializer.html">
&#8594; Javadocs: SpringBootServletInitializer</a><br>
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/builder/SpringApplicationBuilder.html">
&#8594; Javadocs: SpringApplicationBuilder</a></p></div></section><section id="_commandlinerunner"><h2>CommandLineRunner</h2><div class="paragraph"><p>Beans, die das <code>CommandLineRunner</code> Interface implementieren werden unmittelbar nach Initialisierung
des <code>ApplicationContext</code> ausgeführt.</p></div>
<div class="paragraph"><p>Die Ausführungsreihenfolge kann man über die <code>@Order</code> Annotation oder das <code>Ordered</code> Interface beeinflussen.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
CommandLineRunner commandLineArgsInitializer() {
    <span class="keyword">return</span> <span class="keyword">new</span> CommandLineRunner() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> run(<span class="predefined-type">String</span>... args) <span class="directive">throws</span> <span class="exception">Exception</span> {
            log.info(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Command-Line: </span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.toString(args));
        }
    };
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/CommandLineRunner.html">&#8594; Javadocs</a></p></div></section><section id="_applicationrunner"><h2>ApplicationRunner</h2><div class="paragraph"><p><code>ApplicationRunner</code> unterscheidet sich von <code>CommandLineRunner</code> nur dadurch, dass aus den Befehlszeilenargumenten
bereits die Optionen herausgefiltert sind.<br>
Optionen sind Argumente der Form <code>--opt=wert</code>.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
ApplicationRunner interpretedArgsInitializer() {
    <span class="keyword">return</span> <span class="keyword">new</span> ApplicationRunner() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> run(ApplicationArguments args) <span class="directive">throws</span> <span class="exception">Exception</span> {
            log.info(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Options: </span><span class="delimiter">&quot;</span></span> + args.getOptionNames().stream()
                    .map(name -&gt; name + <span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + args.getOptionValues(name))
                    .collect(Collectors.joining(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)));
        }
    };
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/ApplicationRunner.html">&#8594; Javadocs</a><br>
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/ApplicationArguments.html#getOptionValues-java.lang.String-">
&#8594; Javadocs zu getOptionValues</a></p></div></section><section id="_spring_boot_tests"><h2>Spring Boot Tests</h2><div class="paragraph"><p><code>@SpringBootTest</code> ist Meta-Annotation für:</p></div>
<pre class="CodeRay listingblock"><code>@BootstrapWith(SpringBootTestContextBootstrapper.class)
@ExtendWith(SpringExtension.class)</code></pre>
<div class="ulist"><ul><li><p>Für JUnit-4 ist zusätzlich <code>@RunWith(SpringRunner.class)</code> notwendig.</p></li><li><p>Sucht im gleichen Package nach <code>@SpringBootConfiguration</code> und verwendet diese.<br>
(Deswegen sollte es nur eine Config-Klasse geben, die mit <code>@SpringBootConfiguration</code> annotiert ist.)</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/test/context/SpringBootTestContextBootstrapper.html">
&#8594; Javadocs: SpringBootTestContextBootstrapper</a></p></div></section></section>
<section><section id="_externe_konfiguration_2"><h2>Externe Konfiguration</h2><div class="paragraph heading"><p>Rangfolge für Einstellungen (Auszug):</p></div><div class="olist arabic"><ol class="arabic"><li><p>Befehlszeilenargumente (z. B. <code>--server.port=7777</code>)</p></li><li><p><code>ServletConfig</code> bzw. <code>ServletContext</code> Init-Parameter</p></li><li><p>JNDI Attribute von <code>java:comp/env</code></p></li><li><p>System-Properties (z. B. <code>-Dserver.port=7777</code>)</p></li><li><p>Umgebungsvariablen</p></li><li><p><code>application-{profile}.properties</code> im lokalen Verzeichnis</p></li><li><p><code>application-{profile}.properties</code> im JAR</p></li><li><p><code>application.properties</code> im lokalen Verzeichnis</p></li><li><p><code>application.properties</code> im JAR</p></li><li><p>Mit <code>@PropertySource</code> Annotationen an den <code>@Configuration</code> Klassen</p></li><li><p>Default Properties, die mit <code>SpringApplication.setDefaultProperties</code> angegeben wurden</p></li></ol></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config-application-property-files">
&#8594; Reference: Externalized Configuration</a></p></div></section><section id="_application_properties_dateien"><h2>Application Properties Dateien</h2><div class="paragraph"><p>Spring Boot Applikationen suchen die <strong><code>application.properties</code></strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>im <code>/config</code> Unterverzeichnis des aktuellen Verzeichnisses</p></li><li><p>im aktuellen Verzeichnis</p></li><li><p>in einem <code>/config</code> Package im Classpath</p></li><li><p>im Wurzelverzeichnis des Classpath</p></li></ol></div>
<div class="paragraph"><p>Dieses Verhalten lässt sich über <code>spring.config.name</code> und <code>spring.config.location</code> ändern.</p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Alternativ zu '.properties' Dateien kann man auch
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config-yaml">
&#8594; YAML</a> verwenden.</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config">
&#8594; Reference: Application Property Files</a></p></div></section></section>
<section id="_spring_boot_einführung"><h2>Spring Boot Einführung</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0302-jpa.html">&#8594; Weiter zu JPA</a></p></div></section>
<section id="_jpa_und_spring_data" data-state="no-title-footer"><h2>JPA und Spring Data</h2><div class="paragraph center"><p>Wie funktioniert das?</p></div></section>
<section id="_java_persistence_api_jpa_in_stichworten"><h2>Java Persistence API (JPA) in Stichworten</h2><div class="ulist"><ul><li><p>Anbindung relationaler Datenbanken (OR-Mapping)</p></li><li><p>Maßgeblicher Einfluss: <strong>Hibernate</strong></p></li><li><p>Als <a href="https://jcp.org/en/jsr/detail?id=220">&#8594; JSR 220</a> im Jahr 2006 erstmals veröffentlicht</p></li><li><p>Aktuelle Version 3.0 ist 2020 mit <strong>Jakarta EE 9</strong>
offiziell erschienen</p></li><li><p>Inzwischen unter der Obhut der Eclipse Foundation:
<a href="https://projects.eclipse.org/proposals/eclipse-project-jpa">
&#8594; Eclipse Project for JPA</a></p></li><li><p>Heute: "Jakarta Persistence"</p></li></ul></div></section>
<section id="_java_persistence_api_jpa_in_stichworten_2"><h2>Java Persistence API (JPA) in Stichworten</h2><div class="ulist"><ul><li><p>Persistence Provider: Hibernate, EclipseLink, TopLink, OpenJPA</p></li><li><p>Referenzimplementierung: EclipseLink (früher: Hibernate)</p></li><li><p>Datenbankunabhängig</p></li><li><p>Mapping-Metadaten über Java-Annotationen (oder XML)</p></li><li><p>Abfragen über Java Persistence Query Language (JPQL) oder Criteria API</p></li></ul></div></section>
<section id="_wichtige_jpa_annotationen"><h2>Wichtige JPA Annotationen</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Entity</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Markiert Klasse als JPA-Entity</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Table(name="CUST")</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ordnet Datenbanktabelle zu</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Column(name="CUST_ID")</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ordnet Spaltenname zu</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Id</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Markiert Spalte als Primärschlüssel</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@GeneratedValue</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Generiert IDs</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Enumerated(EnumType.STRING)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Enum-Namen als String speichern</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@OneToOne, @OneToMany, @ManyToOne, @ManyToMany</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Beziehungen</p></td></tr></table>
<div class="paragraph"><p><a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/package-summary.html">
&#8594; Java EE 8 API: javax.persistence</a></p></div></section>
<section id="_deklaration_einer_entity"><h2>Deklaration einer Entity</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Entity</span> <span class="comment">// Objekt in eigener Datenbanktabelle speichern</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">TASK</span><span class="delimiter">&quot;</span></span>) <span class="comment">// Tabellename</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TaskEntity</span> {
    <span class="directive">public</span> <span class="type">enum</span> State {
        OPEN, STARTED, DONE
    }

    <span class="annotation">@Id</span> <span class="comment">// Primärschlüssel</span>
    <span class="annotation">@GeneratedValue</span> <span class="comment">// wird automatisch generiert</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">TASK_ID</span><span class="delimiter">&quot;</span></span>) <span class="comment">// expliziter Spaltenname</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> description;
    <span class="directive">private</span> Instant dateDue;
    <span class="annotation">@Enumerated</span>(EnumType.STRING) <span class="comment">// als String speichern</span>
    <span class="directive">private</span> State state;

    <span class="comment">// Getter, Setter, etc.</span>
}</code></pre></section>
<section><section id="_datenbankzugriff_mit_plain_jpa"><h2>Datenbankzugriff mit Plain-JPA</h2><div class="paragraph heading"><p>JPA Begriffe</p></div><div class="dlist"><dl><dt class="hdlist1">Persistence Context</dt><dd><div class="ulist"><ul><li><p>Menge persistenter (eindeutiger) Entity-Objekte (in Memory)</p></li><li><p>Managed Lebenszyklus der Entities</p></li><li><p>Ist mit einer Transaktion verknüpft</p></li></ul></div></dd><dt class="hdlist1"><code>EntityManager</code> Interface</dt><dd><div class="ulist"><ul><li><p>Schnittstelle zur Interaktion mit <em>Persistence Context</em> (CRUD)</p></li><li><p>"Generisches DAO"</p></li></ul></div></dd><dt class="hdlist1">Persistence Unit</dt><dd><div class="ulist"><ul><li><p>Menge der Entities, die vom EntityManager verwaltet werden können</p></li><li><p>Wird durch <code>EntityManagerFactory</code> repräsentiert</p></li></ul></div></dd><dt class="hdlist1">Detached Entites</dt><dd><p>Entity-Objekt, das nicht mit einem <em>Persistence Context</em> verbunden ist (nach Commit)</p></dd></dl></div></section><section id="_wie_kommt_man_an_den_entitymanager_ran"><h2>Wie kommt man an den EntityManager ran?</h2><h level="3">Java EE Umgebung (Container-managed Entity Manager)</h><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PersistenceUnit</span>
EntityManagerFactory emf;

<span class="annotation">@PersistenceContext</span>
ContextEntityManager em;</code></pre>
<h level="3">Java SE (Stand-alone Java-Anwendung)</h><pre class="CodeRay listingblock"><code class="java language-java">EntityManagerFactory emf = javax.persistence.Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Order</span><span class="delimiter">&quot;</span></span>);
EntityManager em = emf.createEntityManager()</code></pre>
<div class="paragraph"><p><a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/package-summary.html">
&#8594; javax.persistence Javadocs</a></p></div></section><section id="_entitymanager_erzeugen_und_datenbankabfrage_ausführen"><h2>EntityManager erzeugen und Datenbankabfrage ausführen</h2><div class="title">PlainJpaTest.java</div><pre class="CodeRay listingblock"><code class="java language-java">EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tasks</span><span class="delimiter">&quot;</span></span>); <span class="comment">// Name der Persistence Unit</span>
EntityManager em = factory.createEntityManager();
<span class="predefined-type">Query</span> query = em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select t from TaskEntity t</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span>&lt;TaskEntity&gt; tasks = query.getResultList();
tasks.forEach(<span class="predefined-type">System</span>.out::println);</code></pre>
<div class="paragraph"><p>Die <em>Persistence Unit</em> wird in <code>META-INF/persistence.xml</code> definiert.</p></div></section><section id="_datenbankverbindung_und_mapping_für_plain_jpa"><h2>Datenbankverbindung und Mapping für Plain-JPA</h2><div class="title">META-INF/persistence.xml</div><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.2</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/persistence</span>
                        <span class="content">http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tasks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class&gt;</span>boot.backend.repository.TaskEntity<span class="tag">&lt;/class&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.driver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbc.JDBCDriver</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:hsqldb:mem:mymemdb</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.HSQLDialect</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
<div class="ulist"><ul><li><p>Datenbankverbindung hart verdrahtet</p></li><li><p>In Java EE Umgebung nicht notwendig</p></li></ul></div></section></section>
<section><section id="_jpa_mit_spring_und_hibernate"><h2>JPA mit Spring und Hibernate</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">public</span> LocalContainerEntityManagerFactoryBean entityManagerFactory() {
    LocalContainerEntityManagerFactoryBean em = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();
    em.setDataSource(dataSource()); <i class="conum" data-value="1"></i><b>(1)</b>
    em.setPackagesToScan(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> { <span class="string"><span class="delimiter">&quot;</span><span class="content">boot.backend.repository</span><span class="delimiter">&quot;</span></span> }); <i class="conum" data-value="2"></i><b>(2)</b>

    JpaVendorAdapter vendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();
    em.setJpaVendorAdapter(vendorAdapter);
    em.setJpaProperties(additionalProperties());

    <span class="keyword">return</span> em;
}

<span class="predefined-type">Properties</span> additionalProperties() {
    <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
    properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.HSQLDialect</span><span class="delimiter">&quot;</span></span>);
    properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> properties;
}</code></pre><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Datenbankverbindung über Spring-Bean (mit entsprechenden Konfigurationsmöglichkeiten)</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Angabe der Entity-Klassen, die zur der <em>Persistence Unit</em> gehören</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Automatische Schemagenierung mit Hibernate</td></tr></table></div></section><section id="_schemagenierung_mit_hibernate"><h2>Schemagenierung mit Hibernate</h2><div class="paragraph"><p>Mögliche Werte für <code>hibernate.hbm2ddl.auto</code>:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:16.6666%"><col style="width:83.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Wert</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Nichts tun</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">validate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Nur Schema validieren, keine Datenbankänderungen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Schema aktualisieren</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Schema neu anlegen, löscht bestehende Daten</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">create-drop</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wie <em>create</em>, löscht das Schema aber sobald die <code>SessionFactory</code> geschlossen wird</p></td></tr></table>
<div class="paragraph"><p><a href="https://stackoverflow.com/questions/438146/hibernate-hbm2ddl-auto-possible-values-and-what-they-do">
&#8594; Hibernate hbm2ddl.auto possible values and what they do?</a></p></div></section><section id="_zugriff_auf_entitymanager_in_einer_spring_anwendung"><h2>Zugriff auf EntityManager in einer Spring-Anwendung</h2><div class="title">SpringJpaTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PersistenceContext</span>
<span class="directive">private</span> EntityManager entityManager;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> test() {
    <span class="predefined-type">Query</span> query = entityManager.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select t from TaskEntity t</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">List</span>&lt;TaskEntity&gt; tasks = query.getResultList();
    tasks.forEach(<span class="predefined-type">System</span>.out::println);
}</code></pre>
<div class="paragraph"><p>Oder alternativ über die <code>EntityManagerFactory</code>:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> EntityManagerFactory entityManagerFactory;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testUsingEntityManagerFactory() {
    EntityManager em = entityManagerFactory.createEntityManager();
    <span class="predefined-type">Query</span> query = em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select t from TaskEntity t</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">List</span>&lt;TaskEntity&gt; tasks = query.getResultList();
    tasks.forEach(<span class="predefined-type">System</span>.out::println);
}</code></pre>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><code>JpaTemplate</code> und <code>JpaDaoSupport</code> sind seit Spring 3.1 deprecated.</td></tr></table></div></section></section>
<section><section id="_jpa_hibernate_vs_plain_hibernate"><h2>JPA (+ Hibernate) vs. Plain-Hibernate</h2><div class="paragraph"><p>Konzepte sind weitgehend identisch!</p></div><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">javax.persistence</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.hibernate</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">EntityManagerFactory</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">SessionFactory</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">EntityManager</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JPQL</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HQL</p></td></tr></table></section><section id="_konfiguration"><h2>Konfiguration</h2><pre class="CodeRay listingblock"><code class="java language-java">    <span class="annotation">@Bean</span>
    <span class="directive">public</span> LocalSessionFactoryBean sessionFactory(<span class="predefined-type">DataSource</span> dataSource) {
        LocalSessionFactoryBean sessionFactory = <span class="keyword">new</span> LocalSessionFactoryBean();
        sessionFactory.setDataSource(dataSource);
        sessionFactory.setPackagesToScan(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.anderscore.hibernate.entity</span><span class="delimiter">&quot;</span></span>);
        sessionFactory.setHibernateProperties(hibernateProperties());

        <span class="keyword">return</span> sessionFactory;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransactionManager txManager(SessionFactory sessionFactory) {
        HibernateTransactionManager tx = <span class="keyword">new</span> HibernateTransactionManager();
        tx.setSessionFactory(sessionFactory);
        <span class="keyword">return</span> tx;
    }

    <span class="directive">private</span> <span class="predefined-type">Properties</span> hibernateProperties() {
        <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>);
        props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.HSQLDialect</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> props;
    }</code></pre></section></section>
<section><section id="_aufgabe_1_jpa_und_hibernate_mit_spring_boot"><h2>Aufgabe 1: JPA und Hibernate mit Spring Boot</h2><div class="paragraph"><p>Gegeben sei folgendes Datenmodell einer Software zur Verwaltung von Trainings:</p></div><div class="imageblock" style=""><img src="images/lesson03/KlassendiagrammJPA.png" alt="KlassendiagrammJPA" height="600"></div></section><section id="_nächste_schritte"><h2>Nächste Schritte</h2><div class="olist arabic"><ol class="arabic"><li><p>Öffnen Sie das Projekt <code>lesson03-boot-jpa</code> und machen Sie sich mit den Entities, den <code>DaoTests</code> und dem
SQL-Skript <code>init-schema.sql</code> vertraut.</p></li><li><p>Versehen Sie die Entities so mit JPA-Annotationen, dass diese zum gegebenen Datenbankschema passen.</p></li><li><p>Implementieren Sie konkrete Klassen zu den DAO-Interfaces, indem Sie den EntityManager injekten
und entsprechend verwenden.</p></li><li><p>Deklarieren Sie Ihre DAO-Implementierungen als Spring Beans.</p></li><li><p>Aktivieren Sie die <code>DaoTests</code>.</p></li><li><p>Führen Sie ein Refactoring durch, sodass die DAOs keine Code-Duplikate mehr enthalten.</p></li><li><p>Optional: Kopieren Sie die Klasse <code>DaoTests</code>, ersetzen Sie <code>@SpringBootTest</code> durch <code>@SpringJUnitTest</code>
und konfigurieren Sie <code>DataSource</code>, <code>LocalContainerEntityManagerFactoryBean</code> und <code>TransactionManager</code> selbst.</p></li><li><p>Optional: Ersetzen Sie JPA + Hibernate durch Plain-Hibernate.</p></li></ol></div></section></section>
<section id="_fetchtype"><h2>FetchType</h2><div class="paragraph heading"><p>Wann abhängige Entities laden?</p></div>
<div class="ulist"><ul><li><p><code>FetchType.EAGER</code></p><div class="ulist"><ul><li><p>Laden mit einbindender Entity</p></li><li><p>Ziel: Reduktion der Queries</p></li><li><p>Herausforderungen: ungenutzte Daten, Speicherverbrauch</p></li><li><p>Default bei <code>@OneToOne</code> und <code>@ManyToOne</code></p></li></ul></div></li><li><p><code>FetchType.LAZY</code></p><div class="ulist"><ul><li><p>Laden erst bei tatsächlichem Zugriff (Proxy)</p></li><li><p>Ziel: Reduktion der Datenmenge</p></li><li><p>Herausforderungen: Hibernate Session, n+1 Issues</p></li><li><p>Default bei <code>@OneToMany</code>, <code>@ManyToMany</code></p></li></ul></div></li><li><p>Gegenstand von Performance-Optimierungen (und Bugs&#8230;&#8203;)</p></li></ul></div></section>
<section id="_fetchtype_2"><h2>FetchType</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Course</span> {

    <span class="annotation">@OneToMany</span>(fetch = FetchType.EAGER)
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Training&gt; trainings;

<span class="comment">// ...</span>
}</code></pre></section>
<section id="_attribute_converter"><h2>Attribute Converter</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Trainee</span> {

    <span class="annotation">@Convert</span>(converter = TraineeNameConverter.class)
    <span class="directive">private</span> TraineeName traineeName;

    <span class="comment">// ...</span>
}</code></pre>
<pre class="CodeRay listingblock java"><code>@Converter
public class TraineeNameConverter implements AttributeConverter&lt;TraineeName, String&gt; {

    @Override
    public String convertToDatabaseColumn(TraineeName traineeName) {
    }

    @Override
    public TraineeName convertToEntityAttribute(String dbTraineeName) {
    }
}</code></pre>
<div class="ulist"><ul><li><p><strong>Problem:</strong> Attribut einer Entity lässt sich nicht auf Spalte abbilden</p></li><li><p><strong>Beispiel:</strong> Vor- und Nachname getrennt vs. zusammen</p></li><li><p><strong>Lösung:</strong> Definition eines eigenen Converters</p></li></ul></div></section>
<section><section id="_spring_data"><h2>Spring Data</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Spring Data’s mission is to provide a familiar and consistent, Spring-based programming model for data access while
still retaining the special traits of the underlying data store.</p></div></blockquote><div class="attribution">&#8212; Spring Data Projektseite</div></div><div class="paragraph"><p><br></p></div><div class="ulist"><div class="title">Wesentliche Features:</div><ul><li><p>Ähnliche Verwendung von SQL und NoSQL Datenbanken</p></li><li><p>Minimierung von "Boilerplate" Code</p></li></ul></div></section><section id="_definition_eines_spring_data_repositorys_für_jpa"><h2>Definition eines Spring Data Repositorys für JPA</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TaskRepository</span> <span class="directive">extends</span>
        JpaRepository&lt;TaskEntity, <span class="predefined-type">Long</span>&gt;, <span class="comment">// Spring Data und JPQL</span>
        JpaSpecificationExecutor&lt;TaskEntity&gt; <span class="comment">// JPA criteria API</span>
{

    <span class="predefined-type">List</span>&lt;TaskEntity&gt; findTaskEntitiesByStateOrderByDateDueDesc(TaskEntity.State state); <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select t from TaskEntity t where t.state = :state order by t.dateDue desc</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">List</span>&lt;TaskEntity&gt; findByJpaqlQuery(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>) TaskEntity.State state);
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Einfache Abfragen generiert Spring-Data direkt aus dem Methodennamen</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Alternativ kann man die JPQL Abfrage über die <code>@Query</code> Annotation angeben</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-data/jpa/docs/2.1.6.RELEASE/reference/html/#repositories.query-methods.details">
&#8594; Spring Data Reference: Defining Query Methods</a></p></div></section><section id="_jparepository"><h2>JpaRepository</h2><div class="paragraph"><p>Das <code>JpaRepository</code> Interface bietet bereits eine Menge vorgefertigter Abfragemethoden:</p></div>
<div class="title">org.springframework.data.jpa.repository.JpaRepository</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@NoRepositoryBean</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">JpaRepository</span>&lt;T, ID&gt; <span class="directive">extends</span> PagingAndSortingRepository&lt;T, ID&gt;, QueryByExampleExecutor&lt;T&gt; {
    <span class="predefined-type">List</span>&lt;T&gt; findAll();

    <span class="predefined-type">List</span>&lt;T&gt; findAll(Sort var1);

    <span class="predefined-type">List</span>&lt;T&gt; findAllById(<span class="predefined-type">Iterable</span>&lt;ID&gt; var1);

    &lt;S <span class="directive">extends</span> T&gt; <span class="predefined-type">List</span>&lt;S&gt; saveAll(<span class="predefined-type">Iterable</span>&lt;S&gt; var1);
    <span class="comment">// ...</span>
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-data/jpa/docs/2.1.6.RELEASE/api/org/springframework/data/jpa/repository/JpaRepository.html">
&#8594; Javadocs</a></p></div></section><section id="_pagingandsortingrepository"><h2>PagingAndSortingRepository</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PagingAndSortingRepository</span>&lt;T, ID <span class="directive">extends</span> <span class="predefined-type">Serializable</span>&gt; <span class="directive">extends</span> CrudRepository&lt;T, ID&gt; {

    <span class="predefined-type">Iterable</span>&lt;T&gt; findAll(Sort sort);

    Page&lt;T&gt; findAll(<span class="predefined-type">Pageable</span> pageable);
}</code></pre></section><section id="_crudrepository"><h2>CrudRepository</h2><div class="paragraph"><p>CrudRepository und PagingAndSortingRepository sind nicht auf RDBMS beschränkt!</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CrudRepository</span>&lt;T, ID <span class="directive">extends</span> <span class="predefined-type">Serializable</span>&gt; <span class="directive">extends</span> Repository&lt;T, ID&gt; {

    &lt;S <span class="directive">extends</span> T&gt; S save(S entity);

    T findOne(ID primaryKey);

    <span class="predefined-type">Iterable</span>&lt;T&gt; findAll();

    <span class="predefined-type">Long</span> count();

    <span class="type">void</span> delete(T entity);

    <span class="type">boolean</span> exists(ID primaryKey);
}</code></pre></section><section id="_verwendung_von_spring_data"><h2>Verwendung von Spring Data</h2><div class="paragraph"><p>Konfiguration:</p></div>
<div class="title">SpringDataTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableTransactionManagement</span>
<span class="annotation">@EnableJpaRepositories</span>(basePackageClasses = TaskRepository.class)</code></pre>
<div class="paragraph"><p>Zugriff auf Daten:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> TaskRepository taskRepository;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testFindAll() {
    <span class="predefined-type">List</span>&lt;TaskEntity&gt; tasks = taskRepository.findAll();
    tasks.forEach(<span class="predefined-type">System</span>.out::println);
}</code></pre></section><section id="_logging_von_sql_statements"><h2>Logging von SQL-Statements</h2><div class="title">application.properties</div><pre class="CodeRay listingblock"><code>spring.jpa.hibernate.show_sql=true <i class="conum" data-value="1"></i><b>(1)</b>
spring.jpa.hibernate.format_sql=true <i class="conum" data-value="2"></i><b>(2)</b>

logging.level.org.hibernate.SQL=debug <i class="conum" data-value="3"></i><b>(3)</b>
logging.level.org.hibernate.type.descriptor.sql=trace <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Ausgabe der SQL-Statements über die <code>hibernate.show_sql</code> Property aktivieren (unabhängig vom Logger)</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>SQL-Statements formatiert ausgeben (gilt auch für Logger)</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Unabhängig davon gibt Hibernate alle SQL-Statements aus, wenn das Loglevel für <code>org.hibernate.SQL</code> auf <code>DEBUG</code> gesetzt wird.</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Mit Loglevel <code>TRACE</code> für <code>org.hibernate.type.descriptor.sql</code> gibt Hibernate alle SQL-Parameter aus</td></tr></table></div></section><section id="_konfiguration_einer_datasource"><h2>Konfiguration einer Datasource</h2><div class="title">application.properties</div><pre class="CodeRay listingblock"><code>spring.datasource.url=jdbc:hsqldb:hsql://localhost:9001/xdb
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.hibernate.ddl-auto=update</code></pre></section></section>
<section><section id="_jpa_criteria_api"><h2>JPA Criteria API</h2><div class="ulist"><ul><li class="fragment"><p>Über <code>JpaRepository</code> kann man nur fixe (zur Compilezeit bekannte) Abfragen ausführen</p></li><li class="fragment"><p>Alternativ kann man einen JPQL-String zusammensetzen und mit <code>EntityManager</code> ausführen</p></li><li class="fragment"><p>Die Criteria API bietet eine objektorientierte, typsichere Schnittstelle,
um dynamisch (zur Laufzeit) JPQL-Abfragen zusammenzusetzen</p></li><li class="fragment"><p>Alternative: <a href="http://www.querydsl.com/">&#8594; Querydsl</a> (wird von Spring unterstützt)</p></li></ul></div></section><section id="_criteria_api_mit_plain_jpa"><h2>Criteria API mit Plain-JPA</h2><div class="title">PlainJpaTest.java</div><pre class="CodeRay listingblock"><code class="java language-java">CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery&lt;TaskEntity&gt; q = cb.createQuery(TaskEntity.class);
Root&lt;TaskEntity&gt; from = q.from(TaskEntity.class);
q.select(from);

TypedQuery&lt;TaskEntity&gt; query = em.createQuery(q);
<span class="predefined-type">List</span>&lt;TaskEntity&gt; tasks = query.getResultList();
tasks.forEach(<span class="predefined-type">System</span>.out::println);</code></pre>
<div class="paragraph"><p>Es sind zwei Schritte notwendig:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Erstellung einer <code>CriteriaQuery</code> mittels <code>CriteriaBuilder</code></p></li><li><p>Ausführung der Abfrage mit <code>createQuery</code></p></li></ol></div></section><section id="_specification_für_eine_abfrage_mit_der_criteria_api"><h2>Specification für eine Abfrage mit der Criteria-API</h2><div class="title">TaskSearchCriteria.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaskSearchCriteria</span> {
    <span class="directive">private</span> <span class="directive">final</span> State state;
}</code></pre>
<div class="title">TaskSpecification.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaskSpecification</span> <span class="directive">implements</span> Specification&lt;TaskEntity&gt; {

    <span class="directive">private</span> <span class="directive">final</span> TaskSearchCriteria criteria;

    <span class="directive">public</span> TaskSpecification(TaskSearchCriteria criteria) {
        <span class="local-variable">super</span>();
        <span class="local-variable">this</span>.criteria = criteria;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Predicate</span> toPredicate(Root&lt;TaskEntity&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder builder) {
        query.orderBy(builder.desc(root.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateDue</span><span class="delimiter">&quot;</span></span>)));
        <span class="keyword">return</span> builder.equal(root.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>), criteria.getState());
    }
}</code></pre></section><section id="_abfrage_mit_einer_spring_data_specification"><h2>Abfrage mit einer Spring-Data Specification</h2><div class="title">SpringDataTest.java</div><pre class="CodeRay listingblock"><code class="java language-java">TaskSpecification spec = <span class="keyword">new</span> TaskSpecification(<span class="keyword">new</span> TaskSearchCriteria(State.STARTED));
<span class="predefined-type">List</span>&lt;TaskEntity&gt; tasks = taskRepository.findAll(spec);
tasks.forEach(<span class="predefined-type">System</span>.out::println);</code></pre>
<div class="ulist"><ul><li><p>Die Suchkriterien werden normalerweise als Value-Objekt übergeben, welches
mit den Benutzereingaben aus einem Abfrageformular befüllt ist
(in diesem Fall <code>TaskSearchCriteria</code>)</p></li><li><p>Die <em>Specification</em> intialisiert damit eine <code>CriteriaQuery</code>, die von Spring-Data in der
Methode <code>toPredicate</code> neben <code>CriteriaBuilder</code> und <code>Root</code> übergeben wird.</p></li></ul></div></section></section>
<section id="_aufgabe_2_umstellung_auf_spring_data_repositories"><h2>Aufgabe 2: Umstellung auf Spring Data Repositories</h2><div class="olist arabic"><ol class="arabic"><li><p>Komplementieren Sie die DAOs aus Aufgabe 1 durch alternative Spring Data Repositories, indem Sie entsprechende
Interfaces definieren.</p></li><li><p>Erstellen Sie eine Kopie von <code>DaoTests</code> unter dem Namen <code>RepositoryTests</code> und testen Sie die Repositories auf
gleiche Weise.</p></li></ol></div></section>
<section id="_aufgabe_3_verwendung_von_spring_data_repositories"><h2>Aufgabe 3: Verwendung von Spring Data Repositories</h2><div class="olist arabic"><ol class="arabic"><li><p>Bearbeiten Sie die Aufgaben und Fragen in <code>TaskRepositoryTest</code> aus dem Projekt <code>lesson03-boot-backend-rest</code>:</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">// Frage 1: Was bewirkt das &quot;spring.datasource.url=&quot;?</span>
<span class="annotation">@SpringBootTest</span>(properties = <span class="string"><span class="delimiter">&quot;</span><span class="content">spring.datasource.url=</span><span class="delimiter">&quot;</span></span>)
<span class="comment">// Frage 2: Wozu ist @Transactional notwendig?</span>
<span class="annotation">@Transactional</span></code></pre>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">// Frage 3: Warum ist kein exakter Vergleich bei 'dateDue' möglich?</span>
assertThat(task1).isEqualToIgnoringGivenFields(task2, <span class="string"><span class="delimiter">&quot;</span><span class="content">dateDue</span><span class="delimiter">&quot;</span></span>);
assertThat(task1.getDateDue()).isCloseTo(task2.getDateDue(), OFFSET);</code></pre></li><li><p>Konfigurieren Sie das Logging so, dass die SQL-Statements ausgegeben werden</p></li><li><p>Konfigurieren Sie über die application.properties eine Datenbankverbindung zu einem
HSQLDB-Server. Sie können <code>hsqldb-server</code> verwenden, um einen entsprechenden
Server zu starten. Lassen Sie die Tests gegen diesen Server laufen und sehen Sie sich
den Inhalt der <code>TASK</code> Tabelle an.</p></li><li><p>Optional: Finden Sie mit dem Debugger heraus, was beim Ausführen einer Repository-Methode
geschieht.</p></li><li><p>Experimentieren Sie!</p></li></ol></div></section>
<section><section id="_weiterführende_konzepte"><h2>Weiterführende Konzepte</h2><div class="ulist"><ul><li><p>Finder</p></li><li><p>Queries</p></li><li><p>Paging &amp; Sorting</p></li></ul></div></section><section id="_finder"><h2>Finder</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">List</span>&lt;Course&gt; findByTitleAndDuration(<span class="predefined-type">String</span> title, <span class="type">int</span> duration);

<span class="predefined-type">List</span>&lt;Course&gt; findTop3ByDuration(<span class="type">int</span> duration);

<span class="predefined-type">List</span>&lt;Course&gt; findByTitleLike(<span class="predefined-type">String</span> pattern);

<span class="predefined-type">List</span>&lt;Course&gt; findByTitleIn(<span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; titles);

<span class="predefined-type">List</span>&lt;Course&gt; findByDurationBetween(<span class="type">int</span> startDuration, <span class="type">int</span> endDuration);

<span class="predefined-type">List</span>&lt;Course&gt; findByTitleOrderByTitleAsc(<span class="predefined-type">String</span> title);</code></pre></section><section id="_queries"><h2>Queries</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Course c WHERE c.duration = :duration</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">List</span>&lt;Course&gt; loadCoursesJpql(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">duration</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> duration);

<span class="annotation">@Query</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM COURSES c WHERE c.duration = :duration</span><span class="delimiter">&quot;</span></span>, nativeQuery = <span class="predefined-constant">true</span>)
<span class="predefined-type">List</span>&lt;Course&gt; loadCoursesNative(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">duration</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> duration);</code></pre></section><section id="_paging_sorting"><h2>Paging &amp; Sorting</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Query</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Course c</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">List</span>&lt;Course&gt; loadCoursesSorted(Sort sort);</code></pre>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Pageable</span> request = PageRequest.of(<span class="integer">0</span>, <span class="integer">1000</span>, Sort.by(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).descending().and(Sort.by(<span class="string"><span class="delimiter">&quot;</span><span class="content">duration</span><span class="delimiter">&quot;</span></span>)));

Page&lt;Course&gt; page = repository.findAll(request);
<span class="predefined-type">List</span>&lt;Course&gt; courses = page.getContent();

<span class="predefined-type">Pageable</span> nextRequest = page.nextPageable();</code></pre></section></section>
<section id="_aufgabe_4_finder_und_paging"><h2>Aufgabe 4: Finder und Paging</h2><div class="olist arabic"><ol class="arabic"><li><p>Erweitern Sie das in Aufgabe 2 erstellte <code>CourseRepository</code> um zwei zusätzliche Finder-Methoden:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Laden aller Kurse, deren Titel einem anzugebenden Pattern entspricht.</p></li><li><p>Paginiertes Laden aller Kurse mit einer Länge zwischen einem anzugebenden Minimal- und Maximalwert.</p></li></ol></div></li><li><p>Fügen Sie den in Aufgabe 2 angelegten <code>RepositoryTests</code> eine weitere Testmethode hinzu, welche die beiden neuen Finder
des <code>CourseRepository</code> testet. Testdaten können Sie automatisiert über das SQL-Skript <code>init-data.sql</code> einspielen.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Laden aller Kurse, deren Titel den Begriff "Datenbanken" enthält.</p></li><li><p>Laden der ersten zwei Kurse mit einer Dauer zwischen 3 und 5 Tagen, aufsteigend sortiert nach ihrer Dauer.</p></li></ol></div></li></ol></div></section>
<section><section id="_best_practices"><h2>Best Practices</h2><div class="ulist"><ul><li><p>JPA &amp; Hibernate</p></li><li><p>Spring</p></li><li><p>Tests</p></li></ul></div></section><section id="_jpa_hibernate"><h2>JPA &amp; Hibernate</h2><div class="ulist"><ul><li><p>Konfiguration über Spring</p></li><li><p>Connection Pool verwenden</p></li><li><p>Injection des EntityManagers</p></li><li><p>Einfache CRUD-Operationen in abstraktes DAO auslagern</p></li><li><p>Naming Conventions in Java und DB beachten</p></li><li><p>Lazy Loading bei Bedarf punktuell deaktivieren</p></li><li><p>Entities nicht an UI weitergeben</p></li></ul></div></section><section id="_spring"><h2>Spring</h2><div class="ulist"><ul><li><p>Spring Data Repositorys nutzen, sofern möglich</p></li><li><p>JPQL und Criteria API nur verwenden, wenn nötig</p></li><li><p>@Transactional richtig anwenden</p></li></ul></div></section><section id="_tests"><h2>Tests</h2><div class="ulist"><ul><li><p>Integration Tests nur für Repositorys und DAOs</p></li><li><p>Unit Tests für Services (Business Logic)</p></li><li><p>In-memory DB verwenden, sofern möglich</p></li></ul></div></section></section>
<section id="_einführung_jpa_mit_spring_data"><h2>Einführung JPA mit Spring Data</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0303-rest.html">&#8594; Weiter zu REST</a></p></div></section>
<section id="_rest" data-state="no-title-footer"><h2>REST</h2><div class="paragraph center"><p>Was ist das?</p></div></section>
<section><section id="_rest_grundlagen"><h2>REST Grundlagen</h2><div class="ulist"><ul><li><p>Steht für <strong>Representational State Transfer</strong></p></li><li><p>Begriff: Doktorarbeit von Roy Fielding aus dem Jahr 2000</p></li><li><p>Technologie für Maschine zu Maschine Kommunikation</p></li><li><p>Fußt auf den Prinzipien des Web (Web für Maschinen)</p></li><li><p>Eine REST-API muss 5 Bedingungen erfüllen</p></li></ul></div></section><section id="_1_client_server"><h2>1. Client-Server</h2><div class="ulist"><ul><li><p>Strikte Trennung der Systeme</p></li><li><p>Verbindung kann unterbrochen sein</p></li></ul></div></section><section id="_2_zustandslos"><h2>2. Zustandslos</h2><div class="ulist"><ul><li><p>Keine Sitzungsinformation auf dem Server<br>
(Andernfalls nur REST-artig)</p></li><li><p>Zustand (Sitzung) wird auf Client vorgehalten</p></li><li><p>Nachrichten sind selbstbeschreibend</p></li><li><p>Jede Anfrage muss alle notwendigen Informationen enthalten,
damit der Server diese verarbeiten kann (inkl. Sitzungsinformationen)</p></li><li><p>Jede Antwort muss alle Informationen enthalten, die der Client
benötigt, um die Sitzung zu aktualisieren</p></li></ul></div></section><section id="_3_cachebar"><h2>3. Cachebar</h2><div class="ulist"><ul><li><p>Antworten müssen Informationen enthalten,
ob und wie lange gecached werden kann</p></li><li><p>Client kann nicht davon Ausgehen, dass Antwort direkt vom Server kommt</p></li></ul></div></section><section id="_4_schichtenarchitektur"><h2>4. Schichtenarchitektur</h2><div class="ulist"><ul><li><p>Zwischen Client und Server kann diverse Middleware liegen</p></li><li><p>&#8658; Erhöht Skalierbarkeit und Ausfallsicherheit</p></li></ul></div></section><section id="_5_einheitliche_schnittstelle"><h2>5. Einheitliche Schnittstelle</h2><div class="ulist"><ul><li><p>Einhaltung der HTTP-Spezifikation</p></li><li><p>Ein Vertrag für alle Belange</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Richtlinien der einheitlichen Schnittstelle:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Ressourcen basiert (URIs zur Identifizierung, repräsentationsunabhängig)</p></li><li><p>Bearbeitung der Ressourcen über deren Repräsentation</p></li><li><p>Selbstbeschreibende Nachrichten (jede Nachricht enthält explizt alles, was zu
deren Verarbeitung notwendig ist, z. B. Typ, Cachbarkeit)</p></li><li><p><em>Hypermedia as the Engine of Application State</em> (HATEOS)</p></li></ol></div></section><section id="_hateoas"><h2>HATEOAS</h2><div class="ulist"><ul><li><p>Client-Request enthält alle notwendigen Zustandsinformationen, die der Server benötigt,
um den Request zu bearbeiten. Der Server weiß (speichert) nichts zu dem Client.</p></li><li><p>Der Server muss in seiner Antwort jeglichen Zustand an den Client übertragen, der
für den nächsten Schritt notwendig ist.</p></li><li><p>Der Client übertägt die Zustandsinformation in Form von URLs, Request-Parametern,
Request-Headern und dem Request-Inhalt (Body). Der Server überträgt Zustand mittels
dem Inhalt der Antwort (Body), den Headern und dem Response-Code.</p></li><li><p>Daneben versteht man unter HATEOAS auch, dass Antworten im Inhalt oder im Header (<em>Location</em>, <em>Link</em>)
die Links zu den zurückgegeben Objekten und ggf. zu weiterführenden Objekten enthalten.</p></li></ul></div></section><section id="_6_ausführbarer_code_auf_anforderung_optional"><h2>6. Ausführbarer Code auf Anforderung (optional)</h2><div class="paragraph"><p>Server kann Funktionalität auf den Client übertragen (z. B. JavaScript-Code)</p></div></section><section id="_resourcen_basiert"><h2>Resourcen basiert</h2><div class="ulist"><ul><li><p>Resourcen (Dinge) werden über URIs identifiziert<br>
(es kann mehrere URIs geben, die auf die gleiche Ressource zeigen)</p></li><li><p>Resourcen sind unabhängig von deren Repräsenation (verschiedene Repräsenationen möglich)</p></li><li><p>Aktionen werden über HTTP-Verben (GET, POST, PUT, DELETE) angegeben</p></li><li><p>Repräsenationen (JSON, XML, HTML, PDF, etc.) werden über den Content-Type (MIME) angegeben</p></li><li><p>&#8658; URLs werden zum Adressieren von Ressourcen verwendet</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<table class="tableblock frame-all grid-all" style="width:50%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">REST URLs</th><th class="tableblock halign-left valign-top">SOAP-RPC URLs</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Dinge</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Aktionen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Substantive</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Verben</p></td></tr></table></section><section id="_repräsentationen"><h2>Repräsentationen</h2><div class="ulist"><ul><li><p>Die Repräsentationen sind das, was tatsächlich zwischen Client und Server übertragen wird</p></li><li><p>Sie geben den Ressourcen Zustand (oder einen Teil davon) wieder</p></li><li><p>Umfassen neben Nutzdaten auch Metadaten (Typinformationen)</p></li><li><p>Typischerweise JSON oder XML, kann aber bliebiges Format sein (z. B. PDF, HTML, &#8230;&#8203;)</p></li></ul></div></section><section id="_vorteile"><h2>Vorteile</h2><div class="ulist"><ul><li><p>Skalierbarkeit</p></li><li><p>Einfachheit</p></li><li><p>Wartbarkeit</p></li><li><p>Sichtbarkeit</p></li><li><p>Portierbarkeit</p></li><li><p>Zuverlässigkeit</p></li></ul></div>
<div class="paragraph"><p><a href="https://www.restapitutorial.com/lessons/whatisrest.html">
&#8594; www.restapitutorial.com: What is REST?</a></p></div></section><section id="_http_verben"><h2>HTTP Verben</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:14.2857%"><col style="width:28.5714%"><col style="width:57.1429%"></colgroup><tbody><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">GET</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">idempotent und sicher</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Eine (Menge von) Ressource(n) über ihre URI abrufen</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">POST</p></th><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erstellt eine Ressource</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">PUT</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">idempotent</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Eine (Menge von) Ressource(n) anhand ihrer URI ändern (vollständig ersetzen)</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">PATCH</p></th><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Eine Ressource ändern (nur einzelne Attribute)</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">DELETE</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">idempotent</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Entfernt eine Ressource anhand ihrer URI</p></td></tr></table>
<div class="paragraph"><p><a href="https://www.restapitutorial.com/lessons/httpmethods.html">
&#8594; HTTP-Methods für REST</a><br>
<a href="https://www.tutorialspoint.com/http/http_methods.htm">
&#8594; HTTP-Methods allgemein</a></p></div>
<aside class="notes"><div class="ulist"><ul><li><p><strong>Sicher</strong> heißt: Die Operation ändert nichts.</p></li><li><p><strong>GET</strong> Parameter können für Filter verwendet werden.</p></li><li><p><strong>PUT</strong> kann auch zum Anlegen verwendet werden, wenn der Identifier (die URI) bereits vorher bekannt ist.
Die URI muss die zu ändernde(n) Resource(n) eindeutig identifizieren (nicht der Nachrichteninhalt).</p></li><li><p><strong>POST</strong> kann für alle anderen Operationen verwendet werden, die zu keiner der genannten Kategorieen passt.</p></li><li><p><strong>DELETE</strong> ist zwar idempotnent, kann aber dennoch verschiedene Resposes liefern: 204 (wurde gelöscht)
und 404 (nicht mehr vorhanden)</p></li></ul></div></aside></section><section id="_richtlinien_für_rest_uris"><h2>Richtlinien für REST-URIs</h2><div class="ulist"><ul><li><p>IDs sind immer Bestandteil der URL (Parameter nur zum Filtern)</p></li><li><p>Nur Substantive (Verben sind ein <em>Bad Smell</em>)</p></li><li><p>Plural</p></li><li><p>Nur Kleinbuchstaben und '-' zur Trennung</p></li><li><p><em>/users</em> für eine Menge und <em>/users/123</em> für einzelne Ressource</p></li></ul></div>
<div class="paragraph"><p>Beispiel: <code>account/payment</code> statt <code>account/pay</code></p></div></section><section id="_wichtigste_http_antwortcodes"><h2>Wichtigste HTTP Antwortcodes</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">200 OK</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erfolg (normale Antwort)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">201 CREATED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erfolgreich erstellt (Antwort auf POST)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">204 NO CONTENT</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erfolg, aber kein Inhalt (Antwort auf DELETE)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">400 BAD REQUEST</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Anfrage kann nicht verarbeitet werden (Validierungsfehler)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">401 UNAUTHORIZED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Notwendige Authentifizerung fehlt (z.B. kein Token vorhanden)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">403 FORBIDDEN</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Berechtigung nicht ausreichend</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">404 NOT FOUND</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ressource existiert nicht</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">405 METHOD NOT ALLOWED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HTTP-Methode für die entsprechende URI nicht anwendbar</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">409 CONFLICT</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bearbeitung der Anfrage würde zu Inkonsistenzen führen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">410 GONE</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Die Ressource wurde gelöscht (wenn das bekannt ist, sonst 404)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">415 UNSUPPORTED MEDIA TYPE</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Format der übertragenen Daten nicht untersützt</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">500 INTERNAL SERVER ERROR</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Unerwarteter Fehler auf Server</p></td></tr></table>
<div class="paragraph"><p><a href="https://www.restapitutorial.com/lessons/httpstatuscodes.html">
&#8594; HTTP Status Codes</a><br></p></div>
<aside class="notes"><div class="dlist"><dl><dt class="hdlist1">405 METHOD NOT ALLOWED</dt><dd><p>Beispielsweise bei einem POST auf <em>/users/123</em> statt auf <em>/users</em>. Die Antwort muss einen <em>Allow</em> Header mit den
unterstützten Methoden enthalten, z. B. <code>Allow: GET, PUT</code></p></dd><dt class="hdlist1">409 CONFLICT</dt><dd><p>Beispielsweise doppelte Einträge</p></dd></dl></div></aside></section><section id="_fragen"><h2>Fragen?</h2><div class="ulist"><div class="title">Auch interessant:</div><ul><li><p>JSON-API</p></li></ul></div></section></section>
<section><section id="_webanwendungen_mit_java"><h2>Webanwendungen mit Java</h2><div class="ulist"><ul><li><p>Servlet API seit 1996 (aktuell: seit 2021 Jakarta Servlet 6.0 als Teil von JakartaEE 10)</p></li><li><p>Servlets können aus Java Server Pages (JSPs) erzeugt werden</p></li><li><p>Werden als WAR deployed</p></li><li><p>Ausführbar auf Servlet Container (z.B. Tomcat) oder Application Server (z.B. GlassFish)</p></li></ul></div></section><section id="_einfaches_servlet"><h2>Einfaches Servlet</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        <span class="predefined-type">String</span> name = req.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
        resp.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
        resp.getWriter().println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section><section id="_zugehörige_web_infweb_xml"><h2>Zugehörige WEB-INF/web.xml</h2><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;web-app</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span>
                             <span class="content">http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Hello Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>hello.HelloServlet<span class="tag">&lt;/servlet-class&gt;</span>
    <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
  <span class="tag">&lt;/servlet&gt;</span>
  <span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Hello Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/hello<span class="tag">&lt;/url-pattern&gt;</span>
  <span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre></section><section id="_servlet_ohne_web_xml"><h2>Servlet ohne web.xml</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@WebServlet</span>(urlPatterns = <span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, loadOnStartup = <span class="integer">1</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        <span class="predefined-type">String</span> name = req.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
        resp.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
        resp.getWriter().println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
<div class="paragraph"><p>seit Servlet API 3.0</p></div></section></section>
<section><section id="_spring_web_mvc"><h2>Spring Web-MVC</h2><div class="ulist"><ul><li><p>Web Framework, das auf Servlet API basiert</p></li><li><p>Setzt Model-View-Controller Pattern um</p></li><li><p>Verwendet zentrales <code>DispatcherServlet</code></p></li></ul></div><div class="paragraph"><p><br></p></div><div class="paragraph"><div class="title">Problem:</div><p>Das <code>DispatcherServlet</code> muss über den <code>ApplicationContext</code> konfigurierbar sein</p></div></section><section id="_applicationcontext_bei_web_applikationen"><h2>ApplicationContext bei Web-Applikationen</h2><div class="imageblock" style=""><img src="images/web-application-context-hierarchy.svg" alt="web application context hierarchy" width="100%" height="391"></div></section><section id="_webapplicationcontext"><h2>WebApplicationContext</h2><div class="imageblock" style=""><img src="images/web-application-context.svg" alt="web application context" width="700" height="600"></div></section><section id="_kontext_hierarchie"><h2>Kontext-Hierarchie</h2><div class="imageblock" style=""><img src="images/context-hierarchie.svg" alt="context hierarchie" width="1200" height="720"></div></section><section id="_initialisierung_des_dispatcherservlet"><h2>Initialisierung des DispatcherServlet</h2><div class="dlist"><dl><dt class="hdlist1"><code>spring-web-5.3.6.jar!/META-INF/services/javax.servlet.ServletContainerInitializer</code></dt><dd><div class="ulist"><ul><li><p>wird von Servlet-Container geladen (<a href="https://download.oracle.com/otn-pub/jcp/servlet-3_1-fr-spec/servlet-3_1-final.pdf">&#8594; Servlet-Spec 3.1, Abschnitt 8.2.4</a>)</p></li><li><p>ist eine Textdatei, die auf einen <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ServiceLoader.html#developing-service-providers">Service Provider</a> verweist</p></li><li><p>diese Textdatei enthält:</p></li></ul></div></dd><dt class="hdlist1"><code>org.springframework.web.SpringServletContainerInitializer</code></dt><dd><div class="ulist"><ul><li><p>führt alle <code>org.springframework.web.WebApplicationInitializer</code> aus, u. a. Subklassen von:</p></li></ul></div></dd><dt class="hdlist1"><code>org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer</code></dt><dd><div class="ulist"><ul><li><p>erzeugt <code>AnnotationConfigWebApplicationContext</code></p></li><li><p>registriert <code>DispatcherServlet</code> beim <code>ServletContext</code></p></li></ul></div></dd></dl></div></section><section id="_beispiel_für_einen_webapplicationinitializer"><h2>Beispiel für einen WebApplicationInitializer</h2><div class="title">HelloWebAppInitializer.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWebAppInitializer</span>
        <span class="directive">extends</span> AbstractAnnotationConfigDispatcherServletInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> getRootConfigClasses() {
        <span class="comment">// Config-Klassen für Root-ApplicationContext</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span>{};
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> getServletConfigClasses() {
        <span class="comment">// Config-Klassen für Servlet-ApplicationContext</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span> {HelloConfig.class};
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span><span class="type">[]</span> getServletMappings() {
        <span class="comment">// Servlet-Mappings für das DispatcherServlet</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>};
    }
}</code></pre></section><section id="_dispatcherservlet_bei_rest_service"><h2>DispatcherServlet bei REST-Service</h2><div class="imageblock" style=""><img src="images/mvcrest-seq.svg" alt="mvcrest seq" width="1200" height="720"></div></section><section id="_konfiguration_ohne_spring_boot"><h2>Konfiguration ohne Spring-Boot</h2><div class="title">HelloConfig.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>
<span class="annotation">@EnableWebMvc</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloConfig</span> <span class="directive">implements</span> WebMvcConfigurer { <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Standardkonfiguration für MVC-Applikationen</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Das <code>WebMvcConfigurer</code> Interface bietet viele Methoden zur Anpassung der Konfiguration</td></tr></table></div></section></section>
<section><section id="_rest_mit_spring_web_mvc"><h2>REST mit Spring Web-MVC</h2><div class="paragraph"><p>REST-Endpunkte werden mit Controller-Klassen implementiert. Das sind normale Java-Klassen
mit entsprechenden Annotationen:</p></div><div class="title">HelloController.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloController</span> {

    <span class="annotation">@GetMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, produces = <span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@RequestParam</span> <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre></section><section id="_wichtige_annotationen_für_controller"><h2>Wichtige Annotationen für Controller</h2><div class="dlist"><dl><dt class="hdlist1"><code>@Controller</code> bzw. <code>@RestController</code></dt><dd><p>Markiert eine Klasse als Controller<br>
<code>@RestController</code> ist Meta-Annotation für <code>@Controller</code> + <code>@ResponseBody</code></p></dd><dt class="hdlist1"><code>@RequestMapping</code> bzw. <code>@GetMapping</code> (analog für <code>Post</code>, <code>Put</code>, <code>Delete</code> und <code>Patch</code>)</dt><dd><p>Markiert eine Methode als Request-Handler<br>
<code>@GetMapping</code> ist Meta-Annotation für <code>@RequestMapping(method = RequestMethod.GET)</code></p></dd><dt class="hdlist1"><code>@PathVariable</code></dt><dd><p>Ein <code>{variable}</code> innerhalb eines Pfade definiert eine Variable und deren Wert
mittels <code>@PathVariable</code> der Handler-Methode übergeben werden kann.</p></dd></dl></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/owners/{ownerId}/pets/{petId}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Pet findPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> ownerId, <span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> petId) { ... }</code></pre>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/pets/{petId}</span><span class="delimiter">&quot;</span></span>, produces = <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json;charset=UTF-8</span><span class="delimiter">&quot;</span></span>)
<span class="comment">// statt &quot;application/json;charset=UTF-8&quot; geht auch org.springframework.http.MediaType.APPLICATION_JSON_UTF8_VALUE</span></code></pre></section><section id="_request_mapping"><h2>Request-Mapping</h2><div class="ulist"><ul><li><p>Die Zuordnung von Requests zu Handler-Methoden erfolgt über den <code>path</code> Wert der
entsprechenden <code>@RequestMapping</code> Annotation.</p></li><li><p>Neben den Platzhaltern von Path-Variablen <code>{var}</code> können auch <code>?</code>, <code><strong></code> und <code></strong>*</code> verwendet werden.</p></li><li><p>Implizit wird <code>.*</code> angehängt, so dass auf <code>/person</code> auch <code>/person.pdf</code> und <code>/person.xml</code> passen.</p></li><li><p>Mit <code>params</code> oder <code>header</code> kann zugleich noch auf das Vorhanden sein eines bestimmten
Parameters bzw. Headers geprüft werden:</p><div class="ulist"><ul><li><p><code>@GetMapping(path = "/pets", params = "myParam")</code> Parameter muss vorhanden sein</p></li><li><p><code>@GetMapping(path = "/pets", params = "!myParam")</code> Parameter darf nicht vorhanden sein</p></li><li><p><code>@GetMapping(path = "/pets", params = "myParam=myValue")</code> Parameter muss genau den angegeben Wert haben</p></li></ul></div></li></ul></div></section></section>
<section id="_rest_apis_testen"><h2>REST-APIs testen</h2><div class="paragraph heading"><p><strong>curl</strong> (über <strong>Git Bash</strong> aufrufbar)</p></div>
<div class="paragraph"><p>Liste aller Tasks:</p></div>
<div class="literalblock"><div class="content"><pre>curl http://localhost:8080/tasks</pre></div></div>
<div class="paragraph"><p>Einen Task hinzufügen:</p></div>
<div class="literalblock"><div class="content"><pre>curl -d '{"description": "curl lernen", "state":"STARTED", "dateDue":"2019-05-25T10:15:00Z"}' \
     -H "Content-Type: application/json" -X POST http://localhost:8080/tasks</pre></div></div>
<div class="paragraph"><p>Task löschen (mit <code>-v</code> werden u. a. Status-Code und Header ausgegeben):</p></div>
<div class="literalblock"><div class="content"><pre>curl -v -X DELETE http://localhost:8080/tasks/2</pre></div></div>
<div class="paragraph heading"><p>Alternativen:</p></div>
<div class="ulist"><ul><li><p><a href="https://www.getpostman.com/">&#8594; Postman</a></p></li><li><p><a href="https://addons.mozilla.org/de/firefox/addon/restclient/">&#8594; RESTClient (Browser-Plugin)</a></p></li></ul></div></section>
<section id="_aufgabe_3_rest_controller_implementieren_teil_1"><h2>Aufgabe 3: REST-Controller implementieren (Teil 1)</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie die fehlenden Methodenrümpfe (CRUD) im <code>TaskController</code> und ergänzen Sie notwendige Annotationen.</p></li><li><p>Starten Sie den Server und legen Sie manuell Daten über die REST-API an.
Prüfen Sie auch den Datenbankinhalt.</p></li><li><p>Experimentieren Sie!</p></li></ol></div></section>
<section><section id="_weitere_annotationen_für_parameter_von_handler_methoden"><h2>Weitere Annotationen für Parameter von Handler-Methoden</h2><div class="ulist"><ul><li><p><code>@RequestParam</code> (default)</p></li><li><p><code>@RequestHeader</code></p></li><li><p><code>@CookieValue</code></p></li><li><p><code>@SessionAttribute</code></p></li><li><p><code>@RequestBody</code></p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/accounts</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> handle(<span class="annotation">@RequestBody</span> Account account) { ... }</code></pre></li><li><p><code>@Valid</code> (Standard Bean Validation)</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/accounts</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> handle(<span class="annotation">@Valid</span> <span class="annotation">@RequestBody</span> Account account) { ... }</code></pre></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-controller">
&#8594; Spring Reference: Annotated Controllers</a></p></div></section><section id="_optionale_handler_methoden_parameter"><h2>Optionale Handler-Methoden Parameter</h2><div class="ulist"><ul><li><p><code>HttpServletRequest</code></p></li><li><p><code>HttpServletResponse</code></p></li><li><p><code>java.security.Principal</code></p></li><li><p><code>Locale</code></p></li><li><p><code>TimeZone</code> oder <code>ZoneId</code></p></li><li><p><code>HttpEntity&lt;B&gt;</code> (Zum Zugriff auf Header und Body)</p></li><li><p><code>Errors</code>, <code>BindingResult</code> (Zugriff auf Fehler bei Validierung oder Data Binding)</p></li><li><p><code>UriComponentsBuilder</code> (Um URLs relativ zur aktuellen URL zu erstellen)</p><div class="title">DemoController.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/uri/{id}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">String</span> uri(<span class="annotation">@PathVariable</span> <span class="type">int</span> id, UriComponentsBuilder uriBuilder) {
    <span class="predefined-type">String</span> uri = uriBuilder.path(<span class="string"><span class="delimiter">&quot;</span><span class="content">/uri/{id}</span><span class="delimiter">&quot;</span></span>).build().expand(id).encode().toUriString();
    <span class="keyword">return</span> uri;
}</code></pre></li></ul></div></section><section id="_handler_methoden_rückgabewerte"><h2>Handler-Methoden Rückgabewerte</h2><div class="paragraph"><p>Ein Handler kann beliebige Objekte zurückgeben, die mittels Data-Binding in den
entsprechenden <em>content_type</em> konvertiert werden.</p></div>
<div class="ulist"><ul><li><p><code>@ResponseBody</code> (in <code>@RestController</code> enthalten)</p></li><li><p><code>@GetMapping(path="/json", produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</code> (<em>content_type</em> angeben)</p></li><li><p><code>@ResponseStatus(HttpStatus.CREATED)</code> (default ist <code>HttpStatus.OK</code>)</p></li><li><p><code>ResponseEntity&lt;B&gt;</code> (bietet fluent-API für Status, Header, Body, Cache-Control, etc.)</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">return</span> ResponseEntity.status(status).body(body);</code></pre></li></ul></div></section></section>
<section><section id="_error_handling"><h2>Error Handling</h2><div class="olist arabic"><ol class="arabic"><li><p>Exception annotieren (Message ist fix):</p><div class="title">BadException.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ResponseStatus</span>(code = HttpStatus.BAD_REQUEST, reason=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Exception</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BadException</span> <span class="directive">extends</span> <span class="exception">RuntimeException</span> {
}</code></pre></li><li><p>ResponseStatusException (seit Spring 5):</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">throw</span> <span class="keyword">new</span> ResponseStatusException(HttpStatus.NOT_ACCEPTABLE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Easy aufgrufen mit name=</span><span class="delimiter">&quot;</span></span> + name);</code></pre></li><li><p>Handler-Methode im Controller für die entsprechenden Exceptions:</p><div class="title">DemoController.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ExceptionHandler</span>({ WorseException.class })
<span class="directive">public</span> ResponseEntity&lt;RestApiError&gt; handleWorse(WorseException ex) {
    HttpStatus status = HttpStatus.GONE;
    RestApiError body = <span class="keyword">new</span> RestApiError(status.value(), ex.getMessage());
    <span class="keyword">return</span> ResponseEntity.status(status).body(body);
}</code></pre></li></ol></div></section><section id="_zentralisierte_fehlerbehandlung_mit_controlleradvice"><h2>Zentralisierte Fehlerbehandlung mit <code>@ControllerAdvice</code></h2><div class="title">RestExceptionHandler.java (lesson03-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ControllerAdvice</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RestExceptionHandler</span> <span class="directive">extends</span> ResponseEntityExceptionHandler {

    <span class="annotation">@ExceptionHandler</span>(WorstException.class)
    <span class="annotation">@ResponseStatus</span>(HttpStatus.CONFLICT)
    <span class="annotation">@ResponseBody</span>
    <span class="directive">public</span> RestApiError handleWorst(WorstException ex) {
        logger.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">Worst: </span><span class="delimiter">&quot;</span></span> + ex.getMessage());
        <span class="keyword">return</span> error(HttpStatus.CONFLICT, ex);
    }

    <span class="annotation">@ExceptionHandler</span>({ <span class="exception">NullPointerException</span>.class, <span class="exception">IllegalArgumentException</span>.class, <span class="exception">IllegalStateException</span>.class })
    <span class="directive">public</span> ResponseEntity&lt;<span class="predefined-type">Object</span>&gt; handleIntenalServerError(<span class="exception">RuntimeException</span> ex, WebRequest request) {
        logger.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Internal Server Error</span><span class="delimiter">&quot;</span></span>, ex);

        HttpStatus status = HttpStatus.INTERNAL_SERVER_ERROR;
        RestApiError error = error(status, ex);
        <span class="keyword">return</span> handleExceptionInternal(ex, error, <span class="keyword">new</span> HttpHeaders(), status, request);
    }

    <span class="directive">private</span> RestApiError error(HttpStatus httpStatus, <span class="exception">Exception</span> ex) {
        <span class="predefined-type">String</span> message = ex.getMessage() == <span class="predefined-constant">null</span> ? ex.getClass().getSimpleName() : ex.getMessage();
        <span class="keyword">return</span> <span class="keyword">new</span> RestApiError(httpStatus.value(), message);
    }
}</code></pre></section></section>
<section><section id="_unit_tests"><h2>Unit-Tests</h2><div class="paragraph heading"><p>Test mit <strong>MockMvc</strong></p></div><div class="title">TaskControllerTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootTest</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.datasource.url=</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@AutoConfigureMockMvc</span>
<span class="annotation">@Disabled</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implement TaskController first</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TaskControllerTest</span> {
    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MockMvc mockMvc;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testEmptyRepository() <span class="directive">throws</span> <span class="exception">Exception</span> {
        mockMvc.perform(get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tasks/</span><span class="delimiter">&quot;</span></span>)).andDo(print()).andExpect(status().isOk()).andExpect(content().json(<span class="string"><span class="delimiter">&quot;</span><span class="content">[]</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre></section><section id="_test_mit_testresttemplate"><h2>Test mit <strong>TestRestTemplate</strong></h2><div class="title">TaskControllerHttpRequestTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootTest</span>(properties = <span class="string"><span class="delimiter">&quot;</span><span class="content">spring.datasource.url=</span><span class="delimiter">&quot;</span></span>, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TaskControllerHttpRequestTest</span> {

    <span class="annotation">@LocalServerPort</span>
    <span class="directive">private</span> <span class="type">int</span> port;

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> TestRestTemplate restTemplate;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testGet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        TaskEntity task = restTemplate.getForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="delimiter">&quot;</span></span> + port + <span class="string"><span class="delimiter">&quot;</span><span class="content">/tasks/42</span><span class="delimiter">&quot;</span></span>, TaskEntity.class);
    }
}</code></pre></section></section>
<section id="_aufgabe_4_rest_controller_implementieren_teil_2"><h2>Aufgabe 4: REST-Controller implementieren (Teil 2)</h2><div class="olist arabic"><ol class="arabic"><li><p>Lösen Sie die restlichen TODOs (Error Handling, Location Header) im <code>TaskController</code>.</p></li><li><p>Führen Sie die Tests <code>TaskControllerTest</code>, <code>TaskControllerHttpRequestTest</code> und <code>TaskControllerMockTest</code> aus.
Worin unterscheiden sich diese?</p></li><li><p>Debuggen Sie Ihre Anwendung. Wer ruft die Controller-Methoden auf? Was genau geschieht im DispatcherServlet?</p></li></ol></div></section>
<section id="_rest_2"><h2>REST</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0304-soap.html">&#8594; Weiter zu SOAP</a></p></div></section>
<section id="_soap" data-state="no-title-footer"><h2>SOAP</h2><div class="paragraph center"><p>Was ist das?</p></div></section>
<section id="_grundlagen"><h2>Grundlagen</h2><div class="ulist"><ul><li><p>Ursprünglich: <strong>Simple Object Access Protocol</strong></p></li><li><p>Standardisiert vom W3C</p></li><li><p>Format zum maschinellen Austausch von Nachrichten (XML) über ein Netzwerk</p></li><li><p>Meist HTTP als Transportprotokoll</p></li><li><p>Explizite Beschreibung über WSDL</p></li><li><p>Erweiterung durch WS-* Spezifikationen</p></li></ul></div></section>
<section id="_aufbau_einer_nachricht" class="columns"><h2>Aufbau einer Nachricht</h2><div class="imageblock" style=""><img src="images/lesson03/Envelope.png" alt="Envelope" width="400"></div>
<div class="openblock"><div class="content"><div class="paragraph"><p><strong>Envelope:</strong></p></div>
<div class="ulist"><ul><li><p>"Umschlag" einer Nachricht</p></li><li><p>Namespace: <code>xmlns:soap="http://www.w3.org/2003/05/soap-envelope"</code></p></li></ul></div>
<div class="paragraph"><p><strong>Header:</strong></p></div>
<div class="ulist"><ul><li><p>Optional</p></li><li><p>Meta-Informationen: Empfänger, Hops, Verschlüsselung, etc.</p></li></ul></div>
<div class="paragraph"><p><strong>Body:</strong></p></div>
<div class="ulist"><ul><li><p>Nutzdaten (Payload)</p></li><li><p>Prozeduraufruf (RPC Style)</p></li><li><p>Übermittlung von <strong>Daten (Document Style)</strong></p></li></ul></div></div></div></section>
<section id="_nachrichtenaustausch" class="columns"><h2>Nachrichtenaustausch</h2><div class="openblock"><div class="content"><div class="paragraph"><p><strong>Request:</strong></p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;soap:Envelope</span> <span class="attribute-name">xmlns:soap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2003/05/soap-envelope</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns:as</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;soap:Header</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;soap:Body&gt;</span>
        <span class="tag">&lt;as:getCoursesRequest&gt;</span>
            <span class="tag">&lt;as:title&gt;</span>Spring<span class="tag">&lt;/as:title&gt;</span>
        <span class="tag">&lt;/as:getCoursesRequest&gt;</span>
    <span class="tag">&lt;/soap:Body&gt;</span>

<span class="tag">&lt;/soap:Envelope&gt;</span></code></pre></div></div>
<div class="openblock"><div class="content"><div class="paragraph"><p><strong>Response:</strong></p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;soap:Envelope</span> <span class="attribute-name">xmlns:soap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2003/05/soap-envelope</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns:as</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;soap:Header</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;soap:Body&gt;</span>

        <span class="tag">&lt;as:getCoursesResponse&gt;</span>
            <span class="tag">&lt;as:course&gt;</span>
                <span class="tag">&lt;as:title&gt;</span>Spring Power Workshop<span class="tag">&lt;/as:title&gt;</span>
                <span class="tag">&lt;as:tutor&gt;</span>Daniel Krämer<span class="tag">&lt;/as:tutor&gt;</span>
                <span class="tag">&lt;as:numDays&gt;</span>5<span class="tag">&lt;/as:numDays&gt;</span>
                <span class="tag">&lt;as:level&gt;</span>Advanced<span class="tag">&lt;/as:level&gt;</span>
            <span class="tag">&lt;/as:course&gt;</span>
        <span class="tag">&lt;/as:getCoursesResponse&gt;</span>

    <span class="tag">&lt;/soap:Body&gt;</span>

<span class="tag">&lt;/soap:Envelope&gt;</span></code></pre></div></div></section>
<section id="_wsdl"><h2>WSDL</h2><div class="ulist"><ul><li><p><strong>Web Service Description Language</strong></p></li><li><p>Beschreibung eines SOAP Web Service in XML</p></li><li><p>Auslieferung durch Service selbst</p></li><li><p>Komponenten</p><div class="ulist"><ul><li><p><strong>Types:</strong> spezifische Datenstrukturen</p></li><li><p><strong>PortTypes, Interfaces:</strong> angebotene Prozeduren</p></li><li><p><strong>Bindings:</strong> Interfaces unter einem bestimmten Protokoll (z.B. HTTP)</p></li><li><p><strong>Port bzw. Endpoint:</strong> konkrete Adresse (URI) eines Bindings</p></li><li><p><strong>Service:</strong> Zusammenstellung von Endpoints</p></li></ul></div></li></ul></div></section>
<section id="_wsdl_2"><h2>WSDL</h2><pre class="CodeRay listingblock"><code class="xml language-xml">    <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GetCoursesInput</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd1:GetCoursesRequest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>

    <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GetCoursesOutput</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;part</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">element</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd1:TradePrice</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>

    <span class="tag">&lt;portType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CoursePortType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GetCourses</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GetCoursesInput</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;output</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:GetCoursesOutput</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/operation&gt;</span>
    <span class="tag">&lt;/portType&gt;</span>

    <span class="tag">&lt;binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CourseSoapBinding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:CoursePortType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;soap:binding</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">document</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transport</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/http</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GetCourses</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           <span class="tag">&lt;soap:operation</span> <span class="attribute-name">soapAction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/GetCourses</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;input&gt;</span>
               <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;/input&gt;</span>
           <span class="tag">&lt;output&gt;</span>
               <span class="tag">&lt;soap:body</span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">literal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;/output&gt;</span>
        <span class="tag">&lt;/operation&gt;</span>
    <span class="tag">&lt;/binding&gt;</span>

    <span class="tag">&lt;service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CourseService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;documentation&gt;</span>Provides information regarding anderScore courses<span class="tag">&lt;/documentation&gt;</span>
        <span class="tag">&lt;port</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CoursePort</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:CourseSoapBinding</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           <span class="tag">&lt;soap:address</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/ws/courses</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;/service&gt;</span></code></pre></section>
<section id="_ws"><h2>WS-*</h2><div class="ulist"><ul><li><p>Erweiterte Spezifikationen für SOAP Web Services</p></li><li><p>Zusammensetzbar und interoperabel</p></li><li><p>Nutzung des SOAP Headers</p></li><li><p>Wichtige Realisierungen</p><div class="ulist"><ul><li><p>WS-Security</p></li><li><p>WS-Addressing</p></li><li><p>WS-Discovery</p></li></ul></div></li></ul></div></section>
<section id="_abgrenzung_zu_rest" class="columns"><h2>Abgrenzung zu REST</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Eigenschaften SOAP</strong></p><div class="ulist"><ul><li><p>Nachrichtenformat</p></li><li><p>Explizite Schnittstellenbeschreibung</p></li><li><p>RPC Style und Document Style</p></li><li><p>XML</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Eigenschaften REST</strong></p><div class="ulist"><ul><li><p>Architekturstil</p></li><li><p>Implizite Schnittstellenbeschreibung</p></li><li><p>Ressourcenorientiert</p></li><li><p>Beliebige Datentypen</p></li></ul></div></li></ul></div></div></div></section>
<section id="_abgrenzung_zu_rest_2" class="columns"><h2>Abgrenzung zu REST</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Einsatzszenarien SOAP</strong></p><div class="ulist"><ul><li><p>Maschinenlesb. Schnittstellenbeschreibung</p></li><li><p>Ausnutzung der WS-* Standards</p></li><li><p>Integration von Altsystemen</p></li><li><p>Fokus auf XML</p></li></ul></div></li></ul></div></div></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p><strong>Einsatzszenarien REST</strong></p><div class="ulist"><ul><li><p>Zugriff verschiedenster Systeme</p></li><li><p>Anbindung clientseitiger Web Frontends</p></li><li><p>Nutzung vorhandener Caches</p></li><li><p>Starke Ressoucenorientierung</p></li><li><p>Übertragung anderer Formate als XML</p></li></ul></div></li></ul></div></div></div></section>
<section id="_soap_2"><h2>SOAP</h2><div class="paragraph heading"><p>Fragen?</p></div></section>
<section id="_spring_ws"><h2>Spring WS</h2><div class="ulist"><ul><li><p><strong>Alternative Vorgehensweisen</strong></p><div class="ulist"><ul><li><p>Contract First: WSDL &#8594; Java-Klassen</p></li><li><p>Code First: Java-Klassen &#8594; WSDL</p></li></ul></div></li><li><p><strong>Spring WS</strong></p><div class="ulist"><ul><li><p>Contract First mittels <code>xjc</code></p></li><li><p>XML Schema (XSD) &#8594; WSDL + Klassen</p></li></ul></div></li></ul></div></section>
<section id="_xml_schema_xsd"><h2>XML Schema (XSD)</h2><div class="paragraph"><p>Definition verwendeter Datenstrukturen</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;xs:schema</span> <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:as</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCourseRequest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xs:complexType&gt;</span>
            <span class="tag">&lt;xs:sequence&gt;</span>
                <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xs:sequence&gt;</span>
        <span class="tag">&lt;/xs:complexType&gt;</span>
    <span class="tag">&lt;/xs:element&gt;</span>

    <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCourseResponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xs:complexType&gt;</span>
            <span class="tag">&lt;xs:sequence&gt;</span>
                <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">course</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">as:course</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xs:sequence&gt;</span>
        <span class="tag">&lt;/xs:complexType&gt;</span>
    <span class="tag">&lt;/xs:element&gt;</span>

    <span class="tag">&lt;xs:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">course</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xs:sequence&gt;</span>
            <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tutor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">numDays</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xs:sequence&gt;</span>
    <span class="tag">&lt;/xs:complexType&gt;</span>
<span class="tag">&lt;/xs:schema&gt;</span></code></pre></section>
<section id="_jaxb_maven_plugin"><h2>JAXB Maven Plugin</h2><div class="ulist"><ul><li><p>Automatische Generierung benötigter Klassen</p></li><li><p>Verwendung von xjc (JDK)</p></li><li><p>Aufruf: <code>mvn jaxb2:xjc</code></p></li></ul></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.mojo<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jaxb2-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.5.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;id&gt;</span>xjc<span class="tag">&lt;/id&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>xjc<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
       <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;sources&gt;</span>
            <span class="tag">&lt;source&gt;</span>${project.basedir}/src/main/resources/xsd/<span class="tag">&lt;/source&gt;</span>
        <span class="tag">&lt;/sources&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre></section>
<section id="_endpoints"><h2>Endpoints</h2><div class="ulist"><ul><li><p>Stellen Handler für SOAP Requests zur Verfügung</p></li><li><p>SOAP Schnittstellen zum System</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Endpoint</span> <span class="comment">// Registriert Klasse bei Spring WS</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CourseEndpoint</span> {

  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NAMESPACE_URI = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="delimiter">&quot;</span></span>;

  <span class="annotation">@Autowired</span>
  <span class="directive">private</span> CourseService courseService;

  <span class="annotation">@PayloadRoot</span>(namespace = NAMESPACE_URI, localPart = <span class="string"><span class="delimiter">&quot;</span><span class="content">GetCourseRequest</span><span class="delimiter">&quot;</span></span>) <span class="comment">// Zuordnung SOAP Request -&gt; Handler</span>
  <span class="annotation">@ResponsePayload</span> <span class="comment">// Marshalling des Response Bodies</span>
  <span class="directive">public</span> GetCourseResponse getCountry(<span class="annotation">@RequestPayload</span> GetCourseRequest request) { <span class="comment">// Unmarshalling des Request Bodies</span>
    Course course = courseService.findByTitle(request.getTitle());

    GetCourseResponse response = <span class="keyword">new</span> GetCourseResponse();
    response.setCourse(course);

    <span class="keyword">return</span> response;
  }
}</code></pre></section>
<section id="_spring_config"><h2>Spring Config</h2><div class="ulist"><ul><li><p>Aktivierung und Konfiguration von Spring WS</p></li><li><p>Einbindung der XML Schemata</p></li><li><p>Konfiguration der Endpoints (bei Spring Boot automatisch)</p></li></ul></div></section>
<section id="_spring_config_2"><h2>Spring Config</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@EnableWs</span> <span class="comment">// (1) Aktivierung von Spring WS</span>
<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SoapConfig</span> <span class="directive">extends</span> WsConfigurerAdapter {

  <span class="comment">// (2) Registrierung eines Servlets zur Verarbeitung von SOAP Requests</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> ServletRegistrationBean messageDispatcherServlet(ApplicationContext applicationContext) {
    MessageDispatcherServlet servlet = <span class="keyword">new</span> MessageDispatcherServlet();
    servlet.setApplicationContext(applicationContext);
    servlet.setTransformWsdlLocations(<span class="predefined-constant">true</span>);
    <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean(servlet, <span class="string"><span class="delimiter">&quot;</span><span class="content">/ws/*</span><span class="delimiter">&quot;</span></span>);
  }

  <span class="comment">// (3) Bereitstellung des XML Schemas</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> XsdSchema courseSchema() {
    <span class="keyword">return</span> <span class="keyword">new</span> SimpleXsdSchema(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">courseSchema.xsd</span><span class="delimiter">&quot;</span></span>));
  }

  <span class="comment">// (4) Automatische Generierung einer WSDL</span>
  <span class="annotation">@Bean</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">courses</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> DefaultWsdl11Definition defaultWsdl11Definition(XsdSchema courseSchema) {
    DefaultWsdl11Definition wsdl11Definition = <span class="keyword">new</span> DefaultWsdl11Definition();
    wsdl11Definition.setPortTypeName(<span class="string"><span class="delimiter">&quot;</span><span class="content">CoursesPort</span><span class="delimiter">&quot;</span></span>);
    wsdl11Definition.setLocationUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/ws</span><span class="delimiter">&quot;</span></span>);
    wsdl11Definition.setTargetNamespace(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="delimiter">&quot;</span></span>);
    wsdl11Definition.setSchema(courseSchema);
    <span class="keyword">return</span> wsdl11Definition;
  }
}</code></pre></section>
<section id="_testen_der_endpoints"><h2>Testen der Endpoints</h2><div class="ulist"><ul><li><p>Commandline</p></li></ul></div>
<div class="paragraph center"><p><code>curl --header "content-type: text/xml" -d @soapRequest.xml <a href="http://localhost:8080/ws" class="bare">http://localhost:8080/ws</a></code></p></div>
<div class="ulist"><ul><li><p>soapUI</p></li></ul></div>
<div class="imageblock" style=""><img src="images/lesson03/soapUI.png" alt="soapUI" width="600"></div></section>
<section id="_spring_boot_web_services_starter"><h2>Spring Boot Web Services Starter</h2><div class="ulist"><ul><li><p>Starter für <strong>SOAP</strong> Web Services</p></li><li><p>Inkludiert <code>spring-boot-starter-web</code>, <code>jaxws-api</code> und <code>spring-ws-core</code></p></li></ul></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web-services<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre></section>
<section id="_jaxb"><h2>JAXB</h2><div class="ulist"><ul><li><p>Java Architecture for XML Binding</p></li><li><p>Marshalling und Unmarshalling von XML</p></li><li><p>Muss seit Java 9 explizit eingebunden werden</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;profiles&gt;</span>
    <span class="tag">&lt;profile&gt;</span>
        <span class="tag">&lt;id&gt;</span>java11<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;activation&gt;</span>
            <span class="tag">&lt;jdk&gt;</span>[11,)<span class="tag">&lt;/jdk&gt;</span>
        <span class="tag">&lt;/activation&gt;</span>

        <span class="tag">&lt;dependencies&gt;</span>
            <span class="tag">&lt;dependency&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.glassfish.jaxb<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>jaxb-runtime<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;/dependencies&gt;</span>
    <span class="tag">&lt;/profile&gt;</span>
<span class="tag">&lt;/profiles&gt;</span></code></pre></section>
<section id="_maven_jaxb_plugin"><h2>Maven JAXB Plugin</h2><div class="ulist"><ul><li><p>Generierung benötigter Klassen aus WSDL</p></li><li><p>Achtung: Spezifisch für konkrete Endpoints!</p></li><li><p>Aufruf: <code>mvn generate</code></p></li></ul></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.jvnet.jaxb2.maven2<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>maven-jaxb2-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>0.14.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;executions&gt;</span>
            <span class="tag">&lt;execution&gt;</span>
                <span class="tag">&lt;goals&gt;</span>
                    <span class="tag">&lt;goal&gt;</span>generate<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;/goals&gt;</span>
            <span class="tag">&lt;/execution&gt;</span>
        <span class="tag">&lt;/executions&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
            <span class="tag">&lt;schemaLanguage&gt;</span>WSDL<span class="tag">&lt;/schemaLanguage&gt;</span>
            <span class="tag">&lt;generatePackage&gt;</span>com.anderscore.soap<span class="tag">&lt;/generatePackage&gt;</span>
            <span class="tag">&lt;schemas&gt;</span>
                <span class="tag">&lt;schema&gt;</span>
                    <span class="tag">&lt;url&gt;</span>http://localhost:8080/ws/courses.wsdl<span class="tag">&lt;/url&gt;</span>
                <span class="tag">&lt;/schema&gt;</span>
            <span class="tag">&lt;/schemas&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre></section>
<section id="_implementierung_des_clients"><h2>Implementierung des Clients</h2><div class="ulist"><ul><li><p>Marshalling der Daten</p></li><li><p>Versenden eines SOAP/HTTP Requests</p></li><li><p>Unmarshalling der Response</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java">  <span class="directive">public</span> Course getCourse(<span class="predefined-type">String</span> title) {
    GetCourseRequest request = <span class="keyword">new</span> GetCourseRequest();
    request.setTitle(title);

    log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Requesting course with title </span><span class="delimiter">&quot;</span></span> + title);

    GetCourseResponse response = (GetCourseResponse) getWebServiceTemplate()
        .marshalSendAndReceive(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/ws/courses</span><span class="delimiter">&quot;</span></span>, request,
            <span class="keyword">new</span> SoapActionCallback(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.anderscore.com/soap/GetCourseRequest</span><span class="delimiter">&quot;</span></span>));

    <span class="keyword">return</span> response.getCourse();
  }</code></pre></section>
<section id="_spring_config_3"><h2>Spring Config</h2><div class="paragraph"><p>Konfiguration des Clients (inkl. XML Marshalling)</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">  <span class="comment">// (1) Bereitstellung eines (Un-)Marshallers zur Verarbeitung von SOAP Request und Response</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> Jaxb2Marshaller marshaller() {
    Jaxb2Marshaller marshaller = <span class="keyword">new</span> Jaxb2Marshaller();
    marshaller.setContextPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.anderscore.soap</span><span class="delimiter">&quot;</span></span>);

    <span class="keyword">return</span> marshaller;
  }

  <span class="comment">// (2) Definition des Clients</span>
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> CourseClient courseClient(Jaxb2Marshaller marshaller) {
    CourseClient client = <span class="keyword">new</span> CourseClient();
    client.setDefaultUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/ws</span><span class="delimiter">&quot;</span></span>);
    client.setMarshaller(marshaller);
    client.setUnmarshaller(marshaller);

    <span class="keyword">return</span> client;
  }</code></pre></section>
<section id="_aufgabe_5_soap_web_service_implementieren"><h2>Aufgabe 5: SOAP Web Service implementieren</h2><div class="olist arabic"><ol class="arabic"><li><p>Importieren Sie das Projekt <code>lesson03-boot-backend-soap</code> in ihre IDE.</p></li><li><p>Schauen Sie sich das vorbereitete XML Schema <code>tasks.xsd</code> an. Was wird hier definiert?</p></li><li><p>Führen Sie <code>mvn jaxb2:xjc</code> aus, um die benötigten Klassen aus dem XML Schema zu generieren und so die Compile Errors zu beseitigen.</p></li><li><p>Implementieren Sie die Methodenrümpfe der Klasse <code>TaskToMapperImpl</code>. Wozu benötigen wir neben der <code>TaskEntity</code> überhaupt noch ein <code>TaskTo</code>?</p></li><li><p>Implementieren Sie die Methodenrümpfe des <code>TaskEndpoints</code>. Denken Sie auch an die fehlenden Annotationen.</p></li><li><p>Ergänzen Sie die fehlenden Beans in der <code>SoapConfig</code>.</p></li><li><p>Starten Sie die Anwendung und testen Sie diese mittels curl (Inhalt: <code>getTaskRequest.xml</code>) oder soapUI.</p></li></ol></div></section>
<section id="_soap_web_services_testen"><h2>SOAP Web Services testen</h2><div class="ulist"><ul><li><p>Spring WS Test</p><div class="ulist"><ul><li><p><code>MockWebServiceClient</code>: Abfragen eines SOAP Web Service</p></li><li><p><code>RequestCreator</code>: Erstellen eines SOAP Requests</p></li><li><p><code>ResponseMatcher</code>: Prüfen der SOAP Response</p></li></ul></div></li></ul></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.ws<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-ws-test<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.7.4<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre></section>
<section id="_implementieren_eines_integration_tests"><h2>Implementieren eines Integration Tests</h2><pre class="CodeRay listingblock"><code class="java language-java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testGetCourse_Exists() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">Source</span> requestPayload = <span class="keyword">new</span> StringSource(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;as:getCourseRequest xmlns:as=</span><span class="char">\&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;as:id&gt;4711&lt;/as:id&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/as:getCourseRequest&gt;</span><span class="delimiter">&quot;</span></span>);

        <span class="predefined-type">Source</span> responsePayload = <span class="keyword">new</span> StringSource(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ns2:getCourseResponse xmlns:ns2=</span><span class="char">\&quot;</span><span class="content">http://www.anderscore.com/soap</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ns2:course&gt;&lt;ns2:id&gt;4711&lt;/ns2:id&gt;&lt;ns2:title&gt;Spring&lt;/ns2:description&gt;&lt;/ns2:task&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/ns2:getCourseResponse&gt;</span><span class="delimiter">&quot;</span></span>);

        Resource xsdSchema = <span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd/courses.xsd</span><span class="delimiter">&quot;</span></span>);

        mockClient
                .sendRequest(withPayload(requestPayload))
                .andExpect(noFault())
                .andExpect(payload(responsePayload))
                .andExpect(validPayload(xsdSchema));
    }</code></pre></section>
<section id="_aufgabe_6_soap_web_service_implementieren"><h2>Aufgabe 6: SOAP Web Service implementieren</h2><div class="olist arabic"><ol class="arabic"><li><p>Überprüfen Sie die einzelnen Operationen des Service über den <code>TaskEndpointMockTest</code>.</p></li><li><p>Überprüfen Sie im <code>TaskEndpointIntegrationTest</code>, ob Sie einen Task anlegen und danach auch wieder abrufen können.</p></li></ol></div></section>
<section id="_soap_3"><h2>SOAP</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0305-view.html">&#8594; Weiter zu Web-Frontend mit Spring</a></p></div></section>
<section id="_web_frontends_mit_spring" data-state="no-title-footer"><h2>Web-Frontends mit Spring</h2><div class="paragraph center"><p>Was fällt Ihnen dazu ein?</p></div></section>
<section><section id="_web_apps_grundlagen"><h2>Web-Apps Grundlagen</h2><div class="paragraph heading"><p>DispatcherServlet bei klassischer Webapplikation</p></div><div class="imageblock" style=""><img src="images/mvc-seq.svg" alt="mvc seq" width="1400" height="720"></div></section><section id="_view_controller"><h2>View-Controller</h2><div class="imageblock" style=""><img src="images/VC.svg" alt="VC" height="700"></div>
<div class="paragraph small"><small>Icons made by <a href="http://www.freepik.com">Freepik</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/">CC 3.0 BY</a></small></div></section><section id="_modell_view_controller_mvc"><h2>Modell-View-Controller (MVC)</h2><div class="imageblock" style=""><img src="images/MVC.svg" alt="MVC" height="720"></div></section><section id="_mvc_mit_spring"><h2>MVC mit Spring</h2><div class="imageblock" style=""><img src="images/MVC-Spring.svg" alt="MVC Spring" height="720"></div></section><section id="_spring_mvc_workflow_dispatcherservlet"><h2>Spring MVC Workflow (DispatcherServlet)</h2><div class="imageblock" style=""><img src="images/spring_dispatcherservlet.png" alt="spring dispatcherservlet"></div>
<div class="paragraph small"><small>by <a href="https://www.tutorialspoint.com/spring/images/spring_dispatcherservlet.png">tutorialspoint</a></small></div>
<div class="olist arabic"><ol class="arabic"><li><p><code>DispatcherServlet</code> ermittelt über <code>HandlerMapping</code> passenden <code>Controller</code></p></li><li><p><code>Contoller</code> verarbeitet Request, erzeugt Model und gibt Viewname an <code>DispatcherServlet</code> zurück</p></li><li><p><code>DispatcherServlet</code> ruft <code>ViewResolver</code> auf und erhält die passende View zurück</p></li><li><p><code>DispatcherServlet</code> übergibt Model an View-Rendering (JSP oder Template-Engine)</p></li></ol></div></section></section>
<section id="_von_spring_unterstützte_view_technologien"><h2>Von Spring unterstützte View-Technologien</h2><div class="ulist"><ul><li><p>Klassische Servlet-Technologien (JSPs, JSTL, Tiles) &#8592; funktiert nicht mit WebFlux</p></li><li><p>Template-Engines (Thymeleaf, FreeMaker, Groovy Markup)</p></li><li><p>Script Views (React, Mustache, Kotlin Script templating) &#8592; benötigen Skript-Engine</p></li><li><p>RSS und Atom</p></li><li><p>PDF und Excel</p></li><li><p>JSON, XML, XSLT-Views</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p><strong>Einfache Framework-Integration</strong></p></div>
<div class="ulist"><ul><li><p>Vaadin, ZK, Wicket</p></li><li><p>Angular, Polymer, &#8230;&#8203; (via REST)</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-view">
&#8594; Reference: View Technologies</a></p></div></section>
<section><section id="_thymeleaf"><h2>Thymeleaf</h2><div class="paragraph heading"><p>Eigenschaften von Thymeleaf</p></div><div class="ulist"><ul><li><p>Template-Engine (ohne Servlet-API, mit WebFlux verwendbar, einfach Testbar)</p></li><li><p>Templates sind HTML-konform (zugleich Prototyp)</p></li><li><p>Sehr gute Integration mit Spring Web MVC</p></li><li><p>Unterstützt Modularisierung von Webseiten</p></li><li><p>Kann Fragmente verarbeiten (AJAX, Portlets, wie Tiles)</p></li></ul></div></section><section id="_thymeleaf_templates"><h2>Thymeleaf Templates</h2><div class="ulist"><ul><li><p>Thymeleaf Templates sind normale HTML-Seiten (eignen sich also als Prototyp)</p></li><li><p>Die komplette Template-Logik wird in Attributen mit dem Präfix <strong>th:</strong> angegeben:</p><div class="literalblock"><div class="content"><pre>&lt;span th:text="${book.author.name}"&gt;Joshua Bloch&lt;/span&gt;</pre></div></div></li><li><p>Damit sind auch komplexere Konstrukte möglich:</p><div class="literalblock"><div class="content"><pre>&lt;ol&gt;
    &lt;li th:each="book : ${books}" th:text="${book.title}"&gt;Effective Java&lt;/li&gt;
&lt;/ol&gt;</pre></div></div></li><li><p>Durch Angabe des Namespace vermeidet man Warnungen in der IDE:</p><div class="literalblock"><div class="content"><pre>&lt;html xmlns:th="http://www.thymeleaf.org"&gt;</pre></div></div></li></ul></div></section><section id="_standard_ausdrücke"><h2>Standard Ausdrücke</h2><div class="ulist"><ul><li><p><strong><code>${&#8230;&#8203;}</code></strong>: Variable (beliebiger <em>SpringEL</em> Ausdruck)</p></li><li><p><strong><code>*{&#8230;&#8203;}</code></strong>: Selektion (ein Ast in einem Objektgraph)</p></li><li><p><strong><code>#{&#8230;&#8203;}</code></strong>: Message (i18n, verwendet Spring&#8217;s <code>MessageSource</code>)</p></li><li><p><strong><code>@{&#8230;&#8203;}</code></strong>: Link (URL: relativ, Context-relativ, Server-relativ, Protokoll-relativ oder absolut)</p></li><li><p><strong><code>~{&#8230;&#8203;}</code></strong>: Fragment (Teil eines HTML-Dokuments)</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Beispielsweise expandiert</p></div>
<div class="literalblock"><div class="content"><pre>${book.author.name}</pre></div></div>
<div class="paragraph"><p>zu</p></div>
<div class="literalblock"><div class="content"><pre>((Book)context.getVariable("book")).getAuthor().getName()</pre></div></div></section><section id="_dokumentation"><h2>Dokumentation</h2><div class="ulist"><ul><li><p><a href="https://www.thymeleaf.org">www.thymeleaf.org</a></p></li><li><p><a href="https://www.thymeleaf.org/doc/articles/standarddialect5minutes.html">Standard dialects in 5 minutes</a></p></li><li><p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Tutorial: Using Thymeleaf</a></p></li><li><p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html">Tutorial: Thymeleaf + Spring</a></p></li><li><p><a href="http://itutorial.thymeleaf.org/">Interactive Tutorial</a></p></li></ul></div></section></section>
<section><section id="_webservice_client_mit_resttemplate"><h2>Webservice-Client mit RestTemplate</h2><div class="paragraph heading"><p>RestTemplate erzeugen</p></div><div class="title">Einfachste Variante nutzt <code>java.net.URLConnection</code></div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
RestTemplate restTemplate() {
    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();
    <span class="keyword">return</span> restTemplate;
}</code></pre><div class="title">RestTemplate mit Interceptor</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
RestTemplate restTemplate() {
    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();
    restTemplate.getInterceptors().add(<span class="keyword">new</span> BasicAuthenticationInterceptor(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>));
    <span class="keyword">return</span> restTemplate;
}</code></pre></section><section id="_resttemplate_mit_apache_httpclient"><h2>RestTemplate mit Apache-HttpClient</h2><div class="title">TaskServiceConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
RestTemplate restTemplate() {
    CloseableHttpClient httpClient = HttpClients.createDefault();
    HttpComponentsClientHttpRequestFactory requestFactory = <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory();
    requestFactory.setHttpClient(httpClient);

    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(requestFactory);
    <span class="keyword">return</span> restTemplate;
}</code></pre>
<div class="paragraph"><p>HTTPS Client, der den Hostnamen nicht überprüft:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">CloseableHttpClient httpClient = HttpClients.custom()
            .setSSLHostnameVerifier(<span class="keyword">new</span> NoopHostnameVerifier())
            .build();</code></pre>
<div class="paragraph"><p>HTTPS Client, der selbst signierte Zertifikate akzeptiert:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">KeyStore</span> keyStore = <span class="predefined-type">KeyStore</span>.getInstance(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">mykeystore.jks</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray());
<span class="predefined-type">SSLContext</span> sslContext = SSLContexts.custom().loadTrustMaterial(keyStore, <span class="keyword">new</span> TrustSelfSignedStrategy()).build();
CloseableHttpClient httpClient = HttpClients.custom()
        .setSSLContext(sslContext)
        .build();</code></pre></section><section id="_resttemplate_verwenden"><h2>RestTemplate verwenden</h2><div class="title">TaskServiceImpl.java</div><pre class="CodeRay listingblock"><code class="java language-java">Task task = restTemplate.getForObject(tasksUrl + <span class="string"><span class="delimiter">&quot;</span><span class="content">/{id}</span><span class="delimiter">&quot;</span></span>, Task.class, taskId);</code></pre>
<div class="paragraph"><p>Ein Objekt senden:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">URI</span> uri = restTemplate.postForLocation(tasksUrl, task);</code></pre>
<div class="paragraph"><p>Wenn ein generischer Rückgabetyp erwartet wird:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">ResponseEntity&lt;<span class="predefined-type">List</span>&lt;Task&gt;&gt; response = restTemplate.exchange(tasksUrl, HttpMethod.GET, <span class="predefined-constant">null</span>,
        <span class="keyword">new</span> ParameterizedTypeReference&lt;<span class="predefined-type">List</span>&lt;Task&gt;&gt;() {
        });
<span class="predefined-type">List</span>&lt;Task&gt; tasks = response.getBody();</code></pre>
<div class="paragraph"><p>Die Methode <code>exchange</code> kann für alle Belange verwendet werden.</p></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring/docs/5.3.6/javadoc-api/org/springframework/web/client/RestTemplate.html">
&#8594; RestTemplate Javadocs</a></p></div></section><section id="_webservice_clients_testen"><h2>Webservice-Clients testen</h2><div class="title">RestClientTest.java</div><pre class="CodeRay listingblock"><code class="java language-java">var mockServer = MockRestServiceServer.createServer(restTemplate);
mockServer.expect(ExpectedCount.once(), requestTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://fakehost/tasks</span><span class="delimiter">&quot;</span></span>)).andExpect(method(HttpMethod.POST))
        .andExpect(jsonPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>, equalTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">OPEN</span><span class="delimiter">&quot;</span></span>)))
        .andExpect(content().string(containsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">JSONPath lernen</span><span class="delimiter">&quot;</span></span>)))
        .andExpect(header(HttpHeaders.AUTHORIZATION, equalTo(basicAuth)))
        .andRespond(withStatus(HttpStatus.BAD_REQUEST).contentType(MediaType.APPLICATION_JSON_UTF8)
                .body(<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">error</span><span class="char">\&quot;</span><span class="content">:{</span><span class="char">\&quot;</span><span class="content">code</span><span class="char">\&quot;</span><span class="content">:123, </span><span class="char">\&quot;</span><span class="content">message</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">Simulierter Fehler</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>));</code></pre>
<div class="ulist"><ul><li><p>Der <code>MockRestServiceServer</code> mockt einen REST-Server.</p></li><li><p>Man kann damit Requests auf bestimmte Inhalte und Header prüfen und</p></li><li><p>man kann Antworten mit beliebigen Headern, Inhalten und Status-Codes simulieren.</p></li></ul></div></section></section>
<section id="_aufgabe_7_rest_client_mit_thymeleaf_basiertem_web_frontend"><h2>Aufgabe 7: REST-Client mit Thymeleaf basiertem Web-Frontend</h2><div class="olist arabic"><ol class="arabic"><li><p>Erstellen Sie einen Unittest für den TaskService unter Verwendung von <code>MockRestServiceServer</code></p></li><li><p>Machen Sie sich mit der Frontend-Applikation vertraut und bringen Sie diese zum Laufen.
Welche Einträge müssen Sie in der <em>application.properties</em> ergänzen?</p></li><li><p>Verfolgen Sie den Spring MVC-Workflow mit dem Debugger. Nutzen Sie dazu das <em>Hello World</em> Beispiel
und setzen Sie einen Breakpoint in der <code>doService</code> Methode des <code>DispatcherServlet</code>.</p></li><li><p><em>Optional:</em> Internationalisieren Sie die Status-Anzeige</p></li><li><p><em>Optional:</em> Ergänzen Sie in der Aufgabenliste einen Button zum Weiterschalten des Status</p></li><li><p><em>Optional:</em> Bearbeiten Sie die Aufgaben in <a href="http://itutorial.thymeleaf.org/">
Interactive Thymeleaf Tutorial</a></p></li></ol></div></section>
<section id="_web_frontend_mit_spring"><h2>Web-Frontend mit Spring</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0306-starter.html">&#8594; Weiter zu Spring-Boot Starter</a></p></div></section>
<section id="_wie_funktioniert_spring_boot_intern" data-state="no-title-footer"><h2>Wie funktioniert Spring-Boot intern?</h2><div class="paragraph center"><p>Was ist ein Starter?</p></div></section>
<section id="_funktionsweise_von_spring_boot"><h2>Funktionsweise von Spring-Boot?</h2><div class="paragraph heading"><p>Themen</p></div>
<div class="ulist"><ul><li><p>Autokonfiguration</p></li><li><p>Verarbeitung der application.properties</p></li><li><p>Was ist ein Starter?</p></li><li><p>Starter implementieren</p></li></ul></div></section>
<section><section id="_autokonfiguration"><h2>Autokonfiguration</h2><div class="paragraph heading"><p>Wie funktioniert die Autokonfiguration?</p></div><div class="paragraph"><p>In der Startup-Phase sucht Spring-Boot alle <code>META-INF/spring.factories</code> im <em>classpath</em>.<br>
Hier ist ein Ausschnitt dieser Datei aus
<a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories">
&#8594; spring-boot-autoconfigure</a>:</p></div><pre class="CodeRay listingblock"><code># Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</code></pre></section><section id="_eine_autokonfigurationsklasse"><h2>Eine Autokonfigurationsklasse</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@ConditionalOnClass</span>({RabbitTemplate.class, <span class="predefined-type">Channel</span>.class}) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@EnableConfigurationProperties</span>({RabbitProperties.class}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Import</span>({RabbitAnnotationDrivenConfiguration.class})
<span class="directive">public</span> <span class="type">class</span> <span class="class">RabbitAutoConfiguration</span> {</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Nur wenn diese Klassen im <em>classpath</em> vorhanden sind</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Erstellt <code>RabbitProperties</code> Bean</td></tr></table></div></section><section id="_bean_deklaration_in_einer_autokonfigurationsklasse"><h2>Bean-Deklaration in einer Autokonfigurationsklasse</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="annotation">@ConditionalOnSingleCandidate</span>(ConnectionFactory.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@ConditionalOnProperty</span>(prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">spring.rabbitmq</span><span class="delimiter">&quot;</span></span>,
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic</span><span class="delimiter">&quot;</span></span>, matchIfMissing = <span class="predefined-constant">true</span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@ConditionalOnMissingBean</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="directive">public</span> AmqpAdmin amqpAdmin(ConnectionFactory connectionFactory) {
    <span class="keyword">return</span> <span class="keyword">new</span> RabbitAdmin(connectionFactory);
}</code></pre>
<div class="paragraph"><p>Erzeugt die <code>RabbitAdmin</code> Bean nur,</p></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>wenn es genau eine <code>ConnectionFactory</code> gibt,</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>wenn <code>spring.rabbitmq.dynamic=true</code> oder nicht vorhanden und</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>wenn noch keine <code>AmqpAdmin</code> Bean vorhanden ist.</td></tr></table></div></section></section>
<section><section id="_verarbeitung_der_application_properties"><h2>Verarbeitung der application.properties</h2><div class="paragraph"><p>Konfigurationswerte werden bei Spring-Boot über eine Konfigurationsklasse definiert:</p></div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ConfigurationProperties</span>(prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">spring.rabbitmq</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RabbitProperties</span> {

    <span class="comment">/**
     * RabbitMQ host. <i class="conum" data-value="3"></i><b>(3)</b>
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> host = <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="2"></i><b>(2)</b></code></pre><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Präfix für alle Properties</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Property <code>spring.rabbitmq.host</code> mit Voreinstellung <code>localhost</code></td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Beschreibung für Metadaten</td></tr></table></div></section><section id="_konfigurationsmetadaten"><h2>Konfigurationsmetadaten</h2><div class="imageblock" style=""><img src="images/application-properties-syntax.png" alt="application properties syntax" width="1200"></div>
<div class="ulist"><ul><li><p>Metadaten zu den Konfigurationsklassen werden<br>
in <code>META-INF/spring-configuration-metadata.json</code> gespeichert</p></li><li><p>IDEs nutzen diese zur Syntaxvervollständigung</p></li><li><p>Metadaten können mit einem Annotation Processor erzeugt werden:</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="xml language-xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;optional&gt;</span>true<span class="tag">&lt;/optional&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre></section></section>
<section id="_spring_boot_starter"><h2>Spring Boot Starter</h2><div class="ulist"><ul><li><p>Starter bestehen aus leerem <em>.jar</em></p></li><li><p>Definieren nur die Abhängigkeiten (POM)</p></li><li><p>Wertvoll in Kombination mit</p><div class="ulist"><ul><li><p>gepflegter Liste von Abhängigkeiten (keine Versionsangaben!)</p></li><li><p>Autokonfiguration</p></li></ul></div></li><li><p>Konvention für eigene Implementierungen: Endung <code>-spring-boot-starter</code></p></li></ul></div>
<div class="paragraph"><p>Beispiel:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre></section>
<section id="_aufgabe_8a_komponenten_von_spring_boot_ergründen"><h2>Aufgabe 8a: Komponenten von Spring-Boot ergründen</h2><div class="paragraph"><p>Sehen Sie sich folgendes an:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Die Datei <code>META-INF/spring.factories</code> in der <code>spring-boot-autoconfigure-2.x.y.jar</code></p></li><li><p>Die Klasse <code>RabbitAutoConfiguration</code></p></li><li><p>Die Klasse <code>RabbitProperties</code></p></li><li><p>Den Inhalt der <code>spring-boot-starter-data-jpa-2.x.y.jar</code> und den</p></li><li><p>Inhalt der zugehörigen POM im Maven/Gradle Repository</p></li><li><p>Die POM von <code>spring-boot-starter-parent</code> und</p></li><li><p>Die POM von <code>spring-boot-dependencies</code></p></li></ol></div>
<div class="paragraph"><p>Welchen Zweck hat jede dieser Dateien jeweils?</p></div></section>
<section id="_aufgabe_8b_einen_starter_implementieren_und_einbinden"><h2>Aufgabe 8b: Einen Starter implementieren und einbinden</h2><div class="olist arabic"><ol class="arabic"><li><p>Sehen Sie sich die Implementierungen für <code>coffee-break-reminder</code> und
<code>coffee-break-reminder-spring-boot-autoconfigure</code> an.
Ergänzen Sie ein entsprechendes <code>@ConditionalOnClass</code> so, dass der <em>CoffeeBreakReminder</em> nur
konfiguriert wird, wenn <code>org.slf4j.Logger</code> im <em>classpath</em> vorhanden ist.</p></li><li><p>Der <em>CoffeeBreakReminder</em> soll über die <code>CoffeeBreakReminderProperties</code> mit Präfix <em>springtraining.cbr</em>
in den <em>application.properties</em> konfigurierbar sein. Ergänzen Sie die dafür notwendigen <code>@EnableConfigurationProperties</code>
und <code>@ConfigurationProperties</code> Annotationen.</p></li><li><p>Erstellen Sie die Datei <code>META-INF/spring.factories</code> für <code>coffee-break-reminder-spring-boot-autoconfigure</code>.
Sie benötigen darin nur einen Eintrag für <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>.</p></li><li><p>Fügen Sie dem <code>coffee-break-reminder-spring-boot-autoconfigure</code> eine Abhängigkeit zum
Annotation Processor <code>org.springframework.boot:spring-boot-configuration-processor</code>
hinzu. Was bewirkt diese Änderung?</p><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Sehen Sie in das META-INF Verzeichnis der kompilierten Klassen.</td></tr></table></div></li><li><p>Woraus besteht das <code>coffee-break-reminder-spring-boot-starter</code> Modul? Binden Sie es
in den Frontend-Server ein und konfigurieren Sie es. Klappt es?</p></li></ol></div></section>
<section id="_zusammenfassung_spring_boot"><h2>Zusammenfassung Spring Boot</h2><div class="ulist"><ul><li><p>Spring Boot:</p><div class="ulist"><ul><li><p>Abgestimmte Bibliotheksabhängigkeiten</p></li><li><p>Automatische Konfiguration</p></li><li><p>Kein Application-Server notwendig</p></li></ul></div></li><li><p>Datenbankzugriff per JPA</p></li><li><p>REST Webservice mit Spring MVC</p></li><li><p>SOAP Webservice mit Spring WS</p></li><li><p>Webanwendung mit Thymeleaf</p></li><li><p>Spring Boot Starter implementieren</p></li></ul></div></section>
<section id="_lektion_4_spring_security" data-state="no-title-footer"><h2>Lektion 4 - Spring-Security</h2><div class="openblock center"><div class="content"><div class="paragraph"><p>Was fällt Ihnen zum Thema Security ein?</p></div>
<div class="paragraph"><p>Welche Unterstützung erwarten Sie von Spring?</p></div></div></div></section>
<section id="_spring_security"><h2>Spring-Security</h2><div class="paragraph heading"><p>Themen</p></div>
<div class="ulist"><ul><li><p>Grundlagen zu IT-Sicherheit</p></li><li><p>Servlet Filter: Querschnittliche Funktionalität bei Webanwendungen</p></li><li><p>Spring Security Bausteine</p></li><li><p>Authentifzierung mit Spring</p></li><li><p>Authentifzierung bei einer Webanwendung</p></li><li><p>Autorisierung</p></li><li><p>Spring Security Konfiguration</p></li><li><p>Grundlagen zu OAuth2</p></li><li><p>Login mit OAuth2</p></li></ul></div></section>
<section><section id="_security_grundlagen"><h2>Security Grundlagen</h2><div class="paragraph heading"><p>IT-Sicherheit</p></div><div class="paragraph"><p>Es gibt drei Grundwerte der Informationssicherheit:</p></div><div class="ulist"><ul><li><p>Vertraulichkeit,</p></li><li><p>Verfügbarkeit und</p></li><li><p>Integrität.</p></li></ul></div><div class="paragraph"><p>Quelle: <a href="https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Grundschutz/Leitfaden/GS-Leitfaden_pdf.pdf?__blob=publicationFile&amp;v=3">Leitfaden Informationssicherheit</a>,<br>
<a href="https://www.bsi.bund.de">Bundesamt für Sicherheit in der Informationstechnik – BSI</a></p></div></section><section id="_it_sicherheit_mit_spring_security"><h2>IT-Sicherheit mit Spring-Security</h2><div class="paragraph"><p>Es gibt drei Grundwerte der Informationssicherheit:</p></div>
<div class="ulist"><ul><li><p>Vertraulichkeit, &#8658; Spring Security:</p><div class="ulist"><ul><li><p>Authentifizierung &#8658; Anwender identifizieren</p></li><li><p>Autorisierung &#8658; Berechtigung prüfen</p></li></ul></div></li><li><p>Verfügbarkeit und</p></li><li><p>Integrität.</p></li></ul></div></section><section id="_security_bei_spring_webanwendungen"><h2>Security bei Spring Webanwendungen</h2><div class="ulist"><ul><li><p>Security ist ein Querschnittsthema (AOP)</p></li><li><p>Erste Berechtigungsprüfung anhand der URL</p></li><li><p>Securitybelange über Filterkette realisiert</p></li></ul></div></section><section id="_servlet_filterchain_of_responsibility"><h2>Servlet Filter&#8201;&#8212;&#8201;Chain of Responsibility</h2><div class="imageblock" style=""><img src="images/filter.svg" alt="filter" width="1000" height="720"></div></section><section id="_servlet_filterverarbeitung_abgebrochen"><h2>Servlet Filter&#8201;&#8212;&#8201;Verarbeitung abgebrochen</h2><div class="imageblock" style=""><img src="images/filter-stopped.svg" alt="filter stopped" width="1000" height="600"></div></section></section>
<section id="_aufgabe_1_spring_security_aktivieren"><h2>Aufgabe 1: Spring Security aktivieren</h2><div class="olist arabic"><ol class="arabic"><li><p>Machen Sie sich mit der Beispielanwendung vertraut und stellen Sie sicher, dass sie läuft.</p></li><li><p>Fügen Sie die <code>spring-boot-starter-security</code> Abhängigkeit hinzu. Was ändert sich?</p><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content"><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-security">
Spring-Boot Reference: Security</a> für Hinweise zu User und Passwort.</td></tr></table></div></li><li><p>Setzen Sie einen Breakpoint in der Methode <code>org.springframework.web.servlet.DispatcherServlet.doService</code>
und rufen Sie <a href="http://localhost:8080/actuator/health" class="bare">http://localhost:8080/actuator/health</a> auf. Was fällt Ihnen am Stacktrace auf?</p></li><li><p>Suchen Sie den Anfang der Filter-Kette und ermitteln Sie über das Feld <code>ApplicationFilterChain.filters</code>
welche Filter durchlaufen werden.</p></li><li><p>In der Kette finden Sie die <code>springSecurityFilterChain</code>. Dabei handelt es sich um die Klasse
<code>org.springframework.security.web.FilterChainProxy</code>, die wiederum weitere Filter mitbringt.
Wieviele sind das?</p></li><li><p>Schalten Sie das Debug-Logging für diese Klasse ein mit:</p><div class="literalblock"><div class="content"><pre>logging.level.org.springframework.security.web=DEBUG</pre></div></div>
<div class="paragraph"><p>Welcher Filter verhindert einen Zugriff ohne Authentifizierung?</p></div></li></ol></div></section>
<section><section id="_spring_security_grundlagen"><h2>Spring Security Grundlagen</h2><div class="paragraph heading"><p>Java Security Grundbegriffe</p></div><div class="paragraph"><p>JAAS (Java Authentication and Authorization Service):</p></div><div class="imageblock" style=""><img src="images/subject.svg" alt="subject" width="1000" height="600"></div></section><section id="_spring_securitycontext"><h2>Spring SecurityContext</h2><div class="imageblock" style=""><img src="images/SecurityContext.svg" alt="SecurityContext" width="1600" height="600"></div></section><section id="_zugriff_auf_das_authentication_objekt"><h2>Zugriff auf das Authentication Objekt</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> <span class="predefined-type">String</span> getUsername() {
    <span class="predefined-type">Object</span> principal = SecurityContextHolder
            .getContext().getAuthentication().getPrincipal();

    <span class="predefined-type">String</span> username;
    <span class="keyword">if</span> (principal <span class="keyword">instanceof</span> UserDetails) {
        username = ((UserDetails) principal).getUsername();
    } <span class="keyword">else</span> {
        username = principal.toString();
    }
    <span class="keyword">return</span> username;
}</code></pre></section><section id="_was_geschieht_bei_der_authentifizierung"><h2>Was geschieht bei der Authentifizierung</h2><div class="olist arabic"><ol class="arabic"><li><p>Username/Passwort eingeben</p></li><li><p>Prüfen, ob beides gültig (erfolgreich)</p></li><li><p>Userdaten (u. a. Rollen) laden</p></li><li><p>SecurityContext anlegen</p></li><li><p>User arbeitet mit der Anwendung</p></li></ol></div></section><section id="_authentifizierung_mit_spring_security"><h2>Authentifizierung mit Spring Security</h2><div class="olist arabic"><ol class="arabic"><li><p>UsernamePasswordAuthenticationToken wird erzeugt</p></li><li><p>Token wird mit <code>AuthenticationManager</code> geprüft</p></li><li><p><code>AuthenticationManager</code> gibt vollständige <code>Authentication</code> zurück</p></li><li><p>diese wird mit <code>SecurityContextHolder.getContext().setAuthentication(…​)</code> gespeichert</p></li></ol></div>
<div class="paragraph"><p>Siehe <a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#overall-architecture">
&#8594; Spring Security Reference: 8. Architecture and Implementation</a></p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Beim Lesen der Security Reference mit Kapitel 8 beginnen!</td></tr></table></div></section><section id="_authenticationmanager_beispiel"><h2>AuthenticationManager Beispiel</h2><div class="title">AuthenticationExampleTest.java</div><pre class="CodeRay listingblock"><code class="java language-java">Authentication request = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password);
Authentication result = am.authenticate(request);
SecurityContextHolder.getContext().setAuthentication(result);</code></pre>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">SampleAuthenticationManager</span> <span class="directive">implements</span> AuthenticationManager {

    <span class="directive">public</span> Authentication authenticate(Authentication auth)
            <span class="directive">throws</span> <span class="exception">AuthenticationException</span> {
        <span class="keyword">if</span> (auth.getName().equals(auth.getCredentials())) {
            <span class="keyword">return</span> <span class="keyword">new</span> UsernamePasswordAuthenticationToken(auth.getName(),
                    auth.getCredentials(), AUTHORITIES);
        }
        <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bad Credentials</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section><section id="_authentifizierung_bei_einer_webanwendung"><h2>Authentifizierung bei einer Webanwendung</h2><div class="olist arabic"><ol class="arabic"><li><p>Anwender besucht Startseite und klickt auf einen Link</p></li><li><p>Anfrage geht an Server, dieser stellt fest: Seite ist geschützt</p></li><li><p>Server antwortet: Authentifizierung erforderlich (401 oder redirect)</p></li><li><p>Anwender gibt Username und Passwort im Browser ein</p></li><li><p>Browser schickt Daten an Server</p></li><li><p>Server prüft Anmeldedaten</p></li><li><p>Server löst Weiterleitung auf geschützte Seite aus</p></li></ol></div>
<div class="paragraph"><p>Spring hat dafür jeweils verschiedene Klassen, die wichtigsten (in der Reihenfolge
ihrer Verwendung)&#8230;&#8203;</p></div></section><section id="_klassen_für_web_security"><h2>Klassen für Web Security</h2><div class="dlist"><dl><dt class="hdlist1">ExceptionTranslationFilter</dt><dd><p>Fängt Spring Security Exceptions, wie z. B. <code>BadCredentialsException</code> oder <code>AccessDeniedException</code>,
ab und gibt entsprechende HTTP-Statuscodes zurück oder startet <code>AuthenticationEntryPoint</code></p></dd><dt class="hdlist1">AuthenticationEntryPoint</dt><dd><p>Schritt 3: <em>"Server antwortet: Authentifizierung erforderlich"</em></p></dd><dt class="hdlist1">UsernamePasswordAuthenticationFilter (allg. Authentifizierungsmechanismus) </dt><dd><p>Schritt 6:
<em>"Server prüft Anmeldedaten"</em> &#8594; Verwendet <code>AuthenticationManager</code> und speichert
<code>Authentication</code> mittels <code>SecurityContextHolder</code></p></dd><dt class="hdlist1">SecurityContextPersistenceFilter</dt><dd><p>Speichert <code>SecurityContext</code> zwischen Requests (standardmäßig
in Session)</p></dd><dt class="hdlist1">FilterSecurityInterceptor</dt><dd><p>Ist <code>AbstractSecurityInterceptor</code>, der die <em>Autorisierung</em> realisiert</p></dd></dl></div></section><section id="_autorisierung"><h2>Autorisierung</h2><div class="paragraph"><p>Zugriffsberechtigungen prüft der <code>AccessDecisionManager</code> in der <code>decide</code> Methode:</p></div>
<div class="literalblock"><div class="content"><pre>void decide(Authentication authentication, Object object,
		Collection&lt;ConfigAttribute&gt; configAttributes) throws AccessDeniedException,
		InsufficientAuthenticationException;</pre></div></div>
<div class="paragraph"><p>Das <code>object</code> ist das gesichterte Objekt, im allg. ein Methodenaufruf oder ein Web-Request</p></div>
<div class="paragraph"><p>Die Berechtigungsprüfung ist über einen Around-Advise (mittels Spring-AOP bei Methodenaufrufen und
Filter bei Web-Requests) realisiert.<br>
Dieser ist eine Subklasse von <code>AbstractSecurityInterceptor</code>.</p></div></section><section id="_abstractsecurityinterceptor_workflow"><h2>AbstractSecurityInterceptor Workflow</h2><div class="olist arabic"><ol class="arabic"><li><p>Konfigurationsattribute für Aufruf laden</p></li><li><p><code>AccessDecisionManager.decide()</code> aufrufen</p></li><li><p>Bei Bedarf <code>Authentication</code> für Aufruf ändern (<code>RunAsManager</code>)</p></li><li><p>Aufruf durchführen</p></li><li><p>AfterInvocationManager aufrufen (falls konfiguriert)</p></li></ol></div>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Wenn dieser Workflow durchlaufen wird, enthält der <code>SecurityContextHolder</code> eine valide <code>Authentication</code></td></tr></table></div></section><section id="_was_sind_konfigurationsattribute"><h2>Was sind Konfigurationsattribute?</h2><div class="ulist"><ul><li><p>Ein <code>ConfigAttribute</code> ist ein Zeichenkette, die eine besondere Bedeutung für die Klassen hat,
die der <code>AbstractSecurityInterceptor</code> verwendet, z. B. Rollennamen.</p></li><li><p>Sie werden normalerweise über Methoden-Annotationen angegeben (<code>@PreAuthorize</code>, <code>@Secured</code>).</p></li><li><p>Der <code>AbstractSecurityInterceptor</code> verwendet eine <code>SecurityMetadataSource</code>, um die
Konfigurationsattribute für ein gesichertes Objekt zu laden.</p></li></ul></div></section><section id="_securitymetadatasource"><h2>SecurityMetadataSource</h2><div class="imageblock" style=""><img src="images/SecurityMetadataSource.png" alt="SecurityMetadataSource" height="720"></div></section></section>
<section><section id="_security_konfiguration"><h2>Security-Konfiguration</h2><div class="paragraph heading"><p>Basic Authentication</p></div><div class="title">BasicLoginTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span> <span class="comment">// nicht notwendig bei Spring-Boot</span>
<span class="annotation">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="predefined-constant">true</span>)
<span class="directive">static</span> <span class="type">class</span> <span class="class">SecurityConfig</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
        http.authorizeRequests()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/js/**</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/css/**</span><span class="delimiter">&quot;</span></span>).permitAll()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/admin/**</span><span class="delimiter">&quot;</span></span>)
                    .hasAuthority(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>) <span class="comment">// alternativ: hasRole(&quot;ADMIN&quot;)</span>
                .anyRequest().authenticated()
                .and().httpBasic(); <span class="comment">// basic authentication</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PasswordEncoder encoder = PasswordEncoderFactories.createDelegatingPasswordEncoder();
        auth.inMemoryAuthentication()
                .withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">hugo</span><span class="delimiter">&quot;</span></span>)
                .password(encoder.encode(<span class="string"><span class="delimiter">&quot;</span><span class="content">pwd123</span><span class="delimiter">&quot;</span></span>))
                .authorities(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>) <span class="comment">// alternativ: roles(&quot;USER&quot;)</span>
        .and().withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">fritz</span><span class="delimiter">&quot;</span></span>).password(encoder.encode(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret123</span><span class="delimiter">&quot;</span></span>)).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section><section id="_login_formular"><h2>Login-Formular</h2><div class="title">WebAuthenticationTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
    http.authorizeRequests()
            .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/unauthorized</span><span class="delimiter">&quot;</span></span>).permitAll()
            .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/admin/**</span><span class="delimiter">&quot;</span></span>).hasRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
            .anyRequest().authenticated()
            .and().formLogin()
                .loginPage(<span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>) <span class="comment">// Login-Seite</span>
                .failureUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/login?error=bad_credentials</span><span class="delimiter">&quot;</span></span>)<span class="comment">// falls Login fehlgeschlagen</span>
                .defaultSuccessUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/secured</span><span class="delimiter">&quot;</span></span>) <span class="comment">// wenn kein Referer gesetzt war</span>
            .and().logout()<span class="comment">// bei Logout</span>
                .deleteCookies(<span class="string"><span class="delimiter">&quot;</span><span class="content">JSESSIONID</span><span class="delimiter">&quot;</span></span>) <span class="comment">// cookie loeschen</span>
                .logoutUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/logout</span><span class="delimiter">&quot;</span></span>) <span class="comment">// Logout-Seite</span>
                .logoutSuccessUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>); <span class="comment">// nach dem Logout</span>
}</code></pre>
<div class="paragraph"><p>Siehe <a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#jc-authorize-requests">Spring Security Reference: 6.4 Authorize Requests</a></p></div></section><section id="_absichern_einer_methode"><h2>Absichern einer Methode</h2><div class="title">BasicLoginTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protected</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@PreAuthorize</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasRole('ADMIN')</span><span class="delimiter">&quot;</span></span>)  <span class="comment">// alternativ: hasAuthority('ROLE_ADMIN')</span>
<span class="directive">public</span> <span class="predefined-type">String</span> protectedGreeting() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Protected World!</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
<div class="paragraph"><p>Neben <code>hasRole([role])</code> gibt es u. a. <code>hasAnyRole([role1,role2])</code>, <code>isAuthenticated()</code>, <code>isAnonymous()</code>,
oder <code>hasPermission(Object target, Object permission)</code>.</p></div>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Dafür ist <code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code> notwendig!</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#el-access">&#8594; Spring Security Reference: Expression-Based Access Control</a></p></div></section><section id="_datenabhängige_zugriffsbeschränkungen"><h2>Datenabhängige Zugriffsbeschränkungen</h2><div class="ulist"><ul><li><p>Neben <code>@PreAuthorize</code> gibt es noch ein <code>@PostAuthorize</code> um Berechtigung abhängig von den geladenen Daten zu prüfen</p></li><li><p>Mit <code>@PreFilter</code> und <code>@PostFilter</code> kann man Collections filtern</p></li><li><p>Spring bietet mit <code>spring-security-acl</code> ein API zum Verwalten von Domain-Objekt abhängigen Zugriffsberechtigung (ACLs)</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#domain-acls">&#8594; Spring Security Reference: Domain Object Security (ACLs)</a><br>
<a href="https://jaxenter.de/ausgaben/java-magazin-4-18">&#8594; Javamagazin 04.2018, Seite 37ff.</a></p></div></section></section>
<section><section id="_aufgabe_2_sichern_sie_ihre_webapplikation_ab_2_teile"><h2>Aufgabe 2: Sichern Sie Ihre Webapplikation ab (2 Teile)</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie im <code>GreetingController</code> die <code>getCurrentUsername</code> Methode so, dass Sie über den
<code>SecurityContextHolder</code> den Loginnamen des aktuellen Benutzers ausgibt. Mit einem GET-Request
auf <code>/authenticated</code> sollte danach der Benutzername ausgegeben werden.</p></li><li><p>Ändern Sie die Klasse <code>SecurityConfig</code> so, dass sie <code>WebSecurityConfigurerAdapter</code> erweitert.
Überschreiben Sie <code>configure(WebSecurity)</code> und aktvieren Sie mit <code>web.debug(true)</code> das
Debug-Logging für die Security.</p></li><li><p>Verwenden Sie <code>inMemoryAuthentication()</code> um zwei Benutzer mit verschiedenen Rollen, z. B. <code>ROLE_USER</code> und
<code>ROLE_ADMIN</code> in der entsprechenden <code>configure</code> Methode anzulegen.</p></li><li><p>Nutzen Sie das <code>HttpSecurity</code> Objekt aus der zugehörigen <code>configure</code>-Methode, um die Anwendung so
zu konfigurieren, dass jeder die Startseite <code>/</code> und <code>anonymous</code> aufrufen kann.
Dagegen darf <code>/authenticated</code> nur authentifizierten Benutzern zugänglich sein.</p></li><li><p>Ergänzen Sie Ihre Security-Konfiguration derart, dass <code>/admin/greeting</code> nur für Benutzer mit der
Rolle <code>ROLE_ADMIN</code> zugänglich ist.</p></li></ol></div><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Nutzen Sie die Codefragmente aus den Tests im Package <code>security.fragments</code> als Vorlage.</td></tr></table></div></section><section id="_teil_2_außerhalb_von_securityconfig"><h2>Teil 2: Außerhalb von SecurityConfig</h2><div class="olist arabic"><ol class="arabic" start="6"><li><p>Was bewirkt die Einstellung <code>server.error.whitelabel.enabled=false</code>?</p></li><li><p>Erstellen Sie eine eigene Fehlerseite für fehlende Berechtigung (HTTP-Statuscode 403).</p></li><li><p>Schränken Sie nun, analog zu Schritt 5, <code>/user/greeting</code> auf Benutzer mit <code>ROLE_USER</code> ein.
Verändern Sie <strong>nicht</strong> die <code>SecurityConfig</code>, sondern verwenden Sie stattdessen die
<code>@PreAuthorize</code> Annotation.</p><div class="admonitionblock caution teacherBox"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Vergessen Sie nicht <code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code> anzugeben!</td></tr></table></div></li><li><p><em>Optional:</em>
Legen Sie eine eigene Login-Seite an und binden Sie diese statt der Default-Loginseite ein.</p><div class="admonitionblock caution teacherBox"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Zum Logout müssen Sie dann statt dem GET-Request einen POST-Request senden.</td></tr></table></div></li><li><p><em>Optional:</em>
Verwenden Sie statt der inMemoryAuthentication() einen eigenen <code>UserDetailsService</code>.</p></li></ol></div></section></section>
<section id="_spring_security_2"><h2>Spring-Security</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0402-oauth2.html">&#8594; Weiter zu OAuth2</a></p></div></section>
<section id="_oauth2" data-state="no-title-footer"><h2>OAuth2</h2><div class="paragraph center"><p>Was wissen Sie dazu?</p></div></section>
<section><section id="_oauth2_2"><h2>OAuth2</h2><div class="paragraph heading"><p>The OAuth 2.0 Authorization Framework</p></div><div class="quoteblock"><blockquote><div class="paragraph"><p>The OAuth 2.0 authorization framework enables a third-party
application to obtain limited access to an HTTP service, either on
behalf of a resource owner by orchestrating an approval interaction
between the resource owner and the HTTP service, or by allowing the
third-party application to obtain access on its own behalf.</p></div></blockquote><div class="attribution">&#8212; <a href="https://tools.ietf.org/html/rfc6749">&#8594; RFC6749</a></div></div><div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><em>"Authorization Framework"</em>, nicht <em>Authentication</em></td></tr></table></div><div class="paragraph"><p>Siehe auch: <a href="https://oauth.net/2/" class="bare">https://oauth.net/2/</a></p></div></section><section id="_hintergründe"><h2>Hintergründe</h2><div class="ulist"><ul><li><p>OAuth ist zwischen Nov. 2006 und Okt. 2007 entstanden,
hauptsächlich von Twitter, ma.gnolia, Yahoo und Google entwickelt.</p></li><li><p>Ziel war es, ein standardisiertes Protokoll zu spezifizieren,
mit dem ein Nutzer einer Webanwendung erlauben kann, in seinem Namen auf ein API
zuzugreifen, ohne dass die Clientwebanwendung Kenntnisse
über Nutzername und Passwort des Nutzers beim API-Anbieter haben muss.</p></li><li><p>OAuth2 ist seit Okt. 2012 ein Standard und ist gegenüber der
Vorversion einfacher und flexibler.</p></li><li><p>OAuth2 wird oft nur zur Authentifizierung verwendet.</p></li></ul></div></section><section id="_oauth_rollen"><h2>OAuth Rollen</h2><div class="dlist"><dl><dt class="hdlist1">Resource Owner</dt><dd><p>Person, die entscheidet, wer auf ihre Daten zugreifen darf, z. B. ein Nutzer von Google-Drive.</p></dd><dt class="hdlist1">Resource Server</dt><dd><p>Server, der die geschützten Ressourcen hosted, z. B. die Webanwendung hinter Google-Drive.</p></dd><dt class="hdlist1">Client</dt><dd><p>Eine Anwendung, die auf die Ressourcen auf dem <em>Resource Server</em>
zugreifen möchte, z. B. auf das Google-Drive des
<em>Resource Owner</em>.</p></dd><dt class="hdlist1">Authorization Server</dt><dd><p>Dienst, der dem <em>Client</em> ein Zugangstoken ausstellt, mit dem er auf die
Ressourcen zugreifen kann, nachdem der <em>Ressource Owner</em> ihn dafür
autorisiert hat.</p></dd></dl></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Zwischen <em>Resource Server</em> und <em>Authorization Server</em> besteht ein Vertrauensverhältnis.</td></tr></table></div></section><section id="_authorization_code_flow"><h2>Authorization Code Flow</h2><div class="imageblock" style=""><img src="images/oauth2-protokoll.svg" alt="oauth2 protokoll" width="1200" height="680"></div>
<div class="paragraph"><p><a href="https://tools.ietf.org/html/rfc6749#section-4.1">&#8594; RFC6749: 4.1. Authorization Code Grant</a></p></div></section><section id="_login_mit_oauth2"><h2>Login mit OAuth2</h2><div class="paragraph"><p>Notwendige Abhängigkeiten:</p></div>
<div class="literalblock"><div class="content"><pre>compile 'org.springframework.security:spring-security-oauth2-client'
compile 'org.springframework.security:spring-security-oauth2-jose'</pre></div></div>
<div class="paragraph"><p>Anpassungen im <code>WebSecurityConfigurerAdapter</code>:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
...
.and().oauth2Login();</code></pre></section><section id="_oauth2_konfiguration"><h2>OAuth2 Konfiguration</h2><div class="title">application-outh2.properties</div><pre class="CodeRay listingblock"><code>spring.security.oauth2.client.registration.google.client-id=${client-id}
spring.security.oauth2.client.registration.google.client-secret=${client-secret}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-security-oauth2-common-providers">
&#8594; Spring Security Reference: 28.3 OAuth2</a></p></div></section></section>
<section id="_anmeldedaten_mit_google_cloud_api"><h2>Anmeldedaten mit Google-Cloud API</h2><div class="imageblock" style=""><img src="images/Google-Cloud-Anmeldedaten.png" alt="Google Cloud Anmeldedaten" height="700"></div>
<div class="paragraph"><p><a href="https://console.cloud.google.com/apis/dashboard" class="bare">https://console.cloud.google.com/apis/dashboard</a></p></div></section>
<section id="_google_oauth_2_0_client_id"><h2>Google OAuth 2.0-Client-ID</h2><div class="imageblock" style=""><img src="images/Google-OAuth2-ClientID.png" alt="Google OAuth2 ClientID" height="800"></div></section>
<section id="_aufgabe_3_webanwendung_mit_oauth2_login"><h2>Aufgabe 3: Webanwendung mit OAuth2 Login</h2><div class="olist arabic"><ol class="arabic"><li><p>Ergänzen Sie die <code>application.properties</code> um die notwendigen Konfigurationseinträge für OAuth2.
Zugangsdaten für den notwendigen Google-API Account erhalten Sie von Ihrem Trainer. Alternativ
können Sie auch Ihren eigenen Account verwenden.</p></li><li><p>Fügen Sie die notwendigen Abhängigkeiten <code>spring-security-oauth2-client</code> und
<code>spring-security-oauth2-jose</code> hinzu, ändern Sie die <code>SecurityConfig</code>
von <code>formLogin()</code> auf <code>oauth2Login()</code> und testen Sie die Anwendung.</p></li><li><p>Was passiert genau bei der Anmeldung mit OAuth2? Nutzen Sie zum Nachvollziehen die Entwicklerwerkzeuge
Ihres Browsers. Alternativ (oder zusätzlich) können Sie auch das Security-Debugging von Spring
in der <code>SecurityConfig</code> einschalten:</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> configure(WebSecurity web) <span class="directive">throws</span> <span class="exception">Exception</span> {
    web.debug(<span class="predefined-constant">true</span>);
}</code></pre></li></ol></div></section>
<section id="_oauth2_3"><h2>OAuth2</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson05-cloud.html">&#8594; Weiter zu Spring Cloud</a></p></div></section>
<section id="_lektion_5_spring_cloud" data-state="no-title-footer"><h2>Lektion 5 - Spring Cloud</h2></section>
<section id="_in_den_wolken"><h2>In den Wolken</h2><div class="ulist"><ul><li><p>Stark verteilte Anwendungen</p><div class="ulist"><ul><li><p>Resilienz: Timeout, Retry, Failover, Circuit Breaker</p></li><li><p>Security: Authentifizierung, Autorisierung, Single Sign On (SSO)</p></li><li><p>Monitoring &amp; Logging</p></li><li><p>Konfigurationsmanagement</p></li></ul></div></li><li><p>Dynamische Umgebung</p><div class="ulist"><ul><li><p>Service Discovery (client-side vs. server-side)</p></li><li><p>Load Balancing (client-side vs. server-side)</p></li></ul></div></li><li><p>Konsolidierte Sicht</p><div class="ulist"><ul><li><p>API Gateway / Edge Server (Reverse Proxy, Routing)</p></li></ul></div></li></ul></div></section>
<section id="_exemplarische_systemarchitektur"><h2>Exemplarische Systemarchitektur</h2><div class="imageblock" style=""><img src="images/lesson05/Systemarchitektur.png" alt="Systemarchitektur" width="1200"></div></section>
<section id="_netflix_oss" class="columns"><h2>Netflix OSS</h2><div class="imageblock" style=""><img src="images/lesson05/netflix-oss.png" alt="netflix oss" width="500"></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Technology Stack für verteilte Anwendungen</p></li><li><p>Realisierung erprobter Patterns</p></li><li><p>Praxistauglich unter Hochlast</p></li><li><p>Heute: größtenteils im Wartungsmodus</p></li><li><p><a href="https://github.com/Netflix" class="bare">https://github.com/Netflix</a></p></li></ul></div></div></div></section>
<section id="_netflix_oss_2"><h2>Netflix OSS</h2><div class="ulist"><ul><li><p>Eureka</p><div class="ulist"><ul><li><p>Service Discovery</p></li><li><p>Alternativen: Consul, Zookeeper, etcd, Kubernetes</p></li></ul></div></li><li><p>Hystrix</p><div class="ulist"><ul><li><p>Circuit Breaker</p></li><li><p>Alternative: Spring Cloud Circuit Breaker + Resilience4j</p></li></ul></div></li><li><p>Ribbon</p><div class="ulist"><ul><li><p>Client-side Load Balancing</p></li><li><p>Künftige Alternative: Spring Cloud Load Balancer</p></li></ul></div></li></ul></div></section>
<section id="_netflix_oss_3"><h2>Netflix OSS</h2><div class="ulist"><ul><li><p>Feign</p><div class="ulist"><ul><li><p>Deklarativer REST Client</p></li><li><p>Alternative: Spring Web (RestTemplate)</p></li></ul></div></li><li><p>Zuul</p><div class="ulist"><ul><li><p>API Gateway</p></li><li><p>Alternative: Spring Cloud Gateway</p></li></ul></div></li><li><p>Archaius</p><div class="ulist"><ul><li><p>Konfigurationsmanagement</p></li><li><p>Alternative: Spring Cloud Config</p></li></ul></div></li></ul></div></section>
<section id="_systemarchitektur_mit_netflix_oss"><h2>Systemarchitektur mit Netflix OSS</h2><div class="imageblock" style=""><img src="images/lesson05/Systemarchitektur-Netflix.png" alt="Systemarchitektur Netflix" width="1300"></div></section>
<section id="_spring_cloud" class="columns"><h2>Spring Cloud</h2><div class="imageblock" style=""><img src="images/lesson05/spring-cloud.png" alt="spring cloud" width="400"></div>
<div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Erweiterung(en) von Spring Boot für verteilte Anwendungen</p></li><li><p>Microservices &amp; Cloud</p></li><li><p>Starter mit gemeinsamem Release Train</p></li><li><p>Eigenes Maven Parent (analog Spring Boot)</p></li><li><p>Unterstützung für Netflix OSS: Spring Cloud Netflix</p></li><li><p>Aktueller Release Train: 2021.0.x (a.k.a. Jubilee)</p></li></ul></div></div></div></section>
<section id="_spring_cloud_2"><h2>Spring Cloud</h2><div class="ulist"><ul><li><p>Links</p><div class="ulist"><ul><li><p><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2021.0-Release-Notes" class="bare">https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2021.0-Release-Notes</a></p></li><li><p><a href="https://entwickler.de/cloud/spring-cloud-das-microservices-framework/" class="bare">https://entwickler.de/cloud/spring-cloud-das-microservices-framework/</a></p></li><li><p><a href="https://www.predic8.de/microservices-spring-boot-spring-cloud.htm" class="bare">https://www.predic8.de/microservices-spring-boot-spring-cloud.htm</a></p></li></ul></div></li></ul></div></section>
<section id="_spring_cloud_netflix"><h2>Spring Cloud Netflix</h2><div class="ulist"><ul><li><p>Integration des Netflix OSS Stacks</p></li><li><p>Individuelle Starter für einzelne Libraries</p></li><li><p>Links</p><div class="ulist"><ul><li><p><a href="https://spring.io/projects/spring-cloud-netflix" class="bare">https://spring.io/projects/spring-cloud-netflix</a></p></li><li><p><a href="https://www.baeldung.com/spring-cloud-netflix-eureka" class="bare">https://www.baeldung.com/spring-cloud-netflix-eureka</a></p></li><li><p><a href="https://entwickler.de/cloud/fruhlingswolken/" class="bare">https://entwickler.de/cloud/fruhlingswolken/</a></p></li><li><p><a href="https://dzone.com/articles/the-future-of-spring-cloud-microservices-after-net" class="bare">https://dzone.com/articles/the-future-of-spring-cloud-microservices-after-net</a></p></li><li><p><a href="https://www.north-47.com/knowledge-base/scaling-microservices-with-spring-cloud-netflix/" class="bare">https://www.north-47.com/knowledge-base/scaling-microservices-with-spring-cloud-netflix/</a></p></li><li><p><a href="https://panonit.com/blog/microservices-java-spring-cloud-and-netflix-overview-part-1" class="bare">https://panonit.com/blog/microservices-java-spring-cloud-and-netflix-overview-part-1</a></p></li><li><p><a href="https://www.objectivity.co.uk/blog/microservice-architecture-based-on-spring-cloud-netflix/" class="bare">https://www.objectivity.co.uk/blog/microservice-architecture-based-on-spring-cloud-netflix/</a></p></li></ul></div></li></ul></div></section>
<section id="_spring_cloud_circuitbreaker"><h2>Spring Cloud CircuitBreaker</h2><div class="ulist"><ul><li><p>Vereinheitlichte API für Circuit Breaker</p></li><li><p>Austauschbare Implementierungen</p><div class="ulist"><ul><li><p>Hystrix</p></li><li><p>Resilience4j</p></li><li><p>Spring Retry</p></li></ul></div></li><li><p>Links</p><div class="ulist"><ul><li><p><a href="https://spring.io/projects/spring-cloud-circuitbreaker" class="bare">https://spring.io/projects/spring-cloud-circuitbreaker</a></p></li><li><p><a href="https://www.baeldung.com/spring-cloud-circuit-breaker" class="bare">https://www.baeldung.com/spring-cloud-circuit-breaker</a></p></li></ul></div></li></ul></div></section>
<section id="_spring_cloud_vault"><h2>Spring Cloud Vault</h2><div class="ulist"><ul><li><p>Integration von HashiCorp Vault</p></li><li><p>Verwendung von Secrets in Properties</p></li><li><p>Unterstützung dynamischer Credentials</p></li><li><p>Links</p><div class="ulist"><ul><li><p><a href="https://www.baeldung.com/spring-cloud-vault" class="bare">https://www.baeldung.com/spring-cloud-vault</a></p></li><li><p><a href="https://spring.io/projects/spring-cloud-vault" class="bare">https://spring.io/projects/spring-cloud-vault</a></p></li></ul></div></li></ul></div></section>
<section id="_spring_cloud_config"><h2>Spring Cloud Config</h2><div class="ulist"><ul><li><p>Zentrales Konfigurationsmanagement</p></li><li><p>REST Interface</p></li><li><p>Verschlüsselung von Properties</p></li><li><p>Links</p><div class="ulist"><ul><li><p><a href="https://spring.io/projects/spring-cloud-config" class="bare">https://spring.io/projects/spring-cloud-config</a></p></li><li><p><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/" class="bare">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/</a></p></li><li><p><a href="https://www.baeldung.com/spring-cloud-configuration" class="bare">https://www.baeldung.com/spring-cloud-configuration</a></p></li></ul></div></li></ul></div></section>
<section id="_spring_cloud_bus"><h2>Spring Cloud Bus</h2><div class="ulist"><ul><li><p>Verbindung von Spring Boot Services über Message Bus</p><div class="ulist"><ul><li><p>AMQP (z.B. RabbitMQ)</p></li><li><p>Apache Kafka</p></li></ul></div></li><li><p>Verteilung und Aktualisierung von Konfigurationen</p></li><li><p>Links</p><div class="ulist"><ul><li><p><a href="https://spring.io/projects/spring-cloud-bus" class="bare">https://spring.io/projects/spring-cloud-bus</a></p></li><li><p><a href="https://www.baeldung.com/spring-cloud-bus" class="bare">https://www.baeldung.com/spring-cloud-bus</a></p></li></ul></div></li></ul></div></section>
<section id="_übung_16_spring_cloud_netflix_eureka_server"><h2>Übung 1/6 - Spring Cloud Netflix Eureka (Server)</h2><div class="paragraph"><p>Setzen Sie einen Spring Cloud Eureka Server auf:</p></div>
<div class="ulist"><ul><li><p>Erstellen Sie ein neues Projekt mit dem <a href="https://start.spring.io">Spring Initializr</a> und wählen Sie dabei die Dependency <code>Eureka Server</code> aus.</p></li><li><p>Versehen Sie die Application-Klasse mit der Annotation <code>@EnableEurekaServer</code>.</p></li><li><p>Setzen Sie in der <code>application.properties</code> die Einstellungen <code>eureka.client.registerWithEureka</code> und <code>eureka.client.fetchRegistry</code> auf <code>false</code> sowie <code>server.port</code> auf <code>8761</code>.</p></li><li><p>Starten Sie die Anwendung.</p></li></ul></div></section>
<section id="_übung_26_spring_cloud_netflix_eureka_clients"><h2>Übung 2/6 - Spring Cloud Netflix Eureka (Clients)</h2><div class="olist arabic"><ol class="arabic"><li><p>Registrieren Sie <code>AbrechnungService</code> und <code>ZugangskontrollService</code> beim Eureka Server:</p><div class="ulist"><ul><li><p>Fügen Sie den <a href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-eureka-client">spring-cloud-starter-netflix-eureka-client</a> als Maven Dependency der jeweiligen POM hinzu.</p></li><li><p>Ergänzen Sie die jeweiligen <code>application.properties</code> um die Einstellungen <code>spring.application.name</code> (Wert: <code>zugangskontroll-service</code> bzw. <code>abrechnung-service</code>) und <code>eureka.client.serviceUrl.defaultZone</code> (Wert: <code><a href="http://localhost:8761/eureka" class="bare">http://localhost:8761/eureka</a></code>)</p></li><li><p>Starten Sie die beiden Services und betrachten Sie die Logs.</p></li></ul></div></li><li><p>Rufen Sie das Eureka Dashboard unter <code><a href="http://localhost:8761" class="bare">http://localhost:8761</a></code> auf. Welche Informationen erhalten Sie?</p></li></ol></div></section>
<section id="_übung_36_spring_cloud_netflix_hystrix"><h2>Übung 3/6 - Spring Cloud Netflix Hystrix</h2><div class="paragraph"><p>Erweitern Sie den Fallback-Mechanismus in der Klasse <code>ExitGrantServiceImpl</code> des <code>ZugangskontrollService</code> durch einen Spring Cloud Circuit Breaker:</p></div>
<div class="ulist"><ul><li><p>Fügen Sie <a href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-hystrix">spring-cloud-starter-netflix-hystrix</a> als Dependency der POM hinzu.</p></li><li><p>Lassen Sie sich eine <code>CircuitBreakerFactory</code> mittels Autowiring injekten.</p></li><li><p>Erstellen Sie über die Factory einen <code>CircuitBreaker</code> und wrappen Sie damit den Aufruf des PaymentClients. Referenzieren Sie dabei den bereits bestehenden Fallback.</p></li><li><p>Testen Sie den Circuit Breaker, indem Sie den <code>AbrechnungService</code> stoppen und eine Anfrage an den <code>ZugangskontrollService</code> senden.</p></li></ul></div></section>
<section id="_übung_46_spring_cloud_config_server"><h2>Übung 4/6 - Spring Cloud Config (Server)</h2><div class="paragraph"><p>Setzen Sie einen Spring Cloud Config Server auf:</p></div>
<div class="ulist"><ul><li><p>Erstellen Sie ein neues Projekt <code>config-server</code> mit dem <a href="https://start.spring.io">Spring Initializr</a> und wählen Sie dabei die Dependencies <code>Config Server</code> und <code>Spring Web</code> aus.</p></li><li><p>Erstellen Sie mittels <code>git init</code> ein neues Git Repository.</p></li><li><p>Verschieben Sie die <code>application.properties</code> von <code>ZugangskontrollService</code> und <code>AbrechnungService</code> (als <code>zugangskontroll-service.properties</code> bzw. <code>abrechnung-service.properties</code>) dort hinein und committen Sie.</p></li><li><p>Setzen Sie die Property <code>server.port</code> in der <code>application.properties</code> des <code>config-server</code> auf <code>8888</code> und verweisen Sie über die Property <code>spring.cloud.config.server.git.uri</code> auf das gerade erstellte Git Repository (Wert: <code><a href="file://path/to/repo" class="bare">file://path/to/repo</a></code>).</p></li><li><p>Versehen Sie die Application Klasse mit der Annotation <code>@EnableConfigServer</code>.</p></li><li><p>Starten Sie die Anwendung und rufen Sie <code><a href="http://localhost:8888/abrechnung-service.properties" class="bare">http://localhost:8888/abrechnung-service.properties</a></code> und <code><a href="http://localhost:8888/zugangskontroll-service.properties" class="bare">http://localhost:8888/zugangskontroll-service.properties</a></code> auf.</p></li></ul></div></section>
<section id="_übung_56_spring_cloud_config_clients"><h2>Übung 5/6 - Spring Cloud Config (Clients)</h2><div class="paragraph"><p>Binden Sie <code>AbrechnungService</code> und <code>ZugangskontrollService</code> an den Config Server an:</p></div>
<div class="ulist"><ul><li><p>Fügen Sie <a href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-config">spring-cloud-starter-config</a> und <a href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-bootstrap">spring-cloud-starter-bootstrap</a> als Dependencies den jeweiligen POMs hinzu.</p></li><li><p>Legen Sie jeweils eine <code>bootstrap.properties</code> an und setzen Sie <code>spring.application.name</code> auf <code>abrechnung-service</code> bzw. <code>zugangskontroll-service</code> sowie <code>spring.cloud.config.uri</code> auf <code><a href="http://localhost:8888" class="bare">http://localhost:8888</a></code>.</p></li><li><p>Starten Sie die Services erneut und betrachten Sie die Logs. Welche Klasse ist nun für das Laden der Properties zuständig?</p></li></ul></div></section>
<section id="_übung_66_spring_cloud_gateway_spring_cloud_bus"><h2>Übung 6/6 - Spring Cloud Gateway, Spring Cloud Bus</h2><div class="paragraph"><p>Bonusaufgaben:</p></div>
<div class="ulist"><ul><li><p>Richten Sie ein Spring Cloud Gateway mit geeigneten Routen für <code>AbrechnungService</code> und <code>ZugangskontrollService</code> ein.</p></li><li><p>Stellen Sie die Anbindung zwischen <code>AbrechnungService</code> bzw. <code>ZugangskontrollService</code> und dem Config Server auf Spring Cloud Bus um. Den hierfür benötigten Message Broker (z.B. RabbitMQ) können Sie über Docker hochfahren.</p></li></ul></div></section>
<section id="_zusammenfassung_spring_cloud"><h2>Zusammenfassung Spring Cloud</h2><div class="ulist"><ul><li><p>Erweiterung(en) von Spring Boot für verteilte Anwendungen</p></li><li><p>Fokus: Microservices &amp; Cloud</p></li><li><p>Eigener Release Train</p></li><li><p>Vorreiter: Netflix OSS</p></li><li><p>Integration mit etablierten Libraries (u.a. Netflix OSS, Resilience4j)</p></li><li><p>Starter für verschiedene Einsatzgebiete (z.B. Circuit Breaker)</p></li></ul></div></section>
<section id="_abschluss"><h2>Abschluss</h2><div class="openblock heading"><div class="content"><div class="paragraph"><p>Fragen&#8230;&#8203;</p></div>
<div class="paragraph"><p>Anregungen&#8230;&#8203;</p></div>
<div class="paragraph"><p>Meinung&#8230;&#8203;</p></div>
<div class="paragraph"><p>Feedback&#8230;&#8203;</p></div></div></div></section></div></div><script src="reveal.js-3.9.2/lib/js/head.min.js"></script><script src="reveal.js-3.9.2/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: true,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'anderscore',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1728,
  height: 972,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.9.2/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/title-footer/title-footer.js', async: true, callback: function()
          {title_footer.initialize('GFU', 'Daniel Krämer', 'anderScore GmbH • Frankenwerft 35 • 50667 Köln');}},
      { src: 'reveal.js-3.9.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js-3.9.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js-3.9.2/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>