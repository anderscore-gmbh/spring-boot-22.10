<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Lektion 4 - Spring-Security</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js-3.9.2/css/reveal.css" rel="stylesheet"><link href="reveal.js-3.9.2/plugin/title-footer/title-footer.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js-3.9.2/css/theme/anderscore.css" id="theme"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.9.2/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js-3.9.2/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section id="_lektion_4_spring_security" data-state="no-title-footer"><h2>Lektion 4 - Spring-Security</h2><div class="openblock center"><div class="content"><div class="paragraph"><p>Was fällt Ihnen zum Thema Security ein?</p></div>
<div class="paragraph"><p>Welche Unterstützung erwarten Sie von Spring?</p></div></div></div></section>
<section id="_spring_security"><h2>Spring-Security</h2><div class="paragraph heading"><p>Themen</p></div>
<div class="ulist"><ul><li><p>Grundlagen zu IT-Sicherheit</p></li><li><p>Servlet Filter: Querschnittliche Funktionalität bei Webanwendungen</p></li><li><p>Spring Security Bausteine</p></li><li><p>Authentifzierung mit Spring</p></li><li><p>Authentifzierung bei einer Webanwendung</p></li><li><p>Autorisierung</p></li><li><p>Spring Security Konfiguration</p></li><li><p>Grundlagen zu OAuth2</p></li><li><p>Login mit OAuth2</p></li></ul></div></section>
<section><section id="_security_grundlagen"><h2>Security Grundlagen</h2><div class="paragraph heading"><p>IT-Sicherheit</p></div><div class="paragraph"><p>Es gibt drei Grundwerte der Informationssicherheit:</p></div><div class="ulist"><ul><li><p>Vertraulichkeit,</p></li><li><p>Verfügbarkeit und</p></li><li><p>Integrität.</p></li></ul></div><div class="paragraph"><p>Quelle: <a href="https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Grundschutz/Leitfaden/GS-Leitfaden_pdf.pdf?__blob=publicationFile&amp;v=3">Leitfaden Informationssicherheit</a>,<br>
<a href="https://www.bsi.bund.de">Bundesamt für Sicherheit in der Informationstechnik – BSI</a></p></div></section><section id="_it_sicherheit_mit_spring_security"><h2>IT-Sicherheit mit Spring-Security</h2><div class="paragraph"><p>Es gibt drei Grundwerte der Informationssicherheit:</p></div>
<div class="ulist"><ul><li><p>Vertraulichkeit, &#8658; Spring Security:</p><div class="ulist"><ul><li><p>Authentifizierung &#8658; Anwender identifizieren</p></li><li><p>Autorisierung &#8658; Berechtigung prüfen</p></li></ul></div></li><li><p>Verfügbarkeit und</p></li><li><p>Integrität.</p></li></ul></div></section><section id="_security_bei_spring_webanwendungen"><h2>Security bei Spring Webanwendungen</h2><div class="ulist"><ul><li><p>Security ist ein Querschnittsthema (AOP)</p></li><li><p>Erste Berechtigungsprüfung anhand der URL</p></li><li><p>Securitybelange über Filterkette realisiert</p></li></ul></div></section><section id="_servlet_filterchain_of_responsibility"><h2>Servlet Filter&#8201;&#8212;&#8201;Chain of Responsibility</h2><div class="imageblock" style=""><img src="images/filter.svg" alt="filter" width="1000" height="720"></div></section><section id="_servlet_filterverarbeitung_abgebrochen"><h2>Servlet Filter&#8201;&#8212;&#8201;Verarbeitung abgebrochen</h2><div class="imageblock" style=""><img src="images/filter-stopped.svg" alt="filter stopped" width="1000" height="600"></div></section></section>
<section id="_aufgabe_1_spring_security_aktivieren"><h2>Aufgabe 1: Spring Security aktivieren</h2><div class="olist arabic"><ol class="arabic"><li><p>Machen Sie sich mit der Beispielanwendung vertraut und stellen Sie sicher, dass sie läuft.</p></li><li><p>Fügen Sie die <code>spring-boot-starter-security</code> Abhängigkeit hinzu. Was ändert sich?</p><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content"><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-security">
Spring-Boot Reference: Security</a> für Hinweise zu User und Passwort.</td></tr></table></div></li><li><p>Setzen Sie einen Breakpoint in der Methode <code>org.springframework.web.servlet.DispatcherServlet.doService</code>
und rufen Sie <a href="http://localhost:8080/actuator/health" class="bare">http://localhost:8080/actuator/health</a> auf. Was fällt Ihnen am Stacktrace auf?</p></li><li><p>Suchen Sie den Anfang der Filter-Kette und ermitteln Sie über das Feld <code>ApplicationFilterChain.filters</code>
welche Filter durchlaufen werden.</p></li><li><p>In der Kette finden Sie die <code>springSecurityFilterChain</code>. Dabei handelt es sich um die Klasse
<code>org.springframework.security.web.FilterChainProxy</code>, die wiederum weitere Filter mitbringt.
Wieviele sind das?</p></li><li><p>Schalten Sie das Debug-Logging für diese Klasse ein mit:</p><div class="literalblock"><div class="content"><pre>logging.level.org.springframework.security.web=DEBUG</pre></div></div>
<div class="paragraph"><p>Welcher Filter verhindert einen Zugriff ohne Authentifizierung?</p></div></li></ol></div></section>
<section><section id="_spring_security_grundlagen"><h2>Spring Security Grundlagen</h2><div class="paragraph heading"><p>Java Security Grundbegriffe</p></div><div class="paragraph"><p>JAAS (Java Authentication and Authorization Service):</p></div><div class="imageblock" style=""><img src="images/subject.svg" alt="subject" width="1000" height="600"></div></section><section id="_spring_securitycontext"><h2>Spring SecurityContext</h2><div class="imageblock" style=""><img src="images/SecurityContext.svg" alt="SecurityContext" width="1600" height="600"></div></section><section id="_zugriff_auf_das_authentication_objekt"><h2>Zugriff auf das Authentication Objekt</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> <span class="predefined-type">String</span> getUsername() {
    <span class="predefined-type">Object</span> principal = SecurityContextHolder
            .getContext().getAuthentication().getPrincipal();

    <span class="predefined-type">String</span> username;
    <span class="keyword">if</span> (principal <span class="keyword">instanceof</span> UserDetails) {
        username = ((UserDetails) principal).getUsername();
    } <span class="keyword">else</span> {
        username = principal.toString();
    }
    <span class="keyword">return</span> username;
}</code></pre></section><section id="_was_geschieht_bei_der_authentifizierung"><h2>Was geschieht bei der Authentifizierung</h2><div class="olist arabic"><ol class="arabic"><li><p>Username/Passwort eingeben</p></li><li><p>Prüfen, ob beides gültig (erfolgreich)</p></li><li><p>Userdaten (u. a. Rollen) laden</p></li><li><p>SecurityContext anlegen</p></li><li><p>User arbeitet mit der Anwendung</p></li></ol></div></section><section id="_authentifizierung_mit_spring_security"><h2>Authentifizierung mit Spring Security</h2><div class="olist arabic"><ol class="arabic"><li><p>UsernamePasswordAuthenticationToken wird erzeugt</p></li><li><p>Token wird mit <code>AuthenticationManager</code> geprüft</p></li><li><p><code>AuthenticationManager</code> gibt vollständige <code>Authentication</code> zurück</p></li><li><p>diese wird mit <code>SecurityContextHolder.getContext().setAuthentication(…​)</code> gespeichert</p></li></ol></div>
<div class="paragraph"><p>Siehe <a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#overall-architecture">
&#8594; Spring Security Reference: 8. Architecture and Implementation</a></p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Beim Lesen der Security Reference mit Kapitel 8 beginnen!</td></tr></table></div></section><section id="_authenticationmanager_beispiel"><h2>AuthenticationManager Beispiel</h2><div class="title">AuthenticationExampleTest.java</div><pre class="CodeRay listingblock"><code class="java language-java">Authentication request = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password);
Authentication result = am.authenticate(request);
SecurityContextHolder.getContext().setAuthentication(result);</code></pre>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">SampleAuthenticationManager</span> <span class="directive">implements</span> AuthenticationManager {

    <span class="directive">public</span> Authentication authenticate(Authentication auth)
            <span class="directive">throws</span> <span class="exception">AuthenticationException</span> {
        <span class="keyword">if</span> (auth.getName().equals(auth.getCredentials())) {
            <span class="keyword">return</span> <span class="keyword">new</span> UsernamePasswordAuthenticationToken(auth.getName(),
                    auth.getCredentials(), AUTHORITIES);
        }
        <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bad Credentials</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section><section id="_authentifizierung_bei_einer_webanwendung"><h2>Authentifizierung bei einer Webanwendung</h2><div class="olist arabic"><ol class="arabic"><li><p>Anwender besucht Startseite und klickt auf einen Link</p></li><li><p>Anfrage geht an Server, dieser stellt fest: Seite ist geschützt</p></li><li><p>Server antwortet: Authentifizierung erforderlich (401 oder redirect)</p></li><li><p>Anwender gibt Username und Passwort im Browser ein</p></li><li><p>Browser schickt Daten an Server</p></li><li><p>Server prüft Anmeldedaten</p></li><li><p>Server löst Weiterleitung auf geschützte Seite aus</p></li></ol></div>
<div class="paragraph"><p>Spring hat dafür jeweils verschiedene Klassen, die wichtigsten (in der Reihenfolge
ihrer Verwendung)&#8230;&#8203;</p></div></section><section id="_klassen_für_web_security"><h2>Klassen für Web Security</h2><div class="dlist"><dl><dt class="hdlist1">ExceptionTranslationFilter</dt><dd><p>Fängt Spring Security Exceptions, wie z. B. <code>BadCredentialsException</code> oder <code>AccessDeniedException</code>,
ab und gibt entsprechende HTTP-Statuscodes zurück oder startet <code>AuthenticationEntryPoint</code></p></dd><dt class="hdlist1">AuthenticationEntryPoint</dt><dd><p>Schritt 3: <em>"Server antwortet: Authentifizierung erforderlich"</em></p></dd><dt class="hdlist1">UsernamePasswordAuthenticationFilter (allg. Authentifizierungsmechanismus) </dt><dd><p>Schritt 6:
<em>"Server prüft Anmeldedaten"</em> &#8594; Verwendet <code>AuthenticationManager</code> und speichert
<code>Authentication</code> mittels <code>SecurityContextHolder</code></p></dd><dt class="hdlist1">SecurityContextPersistenceFilter</dt><dd><p>Speichert <code>SecurityContext</code> zwischen Requests (standardmäßig
in Session)</p></dd><dt class="hdlist1">FilterSecurityInterceptor</dt><dd><p>Ist <code>AbstractSecurityInterceptor</code>, der die <em>Autorisierung</em> realisiert</p></dd></dl></div></section><section id="_autorisierung"><h2>Autorisierung</h2><div class="paragraph"><p>Zugriffsberechtigungen prüft der <code>AccessDecisionManager</code> in der <code>decide</code> Methode:</p></div>
<div class="literalblock"><div class="content"><pre>void decide(Authentication authentication, Object object,
		Collection&lt;ConfigAttribute&gt; configAttributes) throws AccessDeniedException,
		InsufficientAuthenticationException;</pre></div></div>
<div class="paragraph"><p>Das <code>object</code> ist das gesichterte Objekt, im allg. ein Methodenaufruf oder ein Web-Request</p></div>
<div class="paragraph"><p>Die Berechtigungsprüfung ist über einen Around-Advise (mittels Spring-AOP bei Methodenaufrufen und
Filter bei Web-Requests) realisiert.<br>
Dieser ist eine Subklasse von <code>AbstractSecurityInterceptor</code>.</p></div></section><section id="_abstractsecurityinterceptor_workflow"><h2>AbstractSecurityInterceptor Workflow</h2><div class="olist arabic"><ol class="arabic"><li><p>Konfigurationsattribute für Aufruf laden</p></li><li><p><code>AccessDecisionManager.decide()</code> aufrufen</p></li><li><p>Bei Bedarf <code>Authentication</code> für Aufruf ändern (<code>RunAsManager</code>)</p></li><li><p>Aufruf durchführen</p></li><li><p>AfterInvocationManager aufrufen (falls konfiguriert)</p></li></ol></div>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Wenn dieser Workflow durchlaufen wird, enthält der <code>SecurityContextHolder</code> eine valide <code>Authentication</code></td></tr></table></div></section><section id="_was_sind_konfigurationsattribute"><h2>Was sind Konfigurationsattribute?</h2><div class="ulist"><ul><li><p>Ein <code>ConfigAttribute</code> ist ein Zeichenkette, die eine besondere Bedeutung für die Klassen hat,
die der <code>AbstractSecurityInterceptor</code> verwendet, z. B. Rollennamen.</p></li><li><p>Sie werden normalerweise über Methoden-Annotationen angegeben (<code>@PreAuthorize</code>, <code>@Secured</code>).</p></li><li><p>Der <code>AbstractSecurityInterceptor</code> verwendet eine <code>SecurityMetadataSource</code>, um die
Konfigurationsattribute für ein gesichertes Objekt zu laden.</p></li></ul></div></section><section id="_securitymetadatasource"><h2>SecurityMetadataSource</h2><div class="imageblock" style=""><img src="images/SecurityMetadataSource.png" alt="SecurityMetadataSource" height="720"></div></section></section>
<section><section id="_security_konfiguration"><h2>Security-Konfiguration</h2><div class="paragraph heading"><p>Basic Authentication</p></div><div class="title">BasicLoginTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span> <span class="comment">// nicht notwendig bei Spring-Boot</span>
<span class="annotation">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="predefined-constant">true</span>)
<span class="directive">static</span> <span class="type">class</span> <span class="class">SecurityConfig</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
        http.authorizeRequests()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/js/**</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/css/**</span><span class="delimiter">&quot;</span></span>).permitAll()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/admin/**</span><span class="delimiter">&quot;</span></span>)
                    .hasAuthority(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>) <span class="comment">// alternativ: hasRole(&quot;ADMIN&quot;)</span>
                .anyRequest().authenticated()
                .and().httpBasic(); <span class="comment">// basic authentication</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> configure(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PasswordEncoder encoder = PasswordEncoderFactories.createDelegatingPasswordEncoder();
        auth.inMemoryAuthentication()
                .withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">hugo</span><span class="delimiter">&quot;</span></span>)
                .password(encoder.encode(<span class="string"><span class="delimiter">&quot;</span><span class="content">pwd123</span><span class="delimiter">&quot;</span></span>))
                .authorities(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>) <span class="comment">// alternativ: roles(&quot;USER&quot;)</span>
        .and().withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">fritz</span><span class="delimiter">&quot;</span></span>).password(encoder.encode(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret123</span><span class="delimiter">&quot;</span></span>)).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section><section id="_login_formular"><h2>Login-Formular</h2><div class="title">WebAuthenticationTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
    http.authorizeRequests()
            .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/unauthorized</span><span class="delimiter">&quot;</span></span>).permitAll()
            .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/admin/**</span><span class="delimiter">&quot;</span></span>).hasRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
            .anyRequest().authenticated()
            .and().formLogin()
                .loginPage(<span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>) <span class="comment">// Login-Seite</span>
                .failureUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/login?error=bad_credentials</span><span class="delimiter">&quot;</span></span>)<span class="comment">// falls Login fehlgeschlagen</span>
                .defaultSuccessUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/secured</span><span class="delimiter">&quot;</span></span>) <span class="comment">// wenn kein Referer gesetzt war</span>
            .and().logout()<span class="comment">// bei Logout</span>
                .deleteCookies(<span class="string"><span class="delimiter">&quot;</span><span class="content">JSESSIONID</span><span class="delimiter">&quot;</span></span>) <span class="comment">// cookie loeschen</span>
                .logoutUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/logout</span><span class="delimiter">&quot;</span></span>) <span class="comment">// Logout-Seite</span>
                .logoutSuccessUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>); <span class="comment">// nach dem Logout</span>
}</code></pre>
<div class="paragraph"><p>Siehe <a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#jc-authorize-requests">Spring Security Reference: 6.4 Authorize Requests</a></p></div></section><section id="_absichern_einer_methode"><h2>Absichern einer Methode</h2><div class="title">BasicLoginTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protected</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@PreAuthorize</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasRole('ADMIN')</span><span class="delimiter">&quot;</span></span>)  <span class="comment">// alternativ: hasAuthority('ROLE_ADMIN')</span>
<span class="directive">public</span> <span class="predefined-type">String</span> protectedGreeting() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Protected World!</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
<div class="paragraph"><p>Neben <code>hasRole([role])</code> gibt es u. a. <code>hasAnyRole([role1,role2])</code>, <code>isAuthenticated()</code>, <code>isAnonymous()</code>,
oder <code>hasPermission(Object target, Object permission)</code>.</p></div>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Dafür ist <code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code> notwendig!</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#el-access">&#8594; Spring Security Reference: Expression-Based Access Control</a></p></div></section><section id="_datenabhängige_zugriffsbeschränkungen"><h2>Datenabhängige Zugriffsbeschränkungen</h2><div class="ulist"><ul><li><p>Neben <code>@PreAuthorize</code> gibt es noch ein <code>@PostAuthorize</code> um Berechtigung abhängig von den geladenen Daten zu prüfen</p></li><li><p>Mit <code>@PreFilter</code> und <code>@PostFilter</code> kann man Collections filtern</p></li><li><p>Spring bietet mit <code>spring-security-acl</code> ein API zum Verwalten von Domain-Objekt abhängigen Zugriffsberechtigung (ACLs)</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-security/site/docs/5.3.6/reference/htmlsingle/#domain-acls">&#8594; Spring Security Reference: Domain Object Security (ACLs)</a><br>
<a href="https://jaxenter.de/ausgaben/java-magazin-4-18">&#8594; Javamagazin 04.2018, Seite 37ff.</a></p></div></section></section>
<section><section id="_aufgabe_2_sichern_sie_ihre_webapplikation_ab_2_teile"><h2>Aufgabe 2: Sichern Sie Ihre Webapplikation ab (2 Teile)</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie im <code>GreetingController</code> die <code>getCurrentUsername</code> Methode so, dass Sie über den
<code>SecurityContextHolder</code> den Loginnamen des aktuellen Benutzers ausgibt. Mit einem GET-Request
auf <code>/authenticated</code> sollte danach der Benutzername ausgegeben werden.</p></li><li><p>Ändern Sie die Klasse <code>SecurityConfig</code> so, dass sie <code>WebSecurityConfigurerAdapter</code> erweitert.
Überschreiben Sie <code>configure(WebSecurity)</code> und aktvieren Sie mit <code>web.debug(true)</code> das
Debug-Logging für die Security.</p></li><li><p>Verwenden Sie <code>inMemoryAuthentication()</code> um zwei Benutzer mit verschiedenen Rollen, z. B. <code>ROLE_USER</code> und
<code>ROLE_ADMIN</code> in der entsprechenden <code>configure</code> Methode anzulegen.</p></li><li><p>Nutzen Sie das <code>HttpSecurity</code> Objekt aus der zugehörigen <code>configure</code>-Methode, um die Anwendung so
zu konfigurieren, dass jeder die Startseite <code>/</code> und <code>anonymous</code> aufrufen kann.
Dagegen darf <code>/authenticated</code> nur authentifizierten Benutzern zugänglich sein.</p></li><li><p>Ergänzen Sie Ihre Security-Konfiguration derart, dass <code>/admin/greeting</code> nur für Benutzer mit der
Rolle <code>ROLE_ADMIN</code> zugänglich ist.</p></li></ol></div><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Nutzen Sie die Codefragmente aus den Tests im Package <code>security.fragments</code> als Vorlage.</td></tr></table></div></section><section id="_teil_2_außerhalb_von_securityconfig"><h2>Teil 2: Außerhalb von SecurityConfig</h2><div class="olist arabic"><ol class="arabic" start="6"><li><p>Was bewirkt die Einstellung <code>server.error.whitelabel.enabled=false</code>?</p></li><li><p>Erstellen Sie eine eigene Fehlerseite für fehlende Berechtigung (HTTP-Statuscode 403).</p></li><li><p>Schränken Sie nun, analog zu Schritt 5, <code>/user/greeting</code> auf Benutzer mit <code>ROLE_USER</code> ein.
Verändern Sie <strong>nicht</strong> die <code>SecurityConfig</code>, sondern verwenden Sie stattdessen die
<code>@PreAuthorize</code> Annotation.</p><div class="admonitionblock caution teacherBox"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Vergessen Sie nicht <code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code> anzugeben!</td></tr></table></div></li><li><p><em>Optional:</em>
Legen Sie eine eigene Login-Seite an und binden Sie diese statt der Default-Loginseite ein.</p><div class="admonitionblock caution teacherBox"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Zum Logout müssen Sie dann statt dem GET-Request einen POST-Request senden.</td></tr></table></div></li><li><p><em>Optional:</em>
Verwenden Sie statt der inMemoryAuthentication() einen eigenen <code>UserDetailsService</code>.</p></li></ol></div></section></section>
<section id="_spring_security_2"><h2>Spring-Security</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0402-oauth2.html">&#8594; Weiter zu OAuth2</a></p></div></section></div></div><script src="reveal.js-3.9.2/lib/js/head.min.js"></script><script src="reveal.js-3.9.2/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: true,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'anderscore',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1728,
  height: 972,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.9.2/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/title-footer/title-footer.js', async: true, callback: function()
          {title_footer.initialize('GFU', 'Daniel Krämer', 'anderScore GmbH • Frankenwerft 35 • 50667 Köln');}},
      { src: 'reveal.js-3.9.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js-3.9.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js-3.9.2/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>